import{a as g}from"./chunk-SN2WC5S6.js";import{a as j,e as S,f as A}from"./chunk-SLZ5API5.js";import{A as b,Sa as m,Ta as f,Ua as M,f as c,g as C,j as p,q as l,v as u,x as T}from"./chunk-SZXUWVBX.js";import{a as v,b as x,i as d}from"./chunk-OYAVQN5W.js";var y=(()=>{let s=class s{static openDB(){return new Promise((t,r)=>{let a=indexedDB.open(s.dbName,g.version);a.onupgradeneeded=n=>{let o=n.target.result;g.onUpgrade(o)},a.onsuccess=()=>t(a.result),a.onerror=()=>r(a.error)})}static getAll(){return d(this,null,function*(){let t=yield s.openDB();return new Promise((r,a)=>{let e=t.transaction(s.storeName,"readonly").objectStore(s.storeName).getAll();e.onsuccess=()=>r(e.result),e.onerror=()=>a(e.error)})})}static setAll(t){return d(this,null,function*(){let r=yield s.openDB();return new Promise((a,n)=>{var i;let o=r.transaction(s.storeName,"readwrite"),e=o.objectStore(s.storeName);e.clear();for(let w of t){let E=x(v({},w),{id:(i=w.ID)!=null?i:w.id});e.put(E)}o.oncomplete=()=>a(),o.onerror=()=>n(o.error)})})}};s.dbName="PlayMateDB",s.storeName="members";let h=s;return h})();var J=(()=>{let s=class s{constructor(t,r,a){this.http=t,this.authService=r,this.clubContext=a,this.apiUrl=j.apiUrl}getRequestPayload(a){return d(this,arguments,function*(t,r={}){let n=yield this.authService.getAuthToken();return{action:t,payload:r,authorization:n?"Bearer "+n:void 0}})}getMembers(){return c(y.getAll()).pipe(p(t=>({members:t,isFresh:!1})),l(()=>C({members:[],isFresh:!1})))}refreshMembers(){return c(this.authService.getAuthToken()).pipe(u(t=>{let r=this.clubContext.getSportsClubId()||"",a=new f().set("sportsClubId",r).set("action","getMembers").set("authorization",t?"Bearer "+t:""),o={headers:new m({"Content-Type":"text/plain;charset=utf-8"}),params:a,responseType:"json",observe:"body"};return this.http.get(this.apiUrl,o).pipe(p(e=>{var i;if(e.status==="error")throw new Error((i=e.error)==null?void 0:i.message);return this.clubContext.setLastMemberRefresh(new Date),e.data||[]}),u(e=>c(y.setAll(e)).pipe(p(()=>e))),p(e=>({members:e,isFresh:!0})),l(e=>{throw console.error("Error fetching members:",e),e}))}))}searchMembers(t){return c(this.authService.getAuthToken()).pipe(u(r=>{let a=new f().set("action","getMembers").set("payload",JSON.stringify({filters:{searchTerm:t}})).set("authorization",r?"Bearer "+r:""),o={headers:new m({"Content-Type":"text/plain;charset=utf-8"}),params:a,responseType:"json",observe:"body"};return this.http.get(this.apiUrl,o).pipe(p(e=>{var i;if(e.status==="error")throw new Error((i=e.error)==null?void 0:i.message);return e.data||[]}),l(e=>{throw console.error("Error searching members:",e),e}))}))}addMember(t){return c(this.authService.getAuthToken()).pipe(u(r=>{if(!r)throw new Error("No valid auth token");let a=new f().set("sportsClubId",this.clubContext.getSportsClubId()||"").set("action","addMember").set("authorization","Bearer "+r),o={headers:new m({"Content-Type":"text/plain;charset=utf-8"}),params:a,responseType:"json",observe:"body"};return this.http.post(this.apiUrl,t,o).pipe(p(e=>{var i;if(e.status==="success"&&e.data)return e.data;throw e.status==="error"&&((i=e.error)!=null&&i.message)?new Error(e.error.message):new Error("Failed to add member")}))}))}updateMember(t){return c(this.getRequestPayload("updateMember",t)).pipe(u(r=>{let n={headers:new m({"Content-Type":"text/plain;charset=utf-8"}),responseType:"json",observe:"body"};return this.http.post(this.apiUrl,r,n).pipe(p(o=>{var e;if(o.status==="error")throw new Error((e=o.error)==null?void 0:e.message);return o.data}))}))}deleteMember(t){return c(this.getRequestPayload("deleteMember",{memberId:t})).pipe(u(r=>{let n={headers:new m({"Content-Type":"text/plain;charset=utf-8"}),responseType:"json",observe:"body"};return this.http.post(this.apiUrl,r,n).pipe(p(o=>{var e;if(o.status==="error")throw new Error((e=o.error)==null?void 0:e.message);return o.data||!1}))}))}};s.\u0275fac=function(r){return new(r||s)(b(M),b(S),b(A))},s.\u0275prov=T({token:s,factory:s.\u0275fac,providedIn:"root"});let h=s;return h})();export{J as a};
