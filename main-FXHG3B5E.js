import{a as Ae,c as je}from"./chunk-YRI2VTH4.js";import{a as Oe}from"./chunk-36IZBGHT.js";import{a as He}from"./chunk-DQKFDWKI.js";import{b as Te}from"./chunk-N2MTMSRW.js";import{a as Fe}from"./chunk-CUULV472.js";import{a as Pe,b as Ee,c as H,d as Re,e as g,f as Le}from"./chunk-U2LQ2IHZ.js";import"./chunk-T47TWMLD.js";import"./chunk-P5NOT2UF.js";import{E as $e,a as ke,x as De}from"./chunk-KQP4CTSV.js";import"./chunk-4D53AV6Y.js";import{$a as h,A as m,Ca as A,D as X,Da as j,Db as D,Fa as ne,Fb as fe,G as Y,H as Z,Ib as de,Jb as he,La as T,Lb as ge,Mb as ve,Na as P,P as ee,Q as v,Qa as E,R as a,Sa as re,T as b,Tb as Ie,U as te,Va as R,Wa as se,Wb as Ce,Xa as ae,Y as S,Ya as ce,Za as me,Zb as $,_ as I,_a as k,_b as be,aa as s,ac as L,ba as c,bb as le,bc as F,ca as u,cb as pe,cc as Se,db as ue,ga as ie,h as G,ia as d,j as W,ja as w,mc as _e,nc as ye,q as J,qc as O,rc as xe,sa as f,t as K,ta as z,uc as Me,vc as we,x as C,xc as _,y as Q,za as oe}from"./chunk-ZZBMK7P7.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h as B,i as p}from"./chunk-OYAVQN5W.js";var Ne=(()=>{let e=class e{http;prefix;suffix;constructor(i,o="/assets/i18n/",n=".json"){this.http=i,this.prefix=o,this.suffix=n}getTranslation(i){return this.http.get(`${this.prefix}${i}${this.suffix}`)}};B(e,"\u0275fac",function(o){return new(o||e)(m(R),m(String),m(String))}),B(e,"\u0275prov",C({token:e,factory:e.\u0275fac}));let t=e;return t})();var N=(()=>{let e=class e{constructor(i,o){this.authService=i,this.router=o}canActivate(){return this.authService.isAuthenticated$.pipe(K(1),W(i=>i?!0:(this.router.navigate(["/login"]),!1)))}};e.\u0275fac=function(o){return new(o||e)(m(g),m(h))},e.\u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var Be=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",loadComponent:()=>import("./chunk-4OJJALIL.js").then(t=>t.LoginPage)},{path:"settings",canActivate:[N],loadComponent:()=>import("./chunk-7LKZXNWK.js").then(t=>t.SettingsPage)},{path:"attendance-details",canActivate:[N],loadComponent:()=>import("./chunk-F4LOAKUI.js").then(t=>t.AttendanceDetailsPage)},{path:"tabs",canActivate:[N],loadChildren:()=>import("./chunk-HTXYA6II.js").then(t=>t.routes)}];var ze=(()=>{let e=class e{constructor(i,o){this.router=i,this.menu=o}navigate(i){return p(this,null,function*(){yield this.menu.close(),yield this.router.navigate([i])})}};e.\u0275fac=function(o){return new(o||e)(a(h),a(Me))},e.\u0275cmp=b({type:e,selectors:[["app-menu"]],decls:26,vars:0,consts:[["contentId","main-content"],["color","primary"],["button","","detail","",3,"click"],["slot","start","name","people-outline"],["slot","start","name","cash-outline"],["slot","start","name","calendar-outline"],["slot","start","name","settings-outline"]],template:function(o,n){o&1&&(s(0,"ion-menu",0)(1,"ion-header")(2,"ion-toolbar",1)(3,"ion-title"),f(4,"PlayMate"),c()()(),s(5,"ion-content")(6,"ion-list")(7,"ion-item",2),d("click",function(){return n.navigate("/tabs/members")}),u(8,"ion-icon",3),s(9,"ion-label"),f(10,"Members"),c()(),s(11,"ion-item",2),d("click",function(){return n.navigate("/tabs/payments")}),u(12,"ion-icon",4),s(13,"ion-label"),f(14,"Payments"),c()(),s(15,"ion-item",2),d("click",function(){return n.navigate("/tabs/attendance")}),u(16,"ion-icon",5),s(17,"ion-label"),f(18,"Attendance"),c()(),s(19,"ion-item-divider")(20,"ion-label"),f(21,"Admin"),c()(),s(22,"ion-item",2),d("click",function(){return n.navigate("/settings")}),u(23,"ion-icon",6),s(24,"ion-label"),f(25,"Settings"),c()()()()())},dependencies:[Se,Ce,ye,_e,Ie,F,$,_,L,be],encapsulation:2});let t=e;return t})();var Ve=(()=>{let e=class e{constructor(i,o,n){this.toastController=i,this.router=o,this.authService=n}intercept(i,o){return o.handle(i).pipe(J(n=>{var x,M;let r="An error occurred";return n.error instanceof ErrorEvent?r=`Error: ${n.error.message}`:n.status===401?(this.authService.logout(),this.router.navigate(["/login"]),r="Session expired. Please log in again."):(M=(x=n.error)==null?void 0:x.error)!=null&&M.message?r=n.error.error.message:r=`Error Code: ${n.status}
Message: ${n.message}`,this.presentErrorToast(r),G(()=>n)}))}presentErrorToast(i){return p(this,null,function*(){yield(yield this.toastController.create({message:i,duration:3e3,position:"bottom",color:"danger",buttons:[{text:"Dismiss",role:"cancel"}]})).present()})}};e.\u0275fac=function(o){return new(o||e)(m(we),m(h),m(g))},e.\u0275prov=C({token:e,factory:e.\u0275fac});let t=e;return t})();function Qe(t,e){if(t&1&&(s(0,"ion-item")(1,"ion-label")(2,"h2"),f(3),c(),s(4,"p"),f(5),c()()()),t&2){let l=e.ngIf;v(3),z(l.name),v(2),z(l.email)}}var Ue=(()=>{let e=class e{constructor(i,o){this.authService=i,this.popoverController=o,this.userSession$=this.authService.userSession$}logout(){this.popoverController.dismiss(null,"logout")}};e.\u0275fac=function(o){return new(o||e)(a(g),a(O))},e.\u0275cmp=b({type:e,selectors:[["app-profile-menu"]],decls:7,vars:3,consts:[[4,"ngIf"],["button","",3,"click"],["slot","start","name","log-out-outline"]],template:function(o,n){o&1&&(s(0,"ion-list"),S(1,Qe,6,2,"ion-item",0),A(2,"async"),s(3,"ion-item",1),d("click",function(){return n.logout()}),u(4,"ion-icon",2),s(5,"ion-label"),f(6,"Logout"),c()()()),o&2&&(v(),I("ngIf",j(2,1,n.userSession$)))},dependencies:[E,T,P,F,$,L,_],styles:["ion-list[_ngcontent-%COMP%]{margin:0;padding:0}h2[_ngcontent-%COMP%]{font-weight:500;margin:0}p[_ngcontent-%COMP%]{margin:4px 0 0;color:var(--ion-color-medium)}"]});let t=e;return t})();function Xe(t,e){if(t&1&&u(0,"img",8),t&2){let l=w().ngIf;I("src",l.picture,ee)}}function Ye(t,e){t&1&&u(0,"ion-icon",9)}function Ze(t,e){if(t&1){let l=ie();s(0,"ion-buttons",3)(1,"ion-button",4),d("click",function(o){Y(l);let n=w(2);return Z(n.showProfileMenu(o))}),s(2,"ion-avatar",5),S(3,Xe,1,1,"img",6)(4,Ye,1,0,"ion-icon",7),c()()()}if(t&2){let l=e.ngIf;v(3),I("ngIf",l.picture),v(),I("ngIf",!l.picture)}}function et(t,e){if(t&1&&(S(0,Ze,5,2,"ion-buttons",2),A(1,"async")),t&2){let l=w();I("ngIf",j(1,1,l.userSession$))}}var qe=(()=>{let e=class e{constructor(i,o,n,r,x,M,We,Je){this.authService=i,this.router=o,this.popoverController=n,this.route=r,this.clubContext=x,this.memberService=M,this.attendanceService=We,this.paymentService=Je,ke({personCircleOutline:$e,logOutOutline:De}),this.userSession$=this.authService.userSession$}refreshAll(){let i=this.clubContext.getLastMemberRefresh(),o=new Date,n=12*60*60*1e3;console.log("[AppComponent] Last member refresh:",i),(!i||o.getTime()-new Date(i).getTime()>n)&&(console.log("[AppComponent] Refreshing members (last refresh > 12h or never)"),this.memberService.refreshMembers().subscribe({next:()=>{console.log("[AppComponent] Members refreshed, now refreshing attendance and payments in parallel"),this.attendanceService.refreshData().catch(r=>console.error("Error refreshing attendance:",r)),this.paymentService.refreshData().catch(r=>console.error("Error refreshing payments:",r))},error:r=>console.error("Error refreshing members:",r)}))}ngOnInit(){return p(this,null,function*(){try{yield Ee.initialize({google:{webClientId:Pe.googleSignInClientId}})}catch(i){console.error("Failed to initialize Social Login:",i)}this.authService.isAuthenticated$.subscribe(i=>p(this,null,function*(){if(i){let o=this.router.url;this.route.queryParams.subscribe(n=>p(this,null,function*(){let r=n.sportsClubId;r&&this.clubContext.setSportsClubId(r),!this.clubContext.getSportsClubId()&&!o.includes("/settings")&&(yield this.router.navigate(["/settings"]))}))}})),this.refreshAll()})}showProfileMenu(i){return p(this,null,function*(){let o=yield this.popoverController.create({component:Ue,event:i,translucent:!0});yield o.present();let{role:n}=yield o.onWillDismiss();n==="logout"&&(yield this.authService.logout(),yield this.router.navigate(["/login"]))})}};e.\u0275fac=function(o){return new(o||e)(a(g),a(h),a(O),a(me),a(Le),a(Fe),a(Oe),a(He))},e.\u0275cmp=b({type:e,selectors:[["app-root"]],features:[oe([{provide:k,useClass:D},{provide:se,useClass:Ve,multi:!0}])],decls:5,vars:0,consts:[["userProfile",""],["id","main-content"],["slot","end",4,"ngIf"],["slot","end"],[3,"click"],["slot","icon-only"],[3,"src",4,"ngIf"],["name","person-circle-outline",4,"ngIf"],[3,"src"],["name","person-circle-outline"]],template:function(o,n){o&1&&(s(0,"ion-app"),u(1,"app-menu")(2,"ion-router-outlet",1),c(),S(3,et,2,3,"ng-template",null,0,ne))},dependencies:[E,T,P,de,fe,he,_,ge,ve,ce,ze],encapsulation:2});let t=e;return t})();var Ge=(()=>{let e=class e{constructor(i){this.storage=i,this.init()}init(){return p(this,null,function*(){yield this.storage.create()})}};e.\u0275fac=function(o){return new(o||e)(m(H))},e.\u0275mod=te({type:e}),e.\u0275inj=Q({providers:[H],imports:[Re.forRoot({name:"playmate_db",driverOrder:["indexeddb","localstorage"]})]});let t=e;return t})();function tt(t){return new Ne(t,"./assets/i18n/",".json")}re(qe,{providers:[{provide:k,useClass:D},xe(),pe(Be,ue(le)),ae(),Te(),X(Ge,je.forRoot({loader:{provide:Ae,useFactory:tt,deps:[R]},defaultLanguage:"en"}))]});export{tt as createTranslateLoader};
