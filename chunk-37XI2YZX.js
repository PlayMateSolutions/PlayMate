import{m as ue}from"./chunk-A63BAQ4C.js";import"./chunk-HO4XRU2X.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VA6V3FDK.js";import"./chunk-UW4BVHYB.js";import"./chunk-XSAJWLZQ.js";import"./chunk-BIQ3VQTI.js";import"./chunk-4LRFH4BA.js";import"./chunk-XQ4WJ6EK.js";import"./chunk-AUS7AZQE.js";import"./chunk-2KNO3Z5J.js";import"./chunk-R4DLQLUE.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-BDLLJDKH.js";import"./chunk-CKP3SGE2.js";import"./chunk-QO3N4622.js";import{b as $e,c as et}from"./chunk-557QXH6E.js";import{a as pe,e as ge}from"./chunk-Y37KBMVB.js";import{a as he}from"./chunk-UC4BZQZ5.js";import{A as le,B as ce,D as me,G as He,H as qe,I as Je,J as Ge,K as Ye,L as de,M as Ke,N as Qe,O as Xe,P as Ze,Q as tt,R as nt,S as it,T as ot,W as rt,X as at,Z as st,_ as lt,aa as ct,b as Ne,da as mt,e as R,ea as dt,f as ie,g as Ve,ga as pt,h as We,ha as gt,ja as ht,k as Le,ka as ut,l as oe,la as _t,m as Ae,n as Be,o as re,oa as Mt,p as je,pa as bt,q as Re,r as ae,s as F,t as se,u as Fe,v as ze,w as Ue,z}from"./chunk-4X4DF2FM.js";import{$ as v,A as _,Aa as ve,Ba as te,Bb as A,Cb as Te,Db as Ee,E as be,Ea as Ie,Eb as B,Fa as W,Fb as ke,Ia as k,Ib as De,J as d,Ja as L,Jb as j,K as O,Ka as ne,M as V,Q as w,T as g,U,V as i,W as r,X as M,Y as xe,Z as Pe,aa as b,ba as h,c as S,d as fe,ea as K,g as D,h as ye,ja as we,ka as c,l as G,la as Q,ma as N,na as X,oa as f,p as T,pa as y,qa as x,r as Y,ra as Z,sa as $,u as E,ua as ee,va as Oe,z as u,za as Se}from"./chunk-6P3QBM3B.js";import"./chunk-PORVWMQE.js";import"./chunk-7KGURMOZ.js";import"./chunk-T47TWMLD.js";import"./chunk-4U5YMPL6.js";import"./chunk-BJPIKCFN.js";import"./chunk-B7XFECRN.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-UPDXPL72.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as q,b as J,i as C}from"./chunk-OYAVQN5W.js";function wt(a,s){if(a&1){let m=v();i(0,"ion-list")(1,"ion-item")(2,"ion-label",2),c(3,"Last Name"),r(),i(4,"ion-input",13),x("ngModelChange",function(n){u(m);let e=h();return y(e.lastName,n)||(e.lastName=n),_(n)}),r()(),i(5,"ion-item")(6,"ion-label",2),c(7,"Email"),r(),i(8,"ion-input",14),x("ngModelChange",function(n){u(m);let e=h();return y(e.email,n)||(e.email=n),_(n)}),r()(),i(9,"ion-item")(10,"ion-label",2),c(11,"Notes"),r(),i(12,"ion-input",15),x("ngModelChange",function(n){u(m);let e=h();return y(e.notes,n)||(e.notes=n),_(n)}),r()()()}if(a&2){let m=h();d(4),f("ngModel",m.lastName),d(4),f("ngModel",m.email),d(4),f("ngModel",m.notes)}}function Ot(a,s){if(a&1&&(i(0,"ion-text",3),c(1),r()),a&2){let m=h();d(),Q(m.error)}}var yt=(()=>{let s=class s{constructor(t){this.modalCtrl=t,this.memberAdded=new be,this.cancelled=new be,this.firstName="",this.phone="",this.place="",this.lastName="",this.email="",this.notes="",this.showOptional=!1,this.error=""}submit(){return C(this,null,function*(){if(this.error="",!this.firstName.trim()||!this.phone.trim()||!this.place.trim()){this.error="First Name, Phone, and Place are required.";return}let t={firstName:this.firstName.trim(),phone:this.phone.trim(),place:this.place.trim(),lastName:this.lastName.trim(),email:this.email.trim(),notes:this.notes.trim(),joinDate:new Date,createdDate:new Date().toISOString(),expiryDate:new Date(Date.now()+30*24*60*60*1e3).toISOString(),sports:[],status:"active",membershipType:"basic",lastPaymentDate:new Date};yield this.modalCtrl.dismiss({member:t})})}cancel(){return C(this,null,function*(){yield this.modalCtrl.dismiss()})}toggleOptional(){this.showOptional=!this.showOptional}};s.\u0275fac=function(n){return new(n||s)(O(ue))},s.\u0275cmp=V({type:s,selectors:[["app-add-member"]],outputs:{memberAdded:"memberAdded",cancelled:"cancelled"},features:[Z([ue])],decls:32,vars:6,consts:[[1,"add-member-modal"],[3,"ngSubmit"],["position","stacked"],["color","danger"],["name","firstName","required","",3,"ngModelChange","ngModel"],["name","phone","required","",3,"ngModelChange","ngModel"],["name","place","required","",3,"ngModelChange","ngModel"],["expand","block","fill","outline","type","button",3,"click"],[4,"ngIf"],["color","danger",4,"ngIf"],[1,"modal-actions"],["expand","block","type","submit"],["expand","block","fill","clear","color","medium",3,"click"],["name","lastName",3,"ngModelChange","ngModel"],["name","email","type","email",3,"ngModelChange","ngModel"],["name","notes",3,"ngModelChange","ngModel"]],template:function(n,e){n&1&&(i(0,"div",0)(1,"h2"),c(2,"Add New Member"),r(),i(3,"form",1),b("ngSubmit",function(){return e.submit()}),i(4,"ion-list")(5,"ion-item")(6,"ion-label",2),c(7,"First Name "),i(8,"ion-text",3),c(9,"*"),r()(),i(10,"ion-input",4),x("ngModelChange",function(l){return y(e.firstName,l)||(e.firstName=l),l}),r()(),i(11,"ion-item")(12,"ion-label",2),c(13,"Phone "),i(14,"ion-text",3),c(15,"*"),r()(),i(16,"ion-input",5),x("ngModelChange",function(l){return y(e.phone,l)||(e.phone=l),l}),r()(),i(17,"ion-item")(18,"ion-label",2),c(19,"Place "),i(20,"ion-text",3),c(21,"*"),r()(),i(22,"ion-input",6),x("ngModelChange",function(l){return y(e.place,l)||(e.place=l),l}),r()()(),i(23,"ion-button",7),b("click",function(){return e.toggleOptional()}),c(24),r(),w(25,wt,13,3,"ion-list",8)(26,Ot,2,1,"ion-text",9),i(27,"div",10)(28,"ion-button",11),c(29,"Add Member"),r(),i(30,"ion-button",12),b("click",function(){return e.cancel()}),c(31,"Cancel"),r()()()()),n&2&&(d(10),f("ngModel",e.firstName),d(6),f("ngModel",e.phone),d(6),f("ngModel",e.place),d(2),N(" ",e.showOptional?"Hide":"Show"," Optional Fields "),d(),g("ngIf",e.showOptional),d(),g("ngIf",e.error))},dependencies:[W,te,j,ke,A,Te,De,B,Ee,de,R,F,ae,se,z],styles:[".add-member-modal[_ngcontent-%COMP%]{padding:1.5rem;max-width:400px;margin:0 auto}.add-member-modal[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:1rem}.modal-actions[_ngcontent-%COMP%]{margin-top:1.5rem;display:flex;flex-direction:column;gap:.5rem}ion-list[_ngcontent-%COMP%]{margin-bottom:1rem}"]});let a=s;return a})();var xt=(()=>{let s=class s{constructor(t,n,e){this.http=t,this.authService=n,this.clubContext=e,this.apiUrl=pe.apiUrl}recordPayment(t){return S(this.authService.getAuthToken()).pipe(T(n=>{if(!n)throw new Error("No valid auth token");let e=new L().set("sportsClubId",this.clubContext.getSportsClubId()||"").set("action","recordPayment").set("authorization","Bearer "+n),l={headers:new k({"Content-Type":"text/plain;charset=utf-8"}),params:e,responseType:"json",observe:"body"};return this.http.post(this.apiUrl,t,l)}))}};s.\u0275fac=function(n){return new(n||s)(E(ne),E(ge),E(he))},s.\u0275prov=Y({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();function kt(a,s){if(a&1){let m=v();i(0,"ion-datetime",18),x("ngModelChange",function(n){u(m);let e=h();return y(e.payment.date,n)||(e.payment.date=n),_(n)}),r()}if(a&2){let m=h();f("ngModel",m.payment.date),g("showDefaultButtons",!0)}}function Dt(a,s){if(a&1){let m=v();i(0,"ion-datetime",18),x("ngModelChange",function(n){u(m);let e=h();return y(e.payment.periodStart,n)||(e.payment.periodStart=n),_(n)}),r()}if(a&2){let m=h();f("ngModel",m.payment.periodStart),g("showDefaultButtons",!0)}}function Nt(a,s){if(a&1){let m=v();i(0,"ion-datetime",18),x("ngModelChange",function(n){u(m);let e=h();return y(e.payment.periodEnd,n)||(e.payment.periodEnd=n),_(n)}),r()}if(a&2){let m=h();f("ngModel",m.payment.periodEnd),g("showDefaultButtons",!0)}}var Pt=(()=>{let s=class s{constructor(t,n,e){this.modalCtrl=t,this.paymentService=n,this.loadingCtrl=e,this.payment={memberId:"",date:new Date().toISOString(),amount:500,paymentType:"Cash",periodStart:new Date().toISOString(),periodEnd:"",status:"Paid",notes:"Monthly Fees"}}ngOnInit(){this.payment.memberId=this.member.id;let t=new Date;t.setDate(1),this.payment.periodStart=t.toISOString();let n=new Date(t);n.setMonth(n.getMonth()+1),n.setDate(0),this.payment.periodEnd=n.toISOString()}isValid(){return!!(this.payment.amount>0&&this.payment.date&&this.payment.periodStart&&this.payment.periodEnd&&this.payment.paymentType)}recordPayment(){return C(this,null,function*(){var n;if(!this.isValid())return;let t=yield this.loadingCtrl.create({message:"Recording payment..."});yield t.present();try{let e=yield this.paymentService.recordPayment(this.payment).toPromise();if((e==null?void 0:e.status)==="success"&&e.data)yield this.modalCtrl.dismiss({success:!0,payment:this.payment,paymentId:e.data.paymentId,expiryDate:e.data.expiryDate});else throw new Error(((n=e==null?void 0:e.error)==null?void 0:n.message)||"Failed to record payment")}catch(e){console.error("Payment recording failed:",e)}finally{yield t.dismiss()}})}dismiss(){this.modalCtrl.dismiss()}};s.\u0275fac=function(n){return new(n||s)(O(me),O(xt),O(qe))},s.\u0275cmp=V({type:s,selectors:[["app-record-payment"]],inputs:{member:"member"},decls:56,vars:18,consts:[["color","primary"],["slot","end"],[3,"click"],[1,"ion-padding"],["position","stacked"],["id","paymentDate",3,"value"],["trigger","paymentDate"],["type","number","placeholder","Enter amount",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value","Cash"],["value","Card"],["value","UPI"],["id","periodStart",3,"value"],["trigger","periodStart"],["id","periodEnd",3,"value"],["trigger","periodEnd"],["placeholder","Add notes (optional)",3,"ngModelChange","ngModel"],["expand","block",3,"click","disabled"],["presentation","date","locale","en-US",3,"ngModelChange","ngModel","showDefaultButtons"]],template:function(n,e){n&1&&(i(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),c(3,"Record Payment"),r(),i(4,"ion-buttons",1)(5,"ion-button",2),b("click",function(){return e.dismiss()}),c(6,"Close"),r()()()(),i(7,"ion-content",3)(8,"ion-list")(9,"ion-item")(10,"ion-label"),c(11,"Member"),r(),i(12,"ion-text"),c(13),r()(),i(14,"ion-item")(15,"ion-label",4),c(16,"Payment Date"),r(),M(17,"ion-input",5),$(18,"date"),i(19,"ion-popover",6),w(20,kt,1,2,"ng-template"),r()(),i(21,"ion-item")(22,"ion-label",4),c(23,"Amount"),r(),i(24,"ion-input",7),x("ngModelChange",function(l){return y(e.payment.amount,l)||(e.payment.amount=l),l}),r()(),i(25,"ion-item")(26,"ion-label",4),c(27,"Payment Type"),r(),i(28,"ion-select",8),x("ngModelChange",function(l){return y(e.payment.paymentType,l)||(e.payment.paymentType=l),l}),i(29,"ion-select-option",9),c(30,"Cash"),r(),i(31,"ion-select-option",10),c(32,"Card"),r(),i(33,"ion-select-option",11),c(34,"UPI"),r()()(),i(35,"ion-item")(36,"ion-label",4),c(37,"Period Start"),r(),M(38,"ion-input",12),$(39,"date"),i(40,"ion-popover",13),w(41,Dt,1,2,"ng-template"),r()(),i(42,"ion-item")(43,"ion-label",4),c(44,"Period End"),r(),M(45,"ion-input",14),$(46,"date"),i(47,"ion-popover",15),w(48,Nt,1,2,"ng-template"),r()(),i(49,"ion-item")(50,"ion-label",4),c(51,"Notes"),r(),i(52,"ion-textarea",16),x("ngModelChange",function(l){return y(e.payment.notes,l)||(e.payment.notes=l),l}),r()()(),i(53,"div",3)(54,"ion-button",17),b("click",function(){return e.recordPayment()}),c(55," Record Payment "),r()()()),n&2&&(d(13),X("",e.member.firstName," ",e.member.lastName,""),d(4),K("value",ee(18,9,e.payment.date,"dd MMM yyyy")),d(7),f("ngModel",e.payment.amount),d(4),f("ngModel",e.payment.paymentType),d(10),K("value",ee(39,12,e.payment.periodStart,"dd MMM yyyy")),d(7),K("value",ee(46,15,e.payment.periodEnd,"dd MMM yyyy")),d(7),f("ngModel",e.payment.notes),d(2),g("disabled",!e.isValid()))},dependencies:[W,Ie,j,A,B,re,ce,le,oe,se,ae,F,de,R,Xe,ze,Ge,Ze,ie,z,Ne],styles:["[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{--background: var(--ion-background-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent;--border-color: var(--ion-color-step-150)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--background: transparent;--padding-start: 12px;--color: var(--ion-text-color);margin-top:4px}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]::part(native), [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]::part(native), [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]::part(native){background:transparent;color:var(--ion-text-color);padding-left:0}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--ion-text-color);opacity:.8}[_nghost-%COMP%]   ion-text[_ngcontent-%COMP%]{font-weight:500;margin-inline-start:8px;color:var(--ion-text-color)}[_nghost-%COMP%]   ion-datetime[_ngcontent-%COMP%]{--background: var(--ion-background-color);padding:16px;border-radius:8px;color:var(--ion-text-color)}[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{background:transparent}[_nghost-%COMP%]   ion-popover[_ngcontent-%COMP%]{--background: var(--ion-background-color)}[_nghost-%COMP%]   ion-popover[_ngcontent-%COMP%]   ion-datetime[_ngcontent-%COMP%]{background:var(--ion-background-color)}"]});let a=s;return a})();var Ce=(()=>{let s=class s{static openDB(){return new Promise((t,n)=>{let e=indexedDB.open(s.dbName,1);e.onupgradeneeded=o=>{let l=o.target.result;l.objectStoreNames.contains(s.storeName)||l.createObjectStore(s.storeName,{keyPath:"id"})},e.onsuccess=()=>t(e.result),e.onerror=()=>n(e.error)})}static getAll(){return C(this,null,function*(){let t=yield s.openDB();return new Promise((n,e)=>{let p=t.transaction(s.storeName,"readonly").objectStore(s.storeName).getAll();p.onsuccess=()=>n(p.result),p.onerror=()=>e(p.error)})})}static setAll(t){return C(this,null,function*(){let n=yield s.openDB();return new Promise((e,o)=>{var I;let l=n.transaction(s.storeName,"readwrite"),p=l.objectStore(s.storeName);p.clear();for(let P of t){let H=J(q({},P),{id:(I=P.ID)!=null?I:P.id});p.put(H)}l.oncomplete=()=>e(),l.onerror=()=>o(l.error)})})}};s.dbName="PlayMateDB",s.storeName="members";let a=s;return a})();var Me=(()=>{let s=class s{constructor(t,n,e){this.http=t,this.authService=n,this.clubContext=e,this.apiUrl=pe.apiUrl}getRequestPayload(e){return C(this,arguments,function*(t,n={}){let o=yield this.authService.getAuthToken();return{action:t,payload:n,authorization:o?"Bearer "+o:void 0}})}getMembers(){let t=S(Ce.getAll()).pipe(G(()=>fe([]))),n=S(this.authService.getAuthToken()).pipe(T(e=>{let o=this.clubContext.getSportsClubId()||"",l=new L().set("sportsClubId",o).set("action","getMembers").set("authorization",e?"Bearer "+e:""),I={headers:new k({"Content-Type":"text/plain;charset=utf-8"}),params:l,responseType:"json",observe:"body"};return this.http.get(this.apiUrl,I).pipe(D(P=>{var H;if(P.status==="error")throw new Error((H=P.error)==null?void 0:H.message);return P.data||[]}),T(P=>S(Ce.setAll(P)).pipe(D(()=>P))),G(P=>{throw console.error("Error fetching members:",P),P}))}));return ye(t,n)}searchMembers(t){return S(this.authService.getAuthToken()).pipe(T(n=>{let e=new L().set("action","getMembers").set("payload",JSON.stringify({filters:{searchTerm:t}})).set("authorization",n?"Bearer "+n:""),l={headers:new k({"Content-Type":"text/plain;charset=utf-8"}),params:e,responseType:"json",observe:"body"};return this.http.get(this.apiUrl,l).pipe(D(p=>{var I;if(p.status==="error")throw new Error((I=p.error)==null?void 0:I.message);return p.data||[]}),G(p=>{throw console.error("Error searching members:",p),p}))}))}addMember(t){return S(this.getRequestPayload("addMember",t)).pipe(T(n=>{let e=new L().set("action","addMember").set("payload",JSON.stringify(n));return this.http.post(this.apiUrl,null,{params:e,headers:new k({"Content-Type":"text/plain;charset=utf-8"})}).pipe(D(o=>{if(o.status==="success"&&o.data)return o.data;throw new Error("Failed to add member")}))}))}updateMember(t){return S(this.getRequestPayload("updateMember",t)).pipe(T(n=>{let o={headers:new k({"Content-Type":"text/plain;charset=utf-8"}),responseType:"json",observe:"body"};return this.http.post(this.apiUrl,n,o).pipe(D(l=>{var p;if(l.status==="error")throw new Error((p=l.error)==null?void 0:p.message);return l.data}))}))}deleteMember(t){return S(this.getRequestPayload("deleteMember",{memberId:t})).pipe(T(n=>{let o={headers:new k({"Content-Type":"text/plain;charset=utf-8"}),responseType:"json",observe:"body"};return this.http.post(this.apiUrl,n,o).pipe(D(l=>{var p;if(l.status==="error")throw new Error((p=l.error)==null?void 0:p.message);return l.data||!1}))}))}};s.\u0275fac=function(n){return new(n||s)(E(ne),E(ge),E(he))},s.\u0275prov=Y({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();function Wt(a,s){a&1&&M(0,"ion-spinner",31)}function Lt(a,s){if(a&1&&(i(0,"ion-text",32),c(1),r()),a&2){let m=h();d(),N(" Showing ",m.filteredMembers.length," members ")}}function At(a,s){a&1&&M(0,"ion-spinner")}function Bt(a,s){if(a&1&&(i(0,"ion-text",33),c(1),r()),a&2){let m=h();d(),Q(m.error)}}function jt(a,s){if(a&1&&M(0,"ion-icon",34),a&2){let m=h();g("name",m.sortDirection==="asc"?"arrow-up-outline":"arrow-down-outline")}}function Rt(a,s){if(a&1&&M(0,"ion-icon",34),a&2){let m=h();g("name",m.sortDirection==="asc"?"arrow-up-outline":"arrow-down-outline")}}function Ft(a,s){if(a&1&&M(0,"ion-icon",34),a&2){let m=h();g("name",m.sortDirection==="asc"?"arrow-up-outline":"arrow-down-outline")}}function zt(a,s){if(a&1){let m=v();i(0,"ion-card",36)(1,"ion-card-content",37)(2,"div",38)(3,"div",39)(4,"strong"),c(5),r(),i(6,"small",40),c(7),r()(),i(8,"div"),c(9),r(),i(10,"div"),c(11),r()(),i(12,"div",41)(13,"ion-button",42),b("click",function(){let n=u(m).$implicit,e=h(2);return _(e.renewMembership(n))}),M(14,"ion-icon",43),r(),i(15,"ion-button",44),b("click",function(){let n=u(m).$implicit,e=h(2);return _(e.sendPaymentReminder(n))}),M(16,"ion-icon",45),r()()()()}if(a&2){let m=s.$implicit,t=h(2);g("ngClass",t.getMembershipStatus(m.expiryDate)),d(5),X("",m.firstName," ",m.lastName,""),d(2),N("ID: ",m.id,""),d(2),N("Phone: ",m.phone||"N/A",""),d(2),N("Expires: ",t.formatDate(m.expiryDate),"")}}function Ut(a,s){if(a&1&&(xe(0),w(1,zt,17,6,"ion-card",35),Pe()),a&2){let m=h();d(),g("ngForOf",m.filteredMembers)}}function Ht(a,s){a&1&&(i(0,"p"),c(1,"Try adjusting your search criteria"),r())}function qt(a,s){a&1&&(i(0,"p"),c(1,"Add new members to see them listed here"),r())}function Jt(a,s){if(a&1){let m=v();i(0,"div",46),M(1,"ion-icon",47),i(2,"h3"),c(3,"No members found"),r(),w(4,Ht,2,0,"p",18)(5,qt,2,0,"p",18),i(6,"ion-button",28),b("click",function(){u(m);let n=h();return _(n.addMember())}),c(7,"Add Member"),r()()}if(a&2){let m=h();d(4),g("ngIf",m.searchTerm),d(),g("ngIf",!m.searchTerm)}}var kn=(()=>{let s=class s{constructor(t,n,e,o,l){this.memberService=t,this.alertController=n,this.toastController=e,this.translateService=o,this.modalController=l,this.members=[],this.filteredMembers=[],this.searchTerm="",this.sortOption="name",this.sortDirection="asc",this.selectedSegment="all",this.loading=!1,this.isLoading=!1,this.error=null,this.isSearchVisible=!1,this.translateService.addLangs(["en","ta"]),this.translateService.setDefaultLang("en");let p=navigator.language;this.translateService.use(p.match(/en|ta/)?p:"en"),tt({addOutline:nt,personOutline:ht,calendarOutline:rt,timeOutline:Mt,refreshOutline:ut,logoWhatsapp:mt,peopleOutline:pt,personAddOutline:gt,createOutline:lt,trashOutline:bt,mailOutline:dt,callOutline:at,footballOutline:ct,arrowUpOutline:ot,arrowDownOutline:it,searchOutline:_t,closeOutline:st})}ngOnInit(){this.loadMembers()}toggleSearch(){this.isSearchVisible=!this.isSearchVisible,this.isSearchVisible||(this.searchTerm="",this.filterMembers())}loadMembers(){this.loading=!0,this.isLoading=!0,this.error=null,this.memberService.getMembers().subscribe({next:t=>{this.members=t,this.filteredMembers=[...t],this.sortMembers(),this.loading=!1,this.isLoading=!1},error:t=>{this.error="Error loading members",this.loading=!1,this.isLoading=!1,console.error("Error loading members:",t)}})}searchMembers(t){this.searchTerm=t.target.value||"",this.filterMembers()}filterMembers(){var n;let t=[...this.members];if((n=this.searchTerm)!=null&&n.trim()){let e=this.searchTerm.toLowerCase().trim();t=t.filter(o=>o.firstName&&o.firstName.toLowerCase().includes(e)||o.lastName&&o.lastName.toLowerCase().includes(e)||o.phone&&String(o.phone).toLowerCase().includes(e))}this.selectedSegment!=="all"&&(t=t.filter(e=>{let o=this.getMembershipStatus(e.expiryDate);return this.selectedSegment===o})),this.filteredMembers=t,this.sortMembers()}segmentChanged(t){this.selectedSegment=t.detail.value,this.filterMembers()}sortMembers(){this.filteredMembers.sort((t,n)=>{let e,o;switch(this.sortOption){case"name":e=`${t.firstName} ${t.lastName}`.toLowerCase(),o=`${n.firstName} ${n.lastName}`.toLowerCase();break;case"expiryDate":e=new Date(t.expiryDate).getTime(),o=new Date(n.expiryDate).getTime();break;case"createdDate":e=new Date(t.createdDate).getTime(),o=new Date(n.createdDate).getTime();break;default:e=`${t.firstName} ${t.lastName}`.toLowerCase(),o=`${n.firstName} ${n.lastName}`.toLowerCase()}return this.sortDirection==="asc"?e>o?1:-1:e<o?1:-1})}changeSortOption(t){this.sortOption===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortOption=t,this.sortDirection="asc"),this.sortMembers()}formatDate(t){if(!t)return"N/A";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return t}}getRemainingDays(t){if(!t)return 0;let n=new Date(t),e=new Date,o=n.getTime()-e.getTime();return Math.ceil(o/(1e3*3600*24))}getMembershipStatus(t){let n=this.getRemainingDays(t);return n<=0?"expired":n<=7?"expiring":"active"}sendPaymentReminder(t){return C(this,null,function*(){let n=this.formatDate(t.expiryDate),e=`Hi ${t.firstName}, your gym membership expires on ${n}. Please renew your membership to continue enjoying our services.`,o=`https://wa.me/${t.phone}?text=${encodeURIComponent(e)}`;window.open(o,"_system")})}renewMembership(t){return C(this,null,function*(){let n=yield this.modalController.create({component:Pt,componentProps:{member:t},showBackdrop:!0,backdropDismiss:!1,cssClass:"payment-modal"});n.onWillDismiss().then(e=>{var o;if(console.log("Payment modal result:",e.data),(o=e.data)!=null&&o.success){let l=this.members.findIndex(p=>p.id===t.id);l!==-1&&(this.members[l]=J(q({},t),{expiryDate:e.data.expiryDate,status:"active"}),this.filterMembers(),this.showToast(`Payment recorded successfully for ${t.firstName} ${t.lastName}`))}}),yield n.present()})}deleteMember(t){return C(this,null,function*(){yield(yield this.alertController.create({header:"Confirm Delete",message:`Are you sure you want to delete ${t.firstName} ${t.lastName}?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",role:"destructive",handler:()=>{this.loading=!0,this.isLoading=!0,this.memberService.deleteMember(t.id).subscribe({next:()=>{this.showToast(`${t.firstName} ${t.lastName} has been deleted`),this.loadMembers()},error:e=>{this.error="Error deleting member",this.loading=!1,this.isLoading=!1,console.error("Error deleting member:",e),this.showToast("Failed to delete member","danger")}})}}]})).present()})}addMember(){return C(this,null,function*(){let t=yield this.modalController.create({component:yt,componentProps:{},showBackdrop:!0,backdropDismiss:!1,cssClass:"add-member-modal"});t.onWillDismiss().then(n=>{let e=n.data;e&&e.member&&(this.loading=!0,this.isLoading=!0,this.memberService.addMember(e.member).subscribe({next:()=>{this.showToast("Member added successfully"),this.loadMembers()},error:o=>{console.error("Error adding member:",o),this.showToast("Failed to add member","danger"),this.loading=!1,this.isLoading=!1}}))}),yield t.present()})}editMember(t){return C(this,null,function*(){})}openWhatsApp(t){return C(this,null,function*(){if(!t.phone){let P=yield this.translateService.get("whatsapp.noPhone").toPromise();this.showToast(P,"warning");return}let n=t.phone.toString().replace(/\s+/g,"").replace(/-/g,"");n.startsWith("+")||(n=n.replace(/^0+/,""),n.startsWith("91")||(n="91"+n));let e=this.getMembershipStatus(t.expiryDate),o={name:`${t.firstName} ${t.lastName}`,date:this.formatDate(t.expiryDate),days:this.getRemainingDays(t.expiryDate).toString()},l=yield this.translateService.get(`whatsapp.${e}`,o).toPromise(),p=encodeURIComponent(l),I=`https://wa.me/${n}${l?"?text="+p:""}`;window.open(I,"_blank")})}showToast(t,n="success"){return C(this,null,function*(){yield(yield this.toastController.create({message:t,duration:2e3,color:n,position:"bottom"})).present()})}loadMore(t){t.target.complete()}toggleSortDirection(){this.sortDirection=this.sortDirection==="asc"?"desc":"asc",this.sortMembers()}};s.\u0275fac=function(n){return new(n||s)(O(Me),O(He),O(Je),O($e),O(me))},s.\u0275cmp=V({type:s,selectors:[["app-members"]],features:[Z([Me])],decls:55,vars:21,consts:[["noMembers",""],[1,"toolbar-primary"],["slot","end"],["name","dots",4,"ngIf"],[1,"btn-primary",3,"click","disabled"],["slot","icon-only","name","refresh-outline"],[1,"btn-primary",3,"click"],["slot","icon-only",3,"name"],[1,"segments-toolbar"],["mode","ios",1,"segment-enhanced",3,"ngModelChange","ionChange","ngModel"],["value","all"],["value","active"],["value","expiring"],["value","expired"],[1,"search-toolbar"],["placeholder","Search by name or phone...","debounce","300",1,"search-enhanced",3,"ngModelChange","ionInput","ionClear","ngModel"],[1,"results-count"],["color","medium",4,"ngIf"],[4,"ngIf"],["color","danger",4,"ngIf"],[1,"sort-controls"],[1,"sort-chip",3,"click"],["name","person-outline"],["class","direction-icon",3,"name",4,"ngIf"],["name","calendar-outline"],["name","time-outline"],[4,"ngIf","ngIfElse"],["vertical","bottom","horizontal","end","slot","fixed"],[3,"click"],["name","person-add-outline"],[3,"ionInfinite"],["name","dots"],["color","medium"],["color","danger"],[1,"direction-icon",3,"name"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"card-content"],[1,"member-info"],[1,"member-name"],[1,"member-id"],[1,"card-actions"],["fill","clear","color","success",1,"action-button","primary",3,"click"],["name","refresh-outline"],["fill","clear","color","primary",1,"action-button","secondary",3,"click"],["name","logo-whatsapp"],[1,"empty-state"],["name","people-outline","size","large"]],template:function(n,e){if(n&1){let o=v();i(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-title"),c(3,"Members List"),r(),i(4,"ion-buttons",2),w(5,Wt,1,0,"ion-spinner",3),i(6,"ion-button",4),b("click",function(){return u(o),_(e.loadMembers())}),M(7,"ion-icon",5),r(),i(8,"ion-button",6),b("click",function(){return u(o),_(e.toggleSearch())}),M(9,"ion-icon",7),r()()(),i(10,"ion-toolbar",8)(11,"ion-segment",9),x("ngModelChange",function(p){return u(o),y(e.selectedSegment,p)||(e.selectedSegment=p),_(p)}),b("ionChange",function(p){return u(o),_(e.segmentChanged(p))}),i(12,"ion-segment-button",10)(13,"ion-label"),c(14,"All"),r()(),i(15,"ion-segment-button",11)(16,"ion-label"),c(17,"Active"),r()(),i(18,"ion-segment-button",12)(19,"ion-label"),c(20,"Expiring"),r()(),i(21,"ion-segment-button",13)(22,"ion-label"),c(23,"Expired"),r()()()(),i(24,"ion-toolbar",14)(25,"ion-searchbar",15),x("ngModelChange",function(p){return u(o),y(e.searchTerm,p)||(e.searchTerm=p),_(p)}),b("ionInput",function(p){return u(o),_(e.searchMembers(p))})("ionClear",function(p){return u(o),_(e.searchMembers(p))}),r()()(),i(26,"ion-content")(27,"div",16),w(28,Lt,2,1,"ion-text",17)(29,At,1,0,"ion-spinner",18)(30,Bt,2,1,"ion-text",19),r(),i(31,"div",20)(32,"ion-chip",21),b("click",function(){return u(o),_(e.changeSortOption("name"))}),M(33,"ion-icon",22),i(34,"ion-label"),c(35,"Name"),r(),w(36,jt,1,1,"ion-icon",23),r(),i(37,"ion-chip",21),b("click",function(){return u(o),_(e.changeSortOption("expiryDate"))}),M(38,"ion-icon",24),i(39,"ion-label"),c(40,"Expiry Date"),r(),w(41,Rt,1,1,"ion-icon",23),r(),i(42,"ion-chip",21),b("click",function(){return u(o),_(e.changeSortOption("createdDate"))}),M(43,"ion-icon",25),i(44,"ion-label"),c(45,"Join Date"),r(),w(46,Ft,1,1,"ion-icon",23),r()(),w(47,Ut,2,1,"ng-container",26)(48,Jt,8,2,"ng-template",null,0,Oe),i(50,"ion-fab",27)(51,"ion-fab-button",28),b("click",function(){return u(o),_(e.addMember())}),M(52,"ion-icon",29),r()(),i(53,"ion-infinite-scroll",30),b("ionInfinite",function(p){return u(o),_(e.loadMore(p))}),M(54,"ion-infinite-scroll-content"),r()()}if(n&2){let o=we(49);d(5),g("ngIf",e.isLoading),d(),g("disabled",e.isLoading),d(3),g("name",e.isSearchVisible?"close-outline":"search-outline"),d(2),f("ngModel",e.selectedSegment),d(13),U("search-visible",e.isSearchVisible),d(),f("ngModel",e.searchTerm),d(3),g("ngIf",!e.loading),d(),g("ngIf",e.loading),d(),g("ngIf",e.error),d(2),U("active",e.sortOption==="name"),d(4),g("ngIf",e.sortOption==="name"),d(),U("active",e.sortOption==="expiryDate"),d(4),g("ngIf",e.sortOption==="expiryDate"),d(),U("active",e.sortOption==="createdDate"),d(4),g("ngIf",e.sortOption==="createdDate"),d(),g("ngIf",e.filteredMembers.length>0)("ngIfElse",o)}},dependencies:[W,Se,ve,te,j,A,B,et,re,ce,le,ie,R,Ye,Ke,oe,F,je,Re,Ae,Be,Ve,We,Qe,Fe,Ue,z,Le],styles:["ion-content[_ngcontent-%COMP%]{--background: var(--ion-color-light-shade)}ion-toolbar[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-right:16px;width:20px;height:20px;color:var(--ion-color-primary-contrast)}ion-searchbar[_ngcontent-%COMP%]{padding:16px;--background: var(--ion-color-light);--border-radius: 8px;--box-shadow: none}.search-toolbar[_ngcontent-%COMP%]{height:0;overflow:hidden;transition:height .3s ease;padding:0}.search-toolbar.search-visible[_ngcontent-%COMP%]{height:72px;padding:8px 16px}.segments-toolbar[_ngcontent-%COMP%]{padding:8px 16px;background:var(--ion-color-light);min-height:56px;border-bottom:1px solid var(--ion-color-light-shade)}.segments-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{--background: white;--border-radius: 8px;--border-width: 1px;--border-color: var(--ion-color-light-shade);--box-shadow: none}.segments-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--background: white;--background-checked: var(--ion-color-primary);--color: var(--ion-color-medium);--color-checked: white;--indicator-height: 0;--padding-top: 4px;--padding-bottom: 4px;--padding-start: 8px;--padding-end: 8px;font-size:13px;font-weight:500;min-height:32px;transition:all .2s ease}.segments-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]:hover{--background: var(--ion-color-light)}.segments-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:13px;font-weight:500;text-transform:none;letter-spacing:0}.segments-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]::part(indicator){border-radius:2px;margin:0 8px}.segments-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]::part(indicator-background){background:transparent}[_nghost-%COMP%]   .sort-controls[_ngcontent-%COMP%]{padding:16px;display:flex;align-items:center;gap:8px;overflow-x:auto;-webkit-overflow-scrolling:touch;background:var(--ion-color-light);border-bottom:1px solid var(--ion-color-light-shade)}[_nghost-%COMP%]   .sort-controls[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}[_nghost-%COMP%]   .sort-controls[_ngcontent-%COMP%]   .sort-chip[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s ease;margin:0;--background: white;--color: var(--ion-color-medium);--border-color: var(--ion-color-light-shade);--border-width: 2px;font-weight:500;white-space:nowrap}[_nghost-%COMP%]   .sort-controls[_ngcontent-%COMP%]   .sort-chip[_ngcontent-%COMP%]:hover{--background: var(--ion-color-light-shade);transform:translateY(-1px)}[_nghost-%COMP%]   .sort-controls[_ngcontent-%COMP%]   .sort-chip[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]:first-child{margin-right:6px;font-size:16px;color:var(--ion-color-dark);opacity:.8}[_nghost-%COMP%]   .sort-controls[_ngcontent-%COMP%]   .sort-chip[_ngcontent-%COMP%]   .direction-icon[_ngcontent-%COMP%]{margin-left:6px;font-size:14px;opacity:.8;color:var(--ion-color-dark)}[_nghost-%COMP%]   .sort-controls[_ngcontent-%COMP%]   .sort-chip.active[_ngcontent-%COMP%]{--background: var(--ion-color-primary);--color: var(--ion-color-primary-contrast);--border-color: var(--ion-color-primary);box-shadow:0 2px 8px #dc262633}[_nghost-%COMP%]   .sort-controls[_ngcontent-%COMP%]   .sort-chip.active[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]:first-child, [_nghost-%COMP%]   .sort-controls[_ngcontent-%COMP%]   .sort-chip.active[_ngcontent-%COMP%]   .direction-icon[_ngcontent-%COMP%]{color:#fff;opacity:1}[_nghost-%COMP%]   .results-count[_ngcontent-%COMP%]{padding:8px 16px;display:flex;align-items:center;gap:8px;background:var(--ion-color-light);border-bottom:1px solid var(--ion-color-light-shade);font-size:14px;font-weight:500}[_nghost-%COMP%]   .results-count[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{color:var(--ion-color-medium)!important}[_nghost-%COMP%]   .results-count[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:16px;height:16px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]{margin:8px 16px;border-radius:12px;background:var(--ion-color-light);box-shadow:0 2px 8px #0000000f;overflow:hidden;transition:transform .2s ease,box-shadow .2s ease}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]:active{transform:scale(.98)}[_nghost-%COMP%]   ion-card.active[_ngcontent-%COMP%]{border-left:4px solid var(--ion-color-success)}[_nghost-%COMP%]   ion-card.expiring[_ngcontent-%COMP%]{border-left:4px solid var(--ion-color-warning)}[_nghost-%COMP%]   ion-card.expired[_ngcontent-%COMP%]{border-left:4px solid var(--ion-color-danger)}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;gap:16px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .member-info[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .member-info[_ngcontent-%COMP%]   .member-name[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin-bottom:8px;color:var(--ion-color-dark);display:flex;align-items:center;gap:8px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .member-info[_ngcontent-%COMP%]   .member-name[_ngcontent-%COMP%]   .member-id[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.8em;padding:2px 6px;background:var(--ion-color-light);border-radius:4px;font-weight:400}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .member-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:4px;font-size:14px;color:var(--ion-color-medium);display:flex;align-items:center;gap:6px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .member-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px;min-width:16px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .card-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;min-width:fit-content}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .card-actions[_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;margin:0;height:36px;width:36px;display:flex;align-items:center;justify-content:center;--border-radius: 8px;--background: transparent;--ripple-color: currentColor}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .card-actions[_ngcontent-%COMP%]   .action-button.primary[_ngcontent-%COMP%]{--color: var(--ion-color-success)}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .card-actions[_ngcontent-%COMP%]   .action-button.secondary[_ngcontent-%COMP%]{--color: var(--ion-color-primary)}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .card-actions[_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .card-actions[_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]:hover{--background: rgba(var(--ion-color-medium-rgb), .1)}[_nghost-%COMP%]   .empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:48px 32px;color:var(--ion-color-medium)}[_nghost-%COMP%]   .empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:72px;margin-bottom:24px;opacity:.8}[_nghost-%COMP%]   .empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:500;color:var(--ion-color-dark)}[_nghost-%COMP%]   .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:12px 0 24px;font-size:16px;line-height:1.4;max-width:300px}[_nghost-%COMP%]   .empty-state[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-start: 24px;--padding-end: 24px}ion-toolbar.toolbar-primary[_ngcontent-%COMP%]{--background: var(--ion-color-primary);--color: var(--ion-color-primary-contrast);--border-color: var(--ion-color-primary-shade)}ion-segment.segment-enhanced[_ngcontent-%COMP%]{--background: var(--ion-segment-background);--color: var(--ion-segment-color);--color-checked: var(--ion-segment-color-checked);border-radius:8px;padding:4px}ion-searchbar.search-enhanced[_ngcontent-%COMP%]{--background: var(--ion-input-background);--color: var(--ion-input-color);--border-radius: 8px;--box-shadow: 0 2px 8px rgba(0, 0, 0, .1)}@media (max-width: 576px){[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]{margin:8px;border-radius:10px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{padding:12px;gap:12px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .member-info[_ngcontent-%COMP%]   .member-name[_ngcontent-%COMP%]{font-size:15px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .member-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:13px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   .card-actions[_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]{height:32px;font-size:13px}}@media (max-width: 576px){.segments-toolbar[_ngcontent-%COMP%]{padding:6px 12px;min-height:48px}.segments-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--padding-top: 6px;--padding-bottom: 6px;--padding-start: 8px;--padding-end: 8px;min-height:36px;font-size:13px}.segments-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.4px}}"]});let a=s;return a})();export{kn as MembersPage};
