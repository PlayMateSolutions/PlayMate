import{a as je,c as Te}from"./chunk-KJMIWNEL.js";import{a as ze}from"./chunk-ANJFAB2F.js";import{a as Ve}from"./chunk-CJFFUTGN.js";import{b as Pe}from"./chunk-H3HPFPIS.js";import{a as Be}from"./chunk-NSC747XG.js";import{a as Ee,b as Re,c as H,d as ke,e as g,f as Ne}from"./chunk-V35AP3B2.js";import"./chunk-T47TWMLD.js";import"./chunk-P5NOT2UF.js";import{D as Le,F as Fe,L as He,a as N,j as De,m as Oe,y as $e}from"./chunk-H4ZQA4TM.js";import"./chunk-4D53AV6Y.js";import{$a as k,$b as Se,A as m,Ca as A,D as Y,Da as j,Eb as D,Fa as re,G as Z,Gb as de,H as ee,Jb as he,Kb as ge,La as T,Mb as ve,Nb as Ie,Oa as P,P as te,Q as v,R as a,Ra as E,T as b,Ta as se,U as ie,Ub as Ce,Wa as R,Xa as ae,Xb as be,Y as S,Ya as ce,Za as me,_ as I,_a as le,_b as O,aa as s,ab as h,ba as c,bc as $,ca as u,cb as pe,cc as L,db as ue,dc as _e,eb as fe,ga as oe,h as W,ia as d,j as J,ja as w,nc as ye,oc as xe,q as K,rc as F,sa as f,sc as Me,t as Q,ta as V,vc as we,wc as Ae,x as C,y as X,yc as _,za as ne}from"./chunk-3P3VKWVM.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h as z,i as p}from"./chunk-OYAVQN5W.js";var Ue=(()=>{let e=class e{http;prefix;suffix;constructor(i,o="/assets/i18n/",n=".json"){this.http=i,this.prefix=o,this.suffix=n}getTranslation(i){return this.http.get(`${this.prefix}${i}${this.suffix}`)}};z(e,"\u0275fac",function(o){return new(o||e)(m(R),m(String),m(String))}),z(e,"\u0275prov",C({token:e,factory:e.\u0275fac}));let t=e;return t})();var B=(()=>{let e=class e{constructor(i,o){this.authService=i,this.router=o}canActivate(){return this.authService.isAuthenticated$.pipe(Q(1),J(i=>i?!0:(this.router.navigate(["/login"]),!1)))}};e.\u0275fac=function(o){return new(o||e)(m(g),m(h))},e.\u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var qe=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",loadComponent:()=>import("./chunk-TBDWJ5SD.js").then(t=>t.LoginPage)},{path:"settings",canActivate:[B],loadComponent:()=>import("./chunk-RYUSC36L.js").then(t=>t.SettingsPage)},{path:"attendance-details",canActivate:[B],loadComponent:()=>import("./chunk-DG6KVP4F.js").then(t=>t.AttendanceDetailsPage)},{path:"tabs",canActivate:[B],loadChildren:()=>import("./chunk-Z2F7D2UX.js").then(t=>t.routes)}];N({peopleOutline:Le,cashOutline:Oe,calendarOutline:De,settingsOutline:He});var Ge=(()=>{let e=class e{constructor(i,o){this.router=i,this.menu=o}navigate(i){return p(this,null,function*(){yield this.menu.close(),yield this.router.navigate([i])})}};e.\u0275fac=function(o){return new(o||e)(a(h),a(we))},e.\u0275cmp=b({type:e,selectors:[["app-menu"]],decls:26,vars:0,consts:[["contentId","main-content"],["color","primary"],["button","","detail","",3,"click"],["slot","start","name","people-outline"],["slot","start","name","cash-outline"],["slot","start","name","calendar-outline"],["slot","start","name","settings-outline"]],template:function(o,n){o&1&&(s(0,"ion-menu",0)(1,"ion-header")(2,"ion-toolbar",1)(3,"ion-title"),f(4,"PlayMate"),c()()(),s(5,"ion-content")(6,"ion-list")(7,"ion-item",2),d("click",function(){return n.navigate("/tabs/members")}),u(8,"ion-icon",3),s(9,"ion-label"),f(10,"Members"),c()(),s(11,"ion-item",2),d("click",function(){return n.navigate("/tabs/payments")}),u(12,"ion-icon",4),s(13,"ion-label"),f(14,"Payments"),c()(),s(15,"ion-item",2),d("click",function(){return n.navigate("/tabs/attendance")}),u(16,"ion-icon",5),s(17,"ion-label"),f(18,"Attendance"),c()(),s(19,"ion-item-divider")(20,"ion-label"),f(21,"Admin"),c()(),s(22,"ion-item",2),d("click",function(){return n.navigate("/settings")}),u(23,"ion-icon",6),s(24,"ion-label"),f(25,"Settings"),c()()()()())},dependencies:[_e,be,xe,ye,Ce,L,O,_,$,Se],encapsulation:2});let t=e;return t})();var We=(()=>{let e=class e{constructor(i,o,n){this.toastController=i,this.router=o,this.authService=n}intercept(i,o){return o.handle(i).pipe(K(n=>{var x,M;let r="An error occurred";return n.error instanceof ErrorEvent?r=`Error: ${n.error.message}`:n.status===401?(this.authService.logout(),this.router.navigate(["/login"]),r="Session expired. Please log in again."):(M=(x=n.error)==null?void 0:x.error)!=null&&M.message?r=n.error.error.message:r=`Error Code: ${n.status}
Message: ${n.message}`,this.presentErrorToast(r),W(()=>n)}))}presentErrorToast(i){return p(this,null,function*(){yield(yield this.toastController.create({message:i,duration:3e3,position:"bottom",color:"danger",buttons:[{text:"Dismiss",role:"cancel"}]})).present()})}};e.\u0275fac=function(o){return new(o||e)(m(Ae),m(h),m(g))},e.\u0275prov=C({token:e,factory:e.\u0275fac});let t=e;return t})();function et(t,e){if(t&1&&(s(0,"ion-item")(1,"ion-label")(2,"h2"),f(3),c(),s(4,"p"),f(5),c()()()),t&2){let l=e.ngIf;v(3),V(l.name),v(2),V(l.email)}}var Je=(()=>{let e=class e{constructor(i,o){this.authService=i,this.popoverController=o,this.userSession$=this.authService.userSession$}logout(){this.popoverController.dismiss(null,"logout")}};e.\u0275fac=function(o){return new(o||e)(a(g),a(F))},e.\u0275cmp=b({type:e,selectors:[["app-profile-menu"]],decls:7,vars:3,consts:[[4,"ngIf"],["button","",3,"click"],["slot","start","name","log-out-outline"]],template:function(o,n){o&1&&(s(0,"ion-list"),S(1,et,6,2,"ion-item",0),A(2,"async"),s(3,"ion-item",1),d("click",function(){return n.logout()}),u(4,"ion-icon",2),s(5,"ion-label"),f(6,"Logout"),c()()()),o&2&&(v(),I("ngIf",j(2,1,n.userSession$)))},dependencies:[E,T,P,L,O,$,_],styles:["ion-list[_ngcontent-%COMP%]{margin:0;padding:0}h2[_ngcontent-%COMP%]{font-weight:500;margin:0}p[_ngcontent-%COMP%]{margin:4px 0 0;color:var(--ion-color-medium)}"]});let t=e;return t})();function tt(t,e){if(t&1&&u(0,"img",8),t&2){let l=w().ngIf;I("src",l.picture,te)}}function it(t,e){t&1&&u(0,"ion-icon",9)}function ot(t,e){if(t&1){let l=oe();s(0,"ion-buttons",3)(1,"ion-button",4),d("click",function(o){Z(l);let n=w(2);return ee(n.showProfileMenu(o))}),s(2,"ion-avatar",5),S(3,tt,1,1,"img",6)(4,it,1,0,"ion-icon",7),c()()()}if(t&2){let l=e.ngIf;v(3),I("ngIf",l.picture),v(),I("ngIf",!l.picture)}}function nt(t,e){if(t&1&&(S(0,ot,5,2,"ion-buttons",2),A(1,"async")),t&2){let l=w();I("ngIf",j(1,1,l.userSession$))}}var Ke=(()=>{let e=class e{constructor(i,o,n,r,x,M,Xe,Ye){this.authService=i,this.router=o,this.popoverController=n,this.route=r,this.clubContext=x,this.memberService=M,this.attendanceService=Xe,this.paymentService=Ye,N({personCircleOutline:Fe,logOutOutline:$e}),this.userSession$=this.authService.userSession$}refreshAll(){let i=this.clubContext.getLastMemberRefresh(),o=new Date,n=12*60*60*1e3;console.log("[AppComponent] Last member refresh:",i),(!i||o.getTime()-new Date(i).getTime()>n)&&(console.log("[AppComponent] Refreshing members (last refresh > 12h or never)"),this.memberService.refreshMembers().subscribe({next:()=>{console.log("[AppComponent] Members refreshed, now refreshing attendance and payments in parallel"),this.attendanceService.refreshData().catch(r=>console.error("Error refreshing attendance:",r)),this.paymentService.refreshData().catch(r=>console.error("Error refreshing payments:",r))},error:r=>console.error("Error refreshing members:",r)}))}ngOnInit(){return p(this,null,function*(){try{yield Re.initialize({google:{webClientId:Ee.googleSignInClientId}})}catch(i){console.error("Failed to initialize Social Login:",i)}this.authService.isAuthenticated$.subscribe(i=>p(this,null,function*(){if(i){let o=this.router.url;this.route.queryParams.subscribe(n=>p(this,null,function*(){let r=n.sportsClubId;r&&this.clubContext.setSportsClubId(r),!this.clubContext.getSportsClubId()&&!o.includes("/settings")&&(yield this.router.navigate(["/settings"]))}))}})),this.refreshAll()})}showProfileMenu(i){return p(this,null,function*(){let o=yield this.popoverController.create({component:Je,event:i,translucent:!0});yield o.present();let{role:n}=yield o.onWillDismiss();n==="logout"&&(yield this.authService.logout(),yield this.router.navigate(["/login"]))})}};e.\u0275fac=function(o){return new(o||e)(a(g),a(h),a(F),a(le),a(Ne),a(Be),a(ze),a(Ve))},e.\u0275cmp=b({type:e,selectors:[["app-root"]],features:[ne([{provide:k,useClass:D},{provide:ae,useClass:We,multi:!0}])],decls:5,vars:0,consts:[["userProfile",""],["id","main-content"],["slot","end",4,"ngIf"],["slot","end"],[3,"click"],["slot","icon-only"],[3,"src",4,"ngIf"],["name","person-circle-outline",4,"ngIf"],[3,"src"],["name","person-circle-outline"]],template:function(o,n){o&1&&(s(0,"ion-app"),u(1,"app-menu")(2,"ion-router-outlet",1),c(),S(3,nt,2,3,"ng-template",null,0,re))},dependencies:[E,T,P,he,de,ge,_,ve,Ie,me,Ge],encapsulation:2});let t=e;return t})();var Qe=(()=>{let e=class e{constructor(i){this.storage=i,this.init()}init(){return p(this,null,function*(){yield this.storage.create()})}};e.\u0275fac=function(o){return new(o||e)(m(H))},e.\u0275mod=ie({type:e}),e.\u0275inj=X({providers:[H],imports:[ke.forRoot({name:"playmate_db",driverOrder:["indexeddb","localstorage"]})]});let t=e;return t})();function rt(t){return new Ue(t,"./assets/i18n/",".json")}se(Ke,{providers:[{provide:k,useClass:D},Me(),ue(qe,fe(pe)),ce(),Pe(),Y(Qe,Te.forRoot({loader:{provide:je,useFactory:rt,deps:[R]},defaultLanguage:"en"}))]});export{rt as createTranslateLoader};
