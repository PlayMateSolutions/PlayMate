import{a as T}from"./chunk-35HGTZOU.js";import{a as g,b as h,i as m}from"./chunk-OYAVQN5W.js";var S=(()=>{let r=class r{static openDB(){return new Promise((e,o)=>{let n=indexedDB.open(r.dbName,T.version);n.onupgradeneeded=i=>{let c=i.target.result;T.onUpgrade(c)},n.onsuccess=()=>e(n.result),n.onerror=()=>o(n.error)})}static getAll(){return m(this,null,function*(){let e=yield r.openDB();return new Promise((o,n)=>{let s=e.transaction(r.storeName,"readonly").objectStore(r.storeName).getAll();s.onsuccess=()=>{let t=s.result.map(a=>h(g({},a),{date:new Date(a.date),checkInTime:new Date(a.checkInTime),checkOutTime:a.checkOutTime?new Date(a.checkOutTime):void 0}));o(t)},s.onerror=()=>n(s.error)})})}static setAll(e){return m(this,null,function*(){let o=yield r.openDB();return new Promise((n,i)=>{var l;let c=o.transaction(r.storeName,"readwrite"),s=c.objectStore(r.storeName);s.clear();for(let t of e){let a=h(g({},t),{id:(l=t.id)!=null?l:t.ID,date:new Date(t.date),checkInTime:new Date(t.checkInTime),checkOutTime:t.checkOutTime?new Date(t.checkOutTime):void 0});s.put(a)}c.oncomplete=()=>n(),c.onerror=()=>i(c.error)})})}static addRecords(e){return m(this,null,function*(){let o=yield r.openDB();return new Promise((n,i)=>{var l;let c=o.transaction(r.storeName,"readwrite"),s=c.objectStore(r.storeName);for(let t of e){let a=h(g({},t),{id:(l=t.id)!=null?l:t.ID,date:new Date(t.date),checkInTime:new Date(t.checkInTime),checkOutTime:t.checkOutTime?new Date(t.checkOutTime):void 0});s.put(a)}c.oncomplete=()=>n(),c.onerror=()=>i(c.error)})})}static getByDateRange(e,o){return m(this,null,function*(){let n=yield r.openDB();return new Promise((i,c)=>{let t=n.transaction(r.storeName,"readonly").objectStore(r.storeName).index("date"),a=IDBKeyRange.bound(e,o),d=t.getAll(a);d.onsuccess=()=>{let I=d.result.map(y=>h(g({},y),{date:new Date(y.date),checkInTime:new Date(y.checkInTime),checkOutTime:y.checkOutTime?new Date(y.checkOutTime):void 0}));i(I)},d.onerror=()=>c(d.error)})})}static getByMemberId(e){return m(this,null,function*(){let o=yield r.openDB();return new Promise((n,i)=>{let t=o.transaction(r.storeName,"readonly").objectStore(r.storeName).index("memberId").getAll(e);t.onsuccess=()=>{let d=t.result.map(u=>h(g({},u),{date:new Date(u.date),checkInTime:new Date(u.checkInTime),checkOutTime:u.checkOutTime?new Date(u.checkOutTime):void 0}));n(d)},t.onerror=()=>i(t.error)})})}static getLastAttendanceId(){return m(this,null,function*(){try{return localStorage.getItem("playmate_lastAttendanceId")}catch(e){return console.error("Error getting last attendance ID from localStorage:",e),null}})}static setLastAttendanceId(e){return m(this,null,function*(){try{localStorage.setItem("playmate_lastAttendanceId",e)}catch(o){throw console.error("Error setting last attendance ID to localStorage:",o),o}})}static getLastSyncTime(){return m(this,null,function*(){try{let e=localStorage.getItem("playmate_lastSyncTime");return e?new Date(e):null}catch(e){return console.error("Error getting last sync time from localStorage:",e),null}})}static setLastSyncTime(e){return m(this,null,function*(){try{localStorage.setItem("playmate_lastSyncTime",e.toISOString())}catch(o){throw console.error("Error setting last sync time to localStorage:",o),o}})}static clearSettings(){try{localStorage.removeItem("playmate_lastAttendanceId"),localStorage.removeItem("playmate_lastSyncTime")}catch(e){console.error("Error clearing attendance settings from localStorage:",e)}}};r.dbName="PlayMateDB",r.storeName="attendance",r.version=3;let w=r;return w})();export{S as a};
