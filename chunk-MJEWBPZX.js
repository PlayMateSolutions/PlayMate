import{a as le}from"./chunk-BK4AT5KR.js";import"./chunk-35HGTZOU.js";import{$ as s,$b as J,Bc as re,Dc as ae,H as v,I as y,Ic as ce,Jb as z,Lc as de,Ma as R,Na as E,Nb as B,Pb as Q,Qb as G,R as a,Rb as V,S as x,Sb as j,Ta as A,Tb as $,U as w,Ub as H,Wb as U,Z as p,Zb as q,_b as K,ab as k,ac as W,bc as X,ca as r,cb as F,da as c,dc as Y,ea as _,ec as Z,ed as se,ia as D,ic as ee,ka as I,la as u,mc as te,pc as ne,qc as ie,rb as L,rc as oe,tb as N,ua as l,va as P,wa as f}from"./chunk-AAX3YNDZ.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as O,b as S,i as T}from"./chunk-OYAVQN5W.js";function ge(t,d){t&1&&(r(0,"div",10),_(1,"ion-spinner",11),r(2,"ion-text",12),l(3,"Loading attendance data..."),c()())}function pe(t,d){if(t&1&&(r(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),l(3),c(),r(4,"ion-card-subtitle"),l(5),c()()()),t&2){let i=u();a(3),P(i.periodLabel),a(2),f("",i.filteredRecords.length," records")}}function ue(t,d){t&1&&(r(0,"ion-badge",26),l(1,"Expired"),c())}function he(t,d){if(t&1){let i=D();r(0,"ion-item",22),I("click",function(){let o=v(i).$implicit,n=u(3);return y(n.openMemberDetail(o))}),r(1,"ion-label"),l(2),r(3,"ion-note",23),l(4),c()(),p(5,ue,2,0,"ion-badge",24),r(6,"ion-note",25),l(7),c()()}if(t&2){let i=d.$implicit;a(2),f(" ",(i.memberId==-1?i.notes:i.memberName)||"Unknown Member"," "),a(2),f("#",i.memberId||"N/A",""),a(),s("ngIf",i.membershipStatus!=="active"),a(2),P(i.time)}}function _e(t,d){if(t&1&&(r(0,"div",17)(1,"ion-item-divider",18)(2,"ion-label"),l(3),c(),r(4,"ion-note",19),l(5),c()(),r(6,"ion-list",20),p(7,he,8,4,"ion-item",21),c()()),t&2){let i=d.$implicit;a(),s("id",i.date),a(2),P(i.records[0]==null?null:i.records[0].formattedDate),a(2),f("",i.records.length," records"),a(2),s("ngForOf",i.records)}}function fe(t,d){if(t&1){let i=D();r(0,"div",13),p(1,_e,8,4,"div",14),r(2,"ion-infinite-scroll",15),I("ionInfinite",function(o){v(i);let n=u();return y(n.loadMoreRecords(o))}),_(3,"ion-infinite-scroll-content",16),c()()}if(t&2){let i=u();a(),s("ngForOf",i.displayedGroups)}}function xe(t,d){t&1&&(r(0,"p"),l(1,"There are no attendance records for this period."),c())}function Ie(t,d){t&1&&(r(0,"p"),l(1,"No records match your search criteria."),c())}function Pe(t,d){t&1&&(r(0,"p"),l(1,"Try a different search term."),c())}function Ce(t,d){if(t&1&&(r(0,"ion-card",27)(1,"ion-card-content",28),_(2,"ion-icon",29),r(3,"ion-text",12)(4,"h3"),l(5,"No Attendance Records"),c(),p(6,xe,2,0,"p",7)(7,Ie,2,0,"p",7)(8,Pe,2,0,"p",7),c()()()),t&2){let i=u();a(6),s("ngIf",!i.searchQuery),a(),s("ngIf",i.searchQuery),a(),s("ngIf",i.searchQuery)}}var Ae=(()=>{let d=class d{constructor(e,o,n){this.route=e,this.router=o,this.navController=n,this.loading=!0,this.periodLabel="",this.period="",this.scrollToDate="",this.searchQuery="",this.startDate="",this.endDate="",this.attendanceRecords=[],this.filteredRecords=[],this.groupedRecords={},this.displayedGroups=[],this.currentPage=1,this.recordsPerPage=20,ce({listOutline:se,alertCircle:de})}ngOnInit(){this.route.queryParams.subscribe(e=>{this.periodLabel=e.periodLabel||"",this.period=e.period||"",this.startDate=e.startDate||"",this.endDate=e.endDate||"",this.scrollToDate=e.scrollToDate||"",this.searchQuery=e.searchQuery||"",this.loadAttendanceData()})}loadAttendanceData(){return T(this,null,function*(){try{this.loading=!0;let e=yield le.getAll();this.attendanceRecords=e,this.applyFilter(),this.currentPage=1,this.loadCurrentPage(),setTimeout(()=>this.scrollToActiveDate(),100)}catch(e){console.error("Error loading attendance data:",e),this.attendanceRecords=[],this.filteredRecords=[],this.groupedRecords={},this.displayedGroups=[]}finally{this.loading=!1}})}applyFilter(){let e=[...this.attendanceRecords];if(this.startDate&&this.endDate){let o=new Date(this.startDate),n=new Date(this.endDate);n.setHours(23,59,59,999),e=e.filter(g=>{let m=new Date(g.date);return m>=o&&m<=n}),console.log(`Filtered records by date range (${this.startDate} to ${this.endDate}):`,e.length)}if(this.filteredRecords=[...e],this.searchQuery){let o=this.searchQuery.toLowerCase();e=e.filter(n=>n.memberName&&n.memberName.toLowerCase().includes(o)||n.notes&&n.notes.toLowerCase().includes(o))}this.groupRecordsByDate(e)}onSearchChange(e){this.searchQuery=e.detail.value,this.applyFilter(),this.currentPage=1,this.loadCurrentPage()}loadCurrentPage(){let e=Object.keys(this.groupedRecords).sort((m,C)=>new Date(C).getTime()-new Date(m).getTime()),o=(this.currentPage-1)*this.recordsPerPage,n=o+this.recordsPerPage,g=e.slice(o,n);this.displayedGroups=g.map(m=>{let C=this.groupedRecords[m].map(h=>{let M=new Date(h.date),me=M.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),b="Not recorded";return h.checkInTime?b=new Date(h.checkInTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):h.date&&(b=M.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})),S(O({},h),{formattedDate:me,time:b})});return{date:m,records:C}})}loadMoreRecords(e){let o=Math.ceil(Object.keys(this.groupedRecords).length/this.recordsPerPage);this.currentPage<o?(this.currentPage++,this.loadCurrentPage(),e.target.complete()):(e.target.complete(),e.target.disabled=!0)}groupRecordsByDate(e){this.groupedRecords={},(e||this.attendanceRecords).forEach(n=>{let g=new Date(n.date).toISOString().split("T")[0];this.groupedRecords[g]||(this.groupedRecords[g]=[]),this.groupedRecords[g].push(n)})}scrollToActiveDate(){if(this.scrollToDate)try{let e=document.getElementById(this.scrollToDate);if(e)e.scrollIntoView({behavior:"smooth",block:"start"});else{let o=document.querySelector("ion-content");o&&o.scrollToBottom(300)}}catch(e){console.error("Error scrolling:",e)}}openMemberDetail(e){e.memberId&&e.memberId!==-1&&this.navController.navigateForward(["/tabs/members",e.memberId])}};d.\u0275fac=function(o){return new(o||d)(x(k),x(F),x(N))},d.\u0275cmp=w({type:d,selectors:[["app-attendance-details"]],decls:13,vars:7,consts:[[3,"translucent"],["color","primary"],["slot","start"],["defaultHref","/tabs/attendance"],["placeholder","Search by name",3,"ionInput","debounce"],[3,"fullscreen"],["class","loading-container",4,"ngIf"],[4,"ngIf"],["class","attendance-list",4,"ngIf"],["class","no-data-card",4,"ngIf"],[1,"loading-container"],["name","crescent"],["color","medium"],[1,"attendance-list"],["class","date-group",4,"ngFor","ngForOf"],[3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","Loading more records..."],[1,"date-group"],["sticky","true","color","light",3,"id"],["slot","end"],["lines","full"],["class","attendance-item",3,"click",4,"ngFor","ngForOf"],[1,"attendance-item",3,"click"],["color","medium",1,"id-note"],["color","danger","slot","end","class","expired-badge",4,"ngIf"],["color","medium","slot","end",1,"time-note"],["color","danger","slot","end",1,"expired-badge"],[1,"no-data-card"],[1,"no-data"],["name","list-outline","size","large","color","medium"]],template:function(o,n){o&1&&(r(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),_(3,"ion-back-button",3),c(),r(4,"ion-title"),l(5,"Attendance Details"),c()(),r(6,"ion-toolbar")(7,"ion-searchbar",4),I("ionInput",function(m){return n.onSearchChange(m)}),c()()(),r(8,"ion-content",5),p(9,ge,4,0,"div",6)(10,pe,6,2,"ion-card",7)(11,fe,4,1,"div",8)(12,Ce,9,3,"ion-card",9),c()),o&2&&(s("translucent",!0),a(7),s("debounce",500),a(),s("fullscreen",!0),a(),s("ngIf",n.loading),a(),s("ngIf",!n.loading),a(),s("ngIf",!n.loading&&n.displayedGroups.length>0),a(),s("ngIf",!n.loading&&n.displayedGroups.length===0))},dependencies:[A,R,E,L,q,oe,ie,U,Q,z,Z,W,X,Y,ne,G,V,j,H,$,te,K,J,ae,re,ee,B],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;gap:1rem}.no-data[_ngcontent-%COMP%]{text-align:center;padding:2rem;display:flex;flex-direction:column;align-items:center;gap:1rem}.no-data[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:.5rem}.no-data[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-bottom:.5rem}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium-tint);margin:.25rem 0}.no-data-card[_ngcontent-%COMP%]{margin:16px}ion-item[_ngcontent-%COMP%]{--padding-start: 16px;--inner-padding-end: 16px}ion-card[_ngcontent-%COMP%]{margin:16px}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding-bottom:12px}ion-card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600}ion-card[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{font-size:14px;color:var(--ion-color-medium)}.attendance-list[_ngcontent-%COMP%]   .date-group[_ngcontent-%COMP%]{margin-bottom:8px}.attendance-list[_ngcontent-%COMP%]   ion-item-divider[_ngcontent-%COMP%]{--background: var(--ion-color-light);--color: var(--ion-color-dark);--padding-start: 16px;--padding-end: 16px;min-height:48px;font-weight:600}.attendance-list[_ngcontent-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:.85rem;font-weight:400}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]{--padding-start: 16px;--padding-end: 8px}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;margin:0 0 4px}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:.85rem}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   ion-note.id-note[_ngcontent-%COMP%]{margin-left:8px;font-size:.8rem;opacity:.7}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   ion-note.time-note[_ngcontent-%COMP%]{margin-left:8px}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   .expired-badge[_ngcontent-%COMP%]{margin-left:auto;font-size:10px;font-weight:400;text-transform:uppercase;padding:3px 6px;border-radius:4px;margin-right:8px;--background: rgba(var(--ion-color-danger-rgb), .15);--color: var(--ion-color-danger)}"]});let t=d;return t})();export{Ae as AttendanceDetailsPage};
