import{a as lt}from"./chunk-GN4LDMEQ.js";import{a as ct}from"./chunk-TXITUJNO.js";import{a as mt}from"./chunk-NFW2BMYQ.js";import{a as it,c as ot}from"./chunk-SJT6XXND.js";import"./chunk-3EZO2L4I.js";import{f as I}from"./chunk-XT6IINF4.js";import"./chunk-T47TWMLD.js";import{a as _}from"./chunk-35HGTZOU.js";import{H as k,X as st,a as j,i as at,p as rt}from"./chunk-OMMW57FB.js";import{$ as f,B as T,Bc as nt,Ca as L,Ea as g,Fa as v,Ga as w,Na as z,Ob as G,Pb as H,Qa as N,Qb as K,R as c,Rb as U,S as E,Sa as R,Sb as V,Ta as q,U as $,Ub as W,Wb as Y,Z as P,Zb as J,c as O,ca as o,da as a,db as F,ea as u,hc as Q,ka as A,la as M,lc as X,qc as Z,rc as tt,ua as m,wa as x,y as B,zc as et}from"./chunk-QTDLHZUQ.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{i as h}from"./chunk-OYAVQN5W.js";var p=class p{static openDB(){return new Promise((n,s)=>{let t=indexedDB.open(p.dbName,_.version);t.onupgradeneeded=e=>{let i=e.target.result;_.onUpgrade(i)},t.onsuccess=()=>{n(t.result)},t.onerror=()=>{s(t.error)}})}static setAll(n){return h(this,null,function*(){let s=yield p.openDB();return new Promise((t,e)=>{let r=s.transaction(p.storeName,"readwrite").objectStore(p.storeName),d=r.clear();d.onerror=()=>e(d.error),d.onsuccess=()=>{let y=0,S=n.length;n.forEach(C=>{let D=r.add(C);D.onerror=()=>e(D.error),D.onsuccess=()=>{y++,y===S&&t()}})}})})}static addRecords(n){return h(this,null,function*(){let s=yield p.openDB();return new Promise((t,e)=>{let i=s.transaction(p.storeName,"readwrite"),r=i.objectStore(p.storeName),d=0,y=n.length;n.forEach(S=>{let C=r.put(S);C.onerror=()=>e(C.error),C.onsuccess=()=>{d++,d===y&&t()}}),i.onerror=()=>e(i.error)})})}static getAll(){return h(this,null,function*(){let n=yield p.openDB();return new Promise((s,t)=>{let r=n.transaction(p.storeName,"readonly").objectStore(p.storeName).getAll();r.onsuccess=()=>{s(r.result)},r.onerror=()=>t(r.error)})})}static getLastSyncTime(){return h(this,null,function*(){try{let n=localStorage.getItem("playmate_lastExpenseSyncTime");return n?new Date(n):null}catch(n){return console.error("Error getting last expense sync time from localStorage:",n),null}})}static setLastSyncTime(n){return h(this,null,function*(){try{localStorage.setItem("playmate_lastExpenseSyncTime",n.toISOString())}catch(s){throw console.error("Error setting last expense sync time to localStorage:",s),s}})}};p.dbName=_.dbName,p.storeName="expenses";var b=p;var dt=(()=>{let n=class n{constructor(t,e){this.api=t,this.clubContext=e,this.expensesSubject=new O([]),this.expenses$=this.expensesSubject.asObservable(),this.loadingSubject=new O(!1),this.loading$=this.loadingSubject.asObservable()}loadCachedData(){return h(this,null,function*(){try{let t=yield b.getAll();this.expensesSubject.next(t)}catch{this.expensesSubject.next([])}})}syncExpenses(){return h(this,null,function*(){this.loadingSubject.next(!0);try{let t=this.clubContext.getSportsClubId()||"",e=yield this.api.get("getExpenses",t);e.status==="success"&&Array.isArray(e.data)?(yield b.setAll(e.data),this.expensesSubject.next(e.data),yield b.setLastSyncTime(new Date)):this.expensesSubject.next([])}catch{this.expensesSubject.next([])}finally{this.loadingSubject.next(!1)}})}refreshData(){return h(this,null,function*(){yield this.syncExpenses()})}loadData(){return h(this,null,function*(){yield this.loadCachedData()})}};n.\u0275fac=function(e){return new(e||n)(T(ct),T(I))},n.\u0275prov=B({token:n,factory:n.\u0275fac,providedIn:"root"});let l=n;return l})();var gt=()=>["list"];function ft(l,n){if(l&1&&(o(0,"div",9)(1,"div",10)(2,"ion-text",11),m(3),g(4,"relativeTime"),a()()()),l&2){let s=M();c(3),x(" Last synced: ",v(4,1,s.lastPaymentSync)," ")}}function yt(l,n){if(l&1&&(o(0,"div",12)(1,"div",13)(2,"div",14),u(3,"ion-icon",15),a(),o(4,"div",16),m(5,"Total Earnings"),a(),o(6,"div",17),m(7),g(8,"async"),g(9,"number"),a(),o(10,"div",18),m(11),g(12,"async"),a(),o(13,"div",19),u(14,"ion-icon",20),a()(),o(15,"div",21)(16,"div",22),u(17,"ion-icon",23),a(),o(18,"div",16),m(19,"This Month"),a(),o(20,"div",17),m(21),g(22,"number"),a(),o(23,"div",18),m(24),a()(),o(25,"div",24)(26,"div",25),u(27,"ion-icon",15),a(),o(28,"div",16),m(29,"Total Expenses"),a(),o(30,"div",26),m(31),g(32,"number"),a(),o(33,"div",18),m(34),a(),o(35,"div",19),u(36,"ion-icon",20),a()(),o(37,"div",24)(38,"div",25),u(39,"ion-icon",23),a(),o(40,"div",16),m(41,"This Month's Expenses"),a(),o(42,"div",26),m(43),g(44,"number"),a(),o(45,"div",18),m(46),a()()()),l&2){let s,t,e=M();c(),f("routerLink",L(25,gt)),c(6),x("\u20B9",w(9,11,((s=v(8,9,e.summary$))==null?null:s.totalAmount)||0,"1.0-0"),""),c(4),x("",((t=v(12,14,e.summary$))==null?null:t.totalPayments)||0," total payments"),c(10),x("\u20B9",w(22,16,e.currentMonthEarnings,"1.0-0"),""),c(3),x("",e.currentMonthPayments," payments this month"),c(7),x("\u20B9",w(32,19,e.totalExpenses,"1.0-0"),""),c(3),x("",e.expenses.length," entries"),c(9),x("\u20B9",w(44,22,e.currentMonthExpenses,"1.0-0"),""),c(3),x("",e.currentMonthExpenseCount," entries")}}function xt(l,n){if(l&1&&(o(0,"ion-card",27)(1,"ion-card-header")(2,"ion-card-title"),m(3,"Monthly Earnings"),a()(),o(4,"ion-card-content")(5,"div",28),u(6,"google-chart",29),a()()()),l&2){let s=M();c(6),f("type",s.chartType)("data",s.chartData)("columns",s.chartColumns)("options",s.chartOptions)("height",300)}}function vt(l,n){l&1&&(o(0,"div",30)(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),u(4,"ion-skeleton-text",31),a()(),o(5,"ion-card-content"),u(6,"ion-skeleton-text",32)(7,"ion-skeleton-text",33),a()()()),l&2&&(c(4),f("animated",!0),c(2),f("animated",!0),c(),f("animated",!0))}j({refresh:k,wallet:st,calendar:at,chevronForwardOutline:rt});var Lt=(()=>{let n=class n{constructor(t,e,i,r){this.paymentService=t,this.toastController=e,this.clubContext=i,this.expenseService=r,this.loading$=this.paymentService.loading$,this.summary$=this.paymentService.summary$,this.displayedGroups=[],this.chartType=it.LineChart,this.chartColumns=["Month","Amount",{type:"string",role:"tooltip"}],this.chartData=[],this.chartOptions={backgroundColor:"transparent",colors:["#2dd36f"],chartArea:{left:60,top:20,width:"85%",height:"75%"},hAxis:{textStyle:{fontSize:12,color:"#666"},gridlines:{color:"transparent"}},vAxis:{textStyle:{fontSize:12,color:"#666"},gridlines:{color:"#e0e0e0",count:5},minValue:0},legend:{position:"none"},animation:{startup:!0,duration:1e3,easing:"out"},pointSize:5,lineWidth:2},this.currentMonthEarnings=0,this.currentMonthPayments=0,this.lastPaymentSync=null,this.expenses=[],this.totalExpenses=0,this.currentMonthExpenses=0,this.currentMonthExpenseCount=0,this.today=new Date,this.refreshing=!1,j({refresh:k}),this.lastPaymentSync=this.clubContext.getLastPaymentRefresh()}prepareChartData(t){if(!t){this.chartData=[];return}let e=Object.entries(t.monthBreakdown).map(([i,r])=>({month:i,amount:r.amount,count:r.count})).sort((i,r)=>i.month.localeCompare(r.month));this.chartData=e.map(i=>{let d=new Date(i.month+"-01").toLocaleString("default",{month:"short",year:"2-digit"});return[d,i.amount,`${d}
Amount: \u20B9${i.amount}
Payments: ${i.count}`]})}ngOnInit(){this.paymentService.payments$.subscribe(t=>{t&&this.processPayments(t)}),this.summary$.subscribe(t=>{this.prepareChartData(t)}),this.expenseService.expenses$.subscribe(t=>{this.expenses=t,this.calculateExpenses()}),this.paymentService.loadData().catch(t=>{console.error("Error initializing payments:",t)}),this.expenseService.loadData().catch(t=>{console.error("Error initializing expenses:",t)})}processPayments(t){let e=new Map,i=new Date().toISOString().substring(0,7);this.currentMonthEarnings=0,this.currentMonthPayments=0,t.forEach(r=>{let d=new Date(r.date),y=d.toISOString().substring(0,7);y===i&&(this.currentMonthEarnings+=r.amount,this.currentMonthPayments++),e.has(y)||e.set(y,{month:y,formattedDate:d.toLocaleDateString("en-US",{month:"long",year:"numeric"}),payments:[],total:0});let S=e.get(y);S.payments.push(r),S.total+=r.amount}),this.displayedGroups=Array.from(e.values()).sort((r,d)=>d.month.localeCompare(r.month))}calculateExpenses(){let t=new Date().toISOString().substring(0,7);this.totalExpenses=0,this.currentMonthExpenses=0,this.currentMonthExpenseCount=0,this.expenses.forEach(e=>{this.totalExpenses+=e.amount,e.date.substring(0,7)===t&&(this.currentMonthExpenses+=e.amount,this.currentMonthExpenseCount++)})}refreshPayments(){return h(this,null,function*(){if(!this.refreshing)try{this.refreshing=!0,console.log("Refreshing payment and expense data..."),yield Promise.all([this.paymentService.refreshData(),this.expenseService.refreshData()]),this.lastPaymentSync=this.clubContext.getLastPaymentRefresh(),console.log("Payment and expense data refreshed successfully"),yield(yield this.toastController.create({message:"Payment and expense data refreshed successfully",duration:2e3,color:"success"})).present()}catch(t){console.error("Error refreshing payment or expense data:",t),yield(yield this.toastController.create({message:"Failed to refresh payment or expense data",duration:2e3,color:"danger"})).present()}finally{this.refreshing=!1}})}showPaymentDetails(t){console.log("Show payment details:",t)}goToPaymentsList(){console.log("Navigating to payments list...")}};n.\u0275fac=function(e){return new(e||n)(E(mt),E(et),E(I),E(dt))},n.\u0275cmp=$({type:n,selectors:[["app-payments"]],decls:18,vars:13,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"click","disabled"],["slot","icon-only","name","refresh"],["class","results-row",4,"ngIf"],["class","stats-grid",4,"ngIf"],["class","chart-card",4,"ngIf"],["class","ion-padding",4,"ngIf"],[1,"results-row"],[1,"last-sync-info"],["color","medium",1,"last-sync-label"],[1,"stats-grid"],[1,"stat-card","earnings-card",3,"routerLink"],[1,"stat-icon","total-earnings",2,"background","#2dd36f","color","#fff"],["name","wallet"],[1,"stat-label"],[1,"stat-value"],[1,"stat-subtext"],[1,"view-details"],["name","chevron-forward-outline","size","small"],[1,"stat-card","earnings-card"],[1,"stat-icon","monthly-earnings",2,"background","#2dd36f","color","#fff"],["name","calendar"],[1,"stat-card","expense-card"],[1,"stat-icon",2,"background","#eb445a","color","#fff"],[1,"stat-value","expense-value"],[1,"chart-card"],[2,"display","flex","justify-content","center","align-items","center"],[3,"type","data","columns","options","height"],[1,"ion-padding"],[2,"width","60%",3,"animated"],[2,"width","100%",3,"animated"],[2,"width","80%",3,"animated"]],template:function(e,i){e&1&&(o(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),u(3,"ion-menu-button"),a(),o(4,"ion-title"),m(5,"Payments"),a(),o(6,"ion-buttons",2)(7,"ion-button",3),A("click",function(){return i.refreshPayments()}),u(8,"ion-icon",4),a()()()(),o(9,"ion-content"),P(10,ft,5,3,"div",5),g(11,"async"),P(12,yt,47,26,"div",6),g(13,"async"),P(14,xt,7,5,"ion-card",7),g(15,"async"),P(16,vt,8,3,"div",8),g(17,"async"),a()),e&2&&(c(7),f("disabled",i.refreshing),c(3),f("ngIf",!v(11,5,i.loading$)),c(2),f("ngIf",!v(13,7,i.loading$)),c(2),f("ngIf",!v(15,9,i.loading$)&&i.chartData.length>0),c(2),f("ngIf",v(17,11,i.loading$)))},dependencies:[q,z,N,R,F,J,tt,Z,Y,K,V,U,W,H,Q,X,G,nt,ot,lt],styles:[".stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px}.stat-card[_ngcontent-%COMP%]{background-color:var(--ion-card-background);border-radius:8px;padding:16px;display:flex;flex-direction:column;align-items:flex-start;box-shadow:0 4px 6px #0000001a;position:relative;transition:background-color .2s ease}.stat-card[routerLink][_ngcontent-%COMP%]{cursor:pointer}.stat-card[routerLink][_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.stat-card[_ngcontent-%COMP%]:active{background-color:#0000000d}.stat-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-bottom:12px}.stat-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#fff}.stat-icon.total-earnings[_ngcontent-%COMP%]{background-color:var(--ion-color-primary)}.stat-icon.monthly-earnings[_ngcontent-%COMP%]{background-color:var(--ion-color-success)}.stat-label[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.9rem;font-weight:500;margin-bottom:4px}.stat-value[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:var(--ion-color-success, #2dd36f)!important;margin-bottom:4px}.expense-value[_ngcontent-%COMP%]{color:#eb445a!important;font-weight:600}.stat-subtext[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.85rem}.view-details[_ngcontent-%COMP%]{position:absolute;bottom:12px;right:12px;display:flex;align-items:center;gap:4px;font-size:.8rem}.view-details[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1rem}.chart-card[_ngcontent-%COMP%]{margin:12px}.amount-note[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem}.status-badge[_ngcontent-%COMP%]{margin-left:8px;text-transform:capitalize}.last-sync-info[_ngcontent-%COMP%]{padding-right:16px;padding-top:8px;font-size:.9em;opacity:.7;vertical-align:middle;text-align:right}"]});let l=n;return l})();export{Lt as PaymentsPage};
