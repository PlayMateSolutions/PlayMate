import{a as Te,c as Pe}from"./chunk-D4PD75RB.js";import{a as Ve}from"./chunk-6J3BKTYG.js";import{a as qe}from"./chunk-QJYZMGHO.js";import{b as Re}from"./chunk-A6Q4CRRA.js";import{a as ze}from"./chunk-2JW2NRRJ.js";import{a as Ue}from"./chunk-NISGTTJR.js";import{a as Ee,b as ke,c as H,d as De,e as C,f as Be}from"./chunk-UERSP4CJ.js";import"./chunk-T47TWMLD.js";import"./chunk-P5NOT2UF.js";import"./chunk-4D53AV6Y.js";import{D as Fe,F as He,M as Ne,a as N,j as Oe,m as Le,y as $e}from"./chunk-OMMW57FB.js";import{$ as g,$a as me,$b as O,Aa as ne,Ac as y,B as m,Da as w,E as Y,Ea as j,Fb as D,Ga as re,H as Z,Hb as de,I as ee,Kb as ge,Lb as he,Ma as T,Nb as ve,Ob as Ie,Pa as P,Q as te,R as v,S as a,Sa as R,U as S,Ua as se,V as ie,Vb as Ce,Xa as E,Ya as ae,Yb as be,Z as b,Za as le,_a as ce,ab as k,ac as _e,ba as r,bb as I,ca as l,cc as L,da as u,db as pe,dc as $,eb as ue,ec as Se,fb as fe,fc as ye,h as W,ha as oe,ja as h,k as J,ka as M,pc as xe,qc as Me,r as K,ta as d,tc as F,u as Q,ua as z,uc as Ae,xc as we,y as _,yc as je,z as X}from"./chunk-7E5XZK2A.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h as U,i as p}from"./chunk-OYAVQN5W.js";var Ge=(()=>{let e=class e{http;prefix;suffix;constructor(o,i="/assets/i18n/",n=".json"){this.http=o,this.prefix=i,this.suffix=n}getTranslation(o){return this.http.get(`${this.prefix}${o}${this.suffix}`)}};U(e,"\u0275fac",function(i){return new(i||e)(m(E),m(String),m(String))}),U(e,"\u0275prov",_({token:e,factory:e.\u0275fac}));let t=e;return t})();var B=(()=>{let e=class e{constructor(o,i){this.authService=o,this.router=i}canActivate(){return this.authService.isAuthenticated$.pipe(Q(1),J(o=>o?(console.log("User is authenticated, access granted."),!0):(this.router.navigate(["/login"]),console.log("User is not authenticated, redirecting to login page."),!1)))}};e.\u0275fac=function(i){return new(i||e)(m(C),m(I))},e.\u0275prov=_({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var We=[{path:"",redirectTo:"tabs",pathMatch:"full"},{path:"login",loadComponent:()=>import("./chunk-FSKWWFJV.js").then(t=>t.LoginPage)},{path:"settings",canActivate:[B],loadComponent:()=>import("./chunk-VIOIQORV.js").then(t=>t.SettingsPage)},{path:"attendance-details",canActivate:[B],loadComponent:()=>import("./chunk-O4474YQ4.js").then(t=>t.AttendanceDetailsPage)},{path:"tabs",canActivate:[B],loadChildren:()=>import("./chunk-LVMHBCE3.js").then(t=>t.routes)}];N({peopleOutline:Fe,cashOutline:Le,calendarOutline:Oe,settingsOutline:Ne});var Je=(()=>{let e=class e{constructor(o,i){this.router=o,this.menu=i}navigate(o){return p(this,null,function*(){yield this.menu.close(),yield this.router.navigate([o])})}};e.\u0275fac=function(i){return new(i||e)(a(I),a(we))},e.\u0275cmp=S({type:e,selectors:[["app-menu"]],decls:26,vars:0,consts:[["contentId","main-content"],["color","primary"],["button","","detail","",3,"click"],["slot","start","name","people-outline"],["slot","start","name","cash-outline"],["slot","start","name","calendar-outline"],["slot","start","name","settings-outline"]],template:function(i,n){i&1&&(r(0,"ion-menu",0)(1,"ion-header")(2,"ion-toolbar",1)(3,"ion-title"),d(4,"PlayMate"),l()()(),r(5,"ion-content")(6,"ion-list")(7,"ion-item",2),h("click",function(){return n.navigate("/tabs/members")}),u(8,"ion-icon",3),r(9,"ion-label"),d(10,"Members"),l()(),r(11,"ion-item",2),h("click",function(){return n.navigate("/tabs/payments")}),u(12,"ion-icon",4),r(13,"ion-label"),d(14,"Payments"),l()(),r(15,"ion-item",2),h("click",function(){return n.navigate("/tabs/attendance")}),u(16,"ion-icon",5),r(17,"ion-label"),d(18,"Attendance"),l()(),r(19,"ion-item-divider")(20,"ion-label"),d(21,"Admin"),l()(),r(22,"ion-item",2),h("click",function(){return n.navigate("/settings")}),u(23,"ion-icon",6),r(24,"ion-label"),d(25,"Settings"),l()()()()())},dependencies:[ye,be,Me,xe,Ce,$,O,y,L,_e],encapsulation:2});let t=e;return t})();var Ke=(()=>{let e=class e{constructor(o,i,n){this.toastController=o,this.router=i,this.authService=n}intercept(o,i){return i.handle(o).pipe(K(n=>{var f,A;let s="An error occurred";return n.error instanceof ErrorEvent?s=`Error: ${n.error.message}`:n.status===401?(this.authService.logout(),this.router.navigate(["/login"]),s="Session expired. Please log in again."):(A=(f=n.error)==null?void 0:f.error)!=null&&A.message?s=n.error.error.message:s=`Error Code: ${n.status}
Message: ${n.message}`,this.presentErrorToast(s),W(()=>n)}))}presentErrorToast(o){return p(this,null,function*(){yield(yield this.toastController.create({message:o,duration:3e3,position:"bottom",color:"danger",buttons:[{text:"Dismiss",role:"cancel"}]})).present()})}};e.\u0275fac=function(i){return new(i||e)(m(je),m(I),m(C))},e.\u0275prov=_({token:e,factory:e.\u0275fac});let t=e;return t})();function ot(t,e){if(t&1&&(r(0,"ion-item")(1,"ion-label")(2,"h2"),d(3),l(),r(4,"p"),d(5),l()()()),t&2){let c=e.ngIf;v(3),z(c.name),v(2),z(c.email)}}var Qe=(()=>{let e=class e{constructor(o,i){this.authService=o,this.popoverController=i,this.userSession$=this.authService.userSession$}logout(){this.popoverController.dismiss(null,"logout")}};e.\u0275fac=function(i){return new(i||e)(a(C),a(F))},e.\u0275cmp=S({type:e,selectors:[["app-profile-menu"]],decls:7,vars:3,consts:[[4,"ngIf"],["button","",3,"click"],["slot","start","name","log-out-outline"]],template:function(i,n){i&1&&(r(0,"ion-list"),b(1,ot,6,2,"ion-item",0),w(2,"async"),r(3,"ion-item",1),h("click",function(){return n.logout()}),u(4,"ion-icon",2),r(5,"ion-label"),d(6,"Logout"),l()()()),i&2&&(v(),g("ngIf",j(2,1,n.userSession$)))},dependencies:[R,T,P,$,O,L,y],styles:["ion-list[_ngcontent-%COMP%]{margin:0;padding:0}h2[_ngcontent-%COMP%]{font-weight:500;margin:0}p[_ngcontent-%COMP%]{margin:4px 0 0;color:var(--ion-color-medium)}"]});let t=e;return t})();function nt(t,e){if(t&1&&u(0,"ion-loading",3),t&2){let c=M();g("isOpen",c.loading)}}function rt(t,e){if(t&1&&u(0,"img",10),t&2){let c=M().ngIf;g("src",c.picture,te)}}function st(t,e){t&1&&u(0,"ion-icon",11)}function at(t,e){if(t&1){let c=oe();r(0,"ion-buttons",5)(1,"ion-button",6),h("click",function(i){Z(c);let n=M(2);return ee(n.showProfileMenu(i))}),r(2,"ion-avatar",7),b(3,rt,1,1,"img",8)(4,st,1,0,"ion-icon",9),l()()()}if(t&2){let c=e.ngIf;v(3),g("ngIf",c.picture),v(),g("ngIf",!c.picture)}}function lt(t,e){if(t&1&&(b(0,at,5,2,"ion-buttons",4),w(1,"async")),t&2){let c=M();g("ngIf",j(1,1,c.userSession$))}}var Xe=(()=>{let e=class e{constructor(o,i,n,s,f,A,Ze,et,tt){this.authService=o,this.router=i,this.popoverController=n,this.route=s,this.clubContext=f,this.memberService=A,this.attendanceService=Ze,this.paymentService=et,this.appRefresher=tt,this.loading=!1,N({personCircleOutline:He,logOutOutline:$e}),this.userSession$=this.authService.userSession$,this.appRefresher.refreshAll=this.refreshAll.bind(this)}refreshAll(){return p(this,null,function*(){this.loading=!0;let o=this.clubContext.getLastMemberRefresh(),i=new Date,n=12*60*60*1e3;console.log("[AppComponent] Last member refresh:",o),!o||i.getTime()-new Date(o).getTime()>n?(console.log("[AppComponent] Refreshing members (last refresh > 12h or never)"),yield new Promise(s=>{this.memberService.refreshMembers().subscribe({next:()=>{console.log("[AppComponent] Members refreshed, now refreshing attendance and payments in parallel"),Promise.all([this.attendanceService.refreshData().catch(f=>console.error("Error refreshing attendance:",f)),this.paymentService.refreshData().catch(f=>console.error("Error refreshing payments:",f))]).finally(()=>{this.loading=!1,s()})},error:f=>{console.error("Error refreshing members:",f),this.loading=!1,s()}})})):this.loading=!1})}ngOnInit(){return p(this,null,function*(){try{yield ke.initialize({google:{webClientId:Ee.googleSignInClientId}})}catch(o){console.error("Failed to initialize Social Login:",o)}this.authService.isAuthenticated$.subscribe(o=>p(this,null,function*(){if(o){let i=this.router.url;this.route.queryParams.subscribe(n=>p(this,null,function*(){let s=n.sportsClubId;s&&this.clubContext.setSportsClubId(s),!this.clubContext.getSportsClubId()&&!i.includes("/settings")?yield this.router.navigate(["/settings"]):this.refreshAll()}))}}))})}showProfileMenu(o){return p(this,null,function*(){let i=yield this.popoverController.create({component:Qe,event:o,translucent:!0});yield i.present();let{role:n}=yield i.onWillDismiss();n==="logout"&&(yield this.authService.logout(),yield this.router.navigate(["/login"]))})}};e.\u0275fac=function(i){return new(i||e)(a(C),a(I),a(F),a(me),a(Be),a(ze),a(Ve),a(qe),a(Ue))},e.\u0275cmp=S({type:e,selectors:[["app-root"]],features:[ne([{provide:k,useClass:D},{provide:ae,useClass:Ke,multi:!0}])],decls:6,vars:1,consts:[["userProfile",""],["id","main-content"],["message","Refreshing data...","spinner","crescent","backdropDismiss","false",3,"isOpen",4,"ngIf"],["message","Refreshing data...","spinner","crescent","backdropDismiss","false",3,"isOpen"],["slot","end",4,"ngIf"],["slot","end"],[3,"click"],["slot","icon-only"],[3,"src",4,"ngIf"],["name","person-circle-outline",4,"ngIf"],[3,"src"],["name","person-circle-outline"]],template:function(i,n){i&1&&(r(0,"ion-app"),u(1,"app-menu")(2,"ion-router-outlet",1),b(3,nt,1,1,"ion-loading",2),l(),b(4,lt,2,3,"ng-template",null,0,re)),i&2&&(v(3),g("ngIf",n.loading))},dependencies:[R,T,P,ge,de,he,y,ve,Ie,ce,Je,Se],encapsulation:2});let t=e;return t})();var Ye=(()=>{let e=class e{constructor(o){this.storage=o,this.init()}init(){return p(this,null,function*(){yield this.storage.create()})}};e.\u0275fac=function(i){return new(i||e)(m(H))},e.\u0275mod=ie({type:e}),e.\u0275inj=X({providers:[H],imports:[De.forRoot({name:"playmate_db",driverOrder:["indexeddb","localstorage"]})]});let t=e;return t})();function ct(t){return new Ge(t,"./assets/i18n/",".json")}se(Xe,{providers:[{provide:k,useClass:D},Ae(),ue(We,fe(pe)),le(),Re(),Y(Ye,Pe.forRoot({loader:{provide:Te,useFactory:ct,deps:[E]},defaultLanguage:"en"}))]});export{ct as createTranslateLoader};
