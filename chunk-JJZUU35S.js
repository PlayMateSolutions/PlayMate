import{a as de}from"./chunk-BK4AT5KR.js";import"./chunk-35HGTZOU.js";import{$ as s,$b as q,Bc as ie,Dc as oe,H as O,I as M,Ic as ae,Jb as F,Kc as re,Ma as w,Na as E,Nb as N,Pb as z,Qb as B,R as a,Rb as Q,S,Sb as G,Ta as A,Tb as j,U as T,Ub as H,Wb as U,Z as p,Zb as V,_b as $,ab as k,ac as K,bc as J,ca as n,da as c,dc as W,dd as ce,ea as h,ec as X,ia as R,ic as Y,ka as C,la as f,mc as Z,pc as ee,qc as te,rb as L,rc as ne,ua as l,va as x,wa as _}from"./chunk-TS5MQKIE.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as b,b as v,i as D}from"./chunk-OYAVQN5W.js";function le(t,d){t&1&&(n(0,"div",10),h(1,"ion-spinner",11),n(2,"ion-text",12),l(3,"Loading attendance data..."),c()())}function me(t,d){if(t&1&&(n(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),l(3),c(),n(4,"ion-card-subtitle"),l(5),c()()()),t&2){let o=f();a(3),x(o.periodLabel),a(2),_("",o.filteredRecords.length," records")}}function ge(t,d){t&1&&(n(0,"ion-badge",26),l(1,"Expired"),c())}function pe(t,d){if(t&1&&(n(0,"ion-item",22)(1,"ion-label"),l(2),n(3,"ion-note",23),l(4),c()(),p(5,ge,2,0,"ion-badge",24),n(6,"ion-note",25),l(7),c()()),t&2){let o=d.$implicit;a(2),_(" ",o.memberName||"Unknown Member"," "),a(2),_("#",o.memberId||"N/A",""),a(),s("ngIf",o.membershipStatus!=="active"),a(2),x(o.time)}}function ue(t,d){if(t&1&&(n(0,"div",17)(1,"ion-item-divider",18)(2,"ion-label"),l(3),c(),n(4,"ion-note",19),l(5),c()(),n(6,"ion-list",20),p(7,pe,8,4,"ion-item",21),c()()),t&2){let o=d.$implicit;a(),s("id",o.date),a(2),x(o.records[0]==null?null:o.records[0].formattedDate),a(2),_("",o.records.length," records"),a(2),s("ngForOf",o.records)}}function he(t,d){if(t&1){let o=R();n(0,"div",13),p(1,ue,8,4,"div",14),n(2,"ion-infinite-scroll",15),C("ionInfinite",function(r){O(o);let i=f();return M(i.loadMoreRecords(r))}),h(3,"ion-infinite-scroll-content",16),c()()}if(t&2){let o=f();a(),s("ngForOf",o.displayedGroups)}}function fe(t,d){t&1&&(n(0,"p"),l(1,"There are no attendance records for this period."),c())}function _e(t,d){t&1&&(n(0,"p"),l(1,"No records match your search criteria."),c())}function xe(t,d){t&1&&(n(0,"p"),l(1,"Try a different search term."),c())}function Pe(t,d){if(t&1&&(n(0,"ion-card",27)(1,"ion-card-content",28),h(2,"ion-icon",29),n(3,"ion-text",12)(4,"h3"),l(5,"No Attendance Records"),c(),p(6,fe,2,0,"p",7)(7,_e,2,0,"p",7)(8,xe,2,0,"p",7),c()()()),t&2){let o=f();a(6),s("ngIf",!o.searchQuery),a(),s("ngIf",o.searchQuery),a(),s("ngIf",o.searchQuery)}}var Re=(()=>{let d=class d{constructor(e){this.route=e,this.loading=!0,this.periodLabel="",this.period="",this.scrollToDate="",this.searchQuery="",this.startDate="",this.endDate="",this.attendanceRecords=[],this.filteredRecords=[],this.groupedRecords={},this.displayedGroups=[],this.currentPage=1,this.recordsPerPage=20,ae({listOutline:ce,alertCircle:re})}ngOnInit(){this.route.queryParams.subscribe(e=>{this.periodLabel=e.periodLabel||"",this.period=e.period||"",this.startDate=e.startDate||"",this.endDate=e.endDate||"",this.scrollToDate=e.scrollToDate||"",this.searchQuery=e.searchQuery||"",this.loadAttendanceData()})}loadAttendanceData(){return D(this,null,function*(){try{this.loading=!0;let e=yield de.getAll();this.attendanceRecords=e,this.applyFilter(),this.currentPage=1,this.loadCurrentPage(),setTimeout(()=>this.scrollToActiveDate(),100)}catch(e){console.error("Error loading attendance data:",e),this.attendanceRecords=[],this.filteredRecords=[],this.groupedRecords={},this.displayedGroups=[]}finally{this.loading=!1}})}applyFilter(){let e=[...this.attendanceRecords];if(this.startDate&&this.endDate){let r=new Date(this.startDate),i=new Date(this.endDate);i.setHours(23,59,59,999),e=e.filter(g=>{let m=new Date(g.date);return m>=r&&m<=i}),console.log(`Filtered records by date range (${this.startDate} to ${this.endDate}):`,e.length)}if(this.filteredRecords=[...e],this.searchQuery){let r=this.searchQuery.toLowerCase();e=e.filter(i=>i.memberName&&i.memberName.toLowerCase().includes(r)||i.notes&&i.notes.toLowerCase().includes(r))}this.groupRecordsByDate(e)}onSearchChange(e){this.searchQuery=e.detail.value,this.applyFilter(),this.currentPage=1,this.loadCurrentPage()}loadCurrentPage(){let e=Object.keys(this.groupedRecords).sort((m,P)=>new Date(P).getTime()-new Date(m).getTime()),r=(this.currentPage-1)*this.recordsPerPage,i=r+this.recordsPerPage,g=e.slice(r,i);this.displayedGroups=g.map(m=>{let P=this.groupedRecords[m].map(u=>{let y=new Date(u.date),se=y.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),I="Not recorded";return u.checkInTime?I=new Date(u.checkInTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):u.date&&(I=y.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})),v(b({},u),{formattedDate:se,time:I})});return{date:m,records:P}})}loadMoreRecords(e){let r=Math.ceil(Object.keys(this.groupedRecords).length/this.recordsPerPage);this.currentPage<r?(this.currentPage++,this.loadCurrentPage(),e.target.complete()):(e.target.complete(),e.target.disabled=!0)}groupRecordsByDate(e){this.groupedRecords={},(e||this.attendanceRecords).forEach(i=>{let g=new Date(i.date).toISOString().split("T")[0];this.groupedRecords[g]||(this.groupedRecords[g]=[]),this.groupedRecords[g].push(i)})}scrollToActiveDate(){if(this.scrollToDate)try{let e=document.getElementById(this.scrollToDate);if(e)e.scrollIntoView({behavior:"smooth",block:"start"});else{let r=document.querySelector("ion-content");r&&r.scrollToBottom(300)}}catch(e){console.error("Error scrolling:",e)}}};d.\u0275fac=function(r){return new(r||d)(S(k))},d.\u0275cmp=T({type:d,selectors:[["app-attendance-details"]],decls:13,vars:7,consts:[[3,"translucent"],["color","primary"],["slot","start"],["defaultHref","/tabs/attendance"],["placeholder","Search by name",3,"ionInput","debounce"],[3,"fullscreen"],["class","loading-container",4,"ngIf"],[4,"ngIf"],["class","attendance-list",4,"ngIf"],["class","no-data-card",4,"ngIf"],[1,"loading-container"],["name","crescent"],["color","medium"],[1,"attendance-list"],["class","date-group",4,"ngFor","ngForOf"],[3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","Loading more records..."],[1,"date-group"],["sticky","true","color","light",3,"id"],["slot","end"],["lines","full"],["class","attendance-item",4,"ngFor","ngForOf"],[1,"attendance-item"],["color","medium",1,"id-note"],["color","danger","slot","end","class","expired-badge",4,"ngIf"],["color","medium","slot","end",1,"time-note"],["color","danger","slot","end",1,"expired-badge"],[1,"no-data-card"],[1,"no-data"],["name","list-outline","size","large","color","medium"]],template:function(r,i){r&1&&(n(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),h(3,"ion-back-button",3),c(),n(4,"ion-title"),l(5,"Attendance Details"),c()(),n(6,"ion-toolbar")(7,"ion-searchbar",4),C("ionInput",function(m){return i.onSearchChange(m)}),c()()(),n(8,"ion-content",5),p(9,le,4,0,"div",6)(10,me,6,2,"ion-card",7)(11,he,4,1,"div",8)(12,Pe,9,3,"ion-card",9),c()),r&2&&(s("translucent",!0),a(7),s("debounce",500),a(),s("fullscreen",!0),a(),s("ngIf",i.loading),a(),s("ngIf",!i.loading),a(),s("ngIf",!i.loading&&i.displayedGroups.length>0),a(),s("ngIf",!i.loading&&i.displayedGroups.length===0))},dependencies:[A,w,E,L,V,ne,te,U,z,F,X,K,J,W,ee,B,Q,G,H,j,Z,$,q,oe,ie,Y,N],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;gap:1rem}.no-data[_ngcontent-%COMP%]{text-align:center;padding:2rem;display:flex;flex-direction:column;align-items:center;gap:1rem}.no-data[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:.5rem}.no-data[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-bottom:.5rem}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium-tint);margin:.25rem 0}.no-data-card[_ngcontent-%COMP%]{margin:16px}ion-item[_ngcontent-%COMP%]{--padding-start: 16px;--inner-padding-end: 16px}ion-card[_ngcontent-%COMP%]{margin:16px}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding-bottom:12px}ion-card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600}ion-card[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{font-size:14px;color:var(--ion-color-medium)}.attendance-list[_ngcontent-%COMP%]   .date-group[_ngcontent-%COMP%]{margin-bottom:8px}.attendance-list[_ngcontent-%COMP%]   ion-item-divider[_ngcontent-%COMP%]{--background: var(--ion-color-light);--color: var(--ion-color-dark);--padding-start: 16px;--padding-end: 16px;min-height:48px;font-weight:600}.attendance-list[_ngcontent-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:.85rem;font-weight:400}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]{--padding-start: 16px;--padding-end: 8px}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;margin:0 0 4px}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:.85rem}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   ion-note.id-note[_ngcontent-%COMP%]{margin-left:8px;font-size:.8rem;opacity:.7}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   ion-note.time-note[_ngcontent-%COMP%]{margin-left:8px}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   .expired-badge[_ngcontent-%COMP%]{margin-left:auto;font-size:10px;font-weight:400;text-transform:uppercase;padding:3px 6px;border-radius:4px;margin-right:8px;--background: rgba(var(--ion-color-danger-rgb), .15);--color: var(--ion-color-danger)}"]});let t=d;return t})();export{Re as AttendanceDetailsPage};
