import{a as rt}from"./chunk-O6DGDSVW.js";import{a as at}from"./chunk-SNIVQ4BD.js";import"./chunk-AXP7R7SC.js";import{a as ot}from"./chunk-NIB3TDYB.js";import{a as X,c as Z}from"./chunk-6I33HUVR.js";import"./chunk-MYIHYH53.js";import{f as it}from"./chunk-J5NWP6QB.js";import"./chunk-T47TWMLD.js";import"./chunk-35HGTZOU.js";import{$ as c,Bc as Q,Ca as P,Dd as nt,Ea as d,Fa as x,Ga as E,Ic as M,Na as B,Ob as j,Pb as F,Qa as z,Qb as R,Qc as tt,R as a,Rb as N,S as v,Sa as L,Sb as G,Ta as $,U as T,Ub as H,Wb as K,Xc as et,Z as S,Zb as U,ca as e,da as n,db as A,ea as l,hc as V,ka as D,la as b,lc as W,nd as _,qc as Y,rc as q,ua as o,wa as u,zc as J}from"./chunk-TS5MQKIE.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{i as k}from"./chunk-OYAVQN5W.js";var st=()=>["list"];function lt(r,h){if(r&1&&(e(0,"div",9)(1,"div",10)(2,"ion-text",11),o(3),d(4,"relativeTime"),n()()()),r&2){let g=b();a(3),u(" Last synced: ",x(4,1,g.lastPaymentSync)," ")}}function dt(r,h){if(r&1&&(e(0,"div",12)(1,"div",13)(2,"div",14),l(3,"ion-icon",15),n(),e(4,"div",16),o(5,"Total Earnings"),n(),e(6,"div",17),o(7),d(8,"async"),d(9,"number"),n(),e(10,"div",18),o(11),d(12,"async"),n(),e(13,"div",19),l(14,"ion-icon",20),n()(),e(15,"div",21)(16,"div",22),l(17,"ion-icon",23),n(),e(18,"div",16),o(19,"This Month"),n(),e(20,"div",17),o(21),d(22,"number"),n(),e(23,"div",18),o(24),n()(),e(25,"div",24)(26,"div",25),l(27,"ion-icon",15),n(),e(28,"div",16),o(29,"Total Expenses"),n(),e(30,"div",26),o(31),d(32,"number"),n(),e(33,"div",18),o(34),n(),e(35,"div",19),l(36,"ion-icon",20),n()(),e(37,"div",27)(38,"div",25),l(39,"ion-icon",23),n(),e(40,"div",16),o(41,"This Month's Expenses"),n(),e(42,"div",26),o(43),d(44,"number"),n(),e(45,"div",18),o(46),n()()()),r&2){let g,t,i=b();a(),c("routerLink",P(26,st)),a(6),u("\u20B9",E(9,12,((g=x(8,10,i.summary$))==null?null:g.totalAmount)||0,"1.0-0"),""),a(4),u("",((t=x(12,15,i.summary$))==null?null:t.totalPayments)||0," total payments"),a(10),u("\u20B9",E(22,17,i.currentMonthEarnings,"1.0-0"),""),a(3),u("",i.currentMonthPayments," payments this month"),a(),c("routerLink",P(27,st)),a(6),u("\u20B9",E(32,20,i.totalExpenses,"1.0-0"),""),a(3),u("",i.expenses.length," entries"),a(9),u("\u20B9",E(44,23,i.currentMonthExpenses,"1.0-0"),""),a(3),u("",i.currentMonthExpenseCount," entries")}}function mt(r,h){if(r&1&&(e(0,"ion-card",28)(1,"ion-card-header")(2,"ion-card-title"),o(3,"Monthly Earnings"),n()(),e(4,"ion-card-content")(5,"div",29),l(6,"google-chart",30),n()()()),r&2){let g=b();a(6),c("type",g.chartType)("data",g.chartData)("columns",g.chartColumns)("options",g.chartOptions)("height",300)}}function pt(r,h){r&1&&(e(0,"div",31)(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),l(4,"ion-skeleton-text",32),n()(),e(5,"ion-card-content"),l(6,"ion-skeleton-text",33)(7,"ion-skeleton-text",34),n()()()),r&2&&(a(4),c("animated",!0),a(2),c("animated",!0),a(),c("animated",!0))}M({refresh:_,wallet:nt,calendar:tt,chevronForwardOutline:et});var _t=(()=>{let h=class h{constructor(t,i,s,m){this.paymentService=t,this.toastController=i,this.clubContext=s,this.expenseService=m,this.loading$=this.paymentService.loading$,this.summary$=this.paymentService.summary$,this.displayedGroups=[],this.chartType=X.LineChart,this.chartColumns=["Month","Payments","Expenses",{type:"string",role:"tooltip"}],this.chartData=[],this.chartOptions={backgroundColor:"transparent",colors:["#2dd36f","#eb445a"],chartArea:{left:60,top:20,width:"85%",height:"75%"},hAxis:{textStyle:{fontSize:12,color:"#666"},gridlines:{color:"transparent"}},vAxis:{textStyle:{fontSize:12,color:"#666"},gridlines:{color:"#e0e0e0",count:5},minValue:0},legend:{position:"top",alignment:"center",textStyle:{color:"#666"}},animation:{startup:!0,duration:1e3,easing:"out"},pointSize:5,lineWidth:2},this.currentMonthEarnings=0,this.currentMonthPayments=0,this.lastPaymentSync=null,this.expenses=[],this.totalExpenses=0,this.currentMonthExpenses=0,this.currentMonthExpenseCount=0,this.today=new Date,this.refreshing=!1,M({refresh:_}),this.lastPaymentSync=this.clubContext.getLastPaymentRefresh()}prepareChartData(t){if(!t){this.chartData=[];return}let i=Object.keys(t.monthBreakdown),s=this.expenses.map(p=>p.date.substring(0,7)),m=new Set([...i,...s]),y=Array.from(m).sort(),f={};this.expenses.forEach(p=>{let C=p.date.substring(0,7);f[C]=(f[C]||0)+p.amount}),this.chartData=y.map(p=>{var O;let I=new Date(p+"-01").toLocaleString("default",{month:"short",year:"2-digit"}),ct=((O=t.monthBreakdown[p])==null?void 0:O.amount)||0,w=f[p]||0;return[I,ct,w,`${I}
Expenses: \u20B9${w}`]})}ngOnInit(){this.paymentService.payments$.subscribe(t=>{t&&this.processPayments(t)}),this.summary$.subscribe(t=>{this.prepareChartData(t)}),this.expenseService.expenses$.subscribe(t=>{this.expenses=t,this.calculateExpenses()}),this.paymentService.loadData().catch(t=>{console.error("Error initializing payments:",t)}),this.expenseService.loadData().catch(t=>{console.error("Error initializing expenses:",t)})}processPayments(t){let i=new Map,s=new Date().toISOString().substring(0,7);this.currentMonthEarnings=0,this.currentMonthPayments=0,t.forEach(m=>{let y=new Date(m.date),f=y.toISOString().substring(0,7);f===s&&(this.currentMonthEarnings+=m.amount,this.currentMonthPayments++),i.has(f)||i.set(f,{month:f,formattedDate:y.toLocaleDateString("en-US",{month:"long",year:"numeric"}),payments:[],total:0});let p=i.get(f);p.payments.push(m),p.total+=m.amount}),this.displayedGroups=Array.from(i.values()).sort((m,y)=>y.month.localeCompare(m.month))}calculateExpenses(){let t=new Date().toISOString().substring(0,7);this.totalExpenses=0,this.currentMonthExpenses=0,this.currentMonthExpenseCount=0,this.expenses.forEach(i=>{this.totalExpenses+=i.amount,i.date.substring(0,7)===t&&(this.currentMonthExpenses+=i.amount,this.currentMonthExpenseCount++)})}refreshPayments(){return k(this,null,function*(){if(!this.refreshing)try{this.refreshing=!0,console.log("Refreshing payment and expense data..."),yield Promise.all([this.paymentService.refreshData(),this.expenseService.refreshData()]),this.lastPaymentSync=this.clubContext.getLastPaymentRefresh(),console.log("Payment and expense data refreshed successfully"),yield(yield this.toastController.create({message:"Payment and expense data refreshed successfully",duration:2e3,color:"success"})).present()}catch(t){console.error("Error refreshing payment or expense data:",t),yield(yield this.toastController.create({message:"Failed to refresh payment or expense data",duration:2e3,color:"danger"})).present()}finally{this.refreshing=!1}})}showPaymentDetails(t){console.log("Show payment details:",t)}goToPaymentsList(){console.log("Navigating to payments list...")}};h.\u0275fac=function(i){return new(i||h)(v(ot),v(J),v(it),v(rt))},h.\u0275cmp=T({type:h,selectors:[["app-payments"]],decls:18,vars:13,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"click","disabled"],["slot","icon-only","name","refresh"],["class","results-row",4,"ngIf"],["class","stats-grid",4,"ngIf"],["class","chart-card",4,"ngIf"],["class","ion-padding",4,"ngIf"],[1,"results-row"],[1,"last-sync-info"],["color","medium",1,"last-sync-label"],[1,"stats-grid"],[1,"stat-card","earnings-card",3,"routerLink"],[1,"stat-icon","total-earnings",2,"background","#2dd36f","color","#fff"],["name","wallet"],[1,"stat-label"],[1,"stat-value"],[1,"stat-subtext"],[1,"view-details"],["name","chevron-forward-outline","size","small"],[1,"stat-card","earnings-card"],[1,"stat-icon","monthly-earnings",2,"background","#2dd36f","color","#fff"],["name","calendar"],[1,"stat-card","expense-card",3,"routerLink"],[1,"stat-icon",2,"background","#eb445a","color","#fff"],[1,"stat-value","expense-value"],[1,"stat-card","expense-card"],[1,"chart-card"],[2,"display","flex","justify-content","center","align-items","center"],[3,"type","data","columns","options","height"],[1,"ion-padding"],[2,"width","60%",3,"animated"],[2,"width","100%",3,"animated"],[2,"width","80%",3,"animated"]],template:function(i,s){i&1&&(e(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),l(3,"ion-menu-button"),n(),e(4,"ion-title"),o(5,"Payments"),n(),e(6,"ion-buttons",2)(7,"ion-button",3),D("click",function(){return s.refreshPayments()}),l(8,"ion-icon",4),n()()()(),e(9,"ion-content"),S(10,lt,5,3,"div",5),d(11,"async"),S(12,dt,47,28,"div",6),d(13,"async"),S(14,mt,7,5,"ion-card",7),d(15,"async"),S(16,pt,8,3,"div",8),d(17,"async"),n()),i&2&&(a(7),c("disabled",s.refreshing),a(3),c("ngIf",!x(11,5,s.loading$)),a(2),c("ngIf",!x(13,7,s.loading$)),a(2),c("ngIf",!x(15,9,s.loading$)&&s.chartData.length>0),a(2),c("ngIf",x(17,11,s.loading$)))},dependencies:[$,B,z,L,A,U,q,Y,K,R,G,N,H,F,V,W,j,Q,Z,at],styles:[".stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px}.stat-card[_ngcontent-%COMP%]{background-color:var(--ion-card-background);border-radius:8px;padding:16px;display:flex;flex-direction:column;align-items:flex-start;box-shadow:0 4px 6px #0000001a;position:relative;transition:background-color .2s ease}.stat-card[routerLink][_ngcontent-%COMP%]{cursor:pointer}.stat-card[routerLink][_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.stat-card[_ngcontent-%COMP%]:active{background-color:#0000000d}.stat-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-bottom:12px}.stat-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#fff}.stat-icon.total-earnings[_ngcontent-%COMP%]{background-color:var(--ion-color-primary)}.stat-icon.monthly-earnings[_ngcontent-%COMP%]{background-color:var(--ion-color-success)}.stat-label[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.9rem;font-weight:500;margin-bottom:4px}.stat-value[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:var(--ion-color-success, #2dd36f)!important;margin-bottom:4px}.expense-value[_ngcontent-%COMP%]{color:#eb445a!important;font-weight:600}.stat-subtext[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.85rem}.view-details[_ngcontent-%COMP%]{position:absolute;bottom:12px;right:12px;display:flex;align-items:center;gap:4px;font-size:.8rem}.view-details[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1rem}.chart-card[_ngcontent-%COMP%]{margin:12px}.amount-note[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem}.status-badge[_ngcontent-%COMP%]{margin-left:8px;text-transform:capitalize}.last-sync-info[_ngcontent-%COMP%]{padding-right:16px;padding-top:8px;font-size:.9em;opacity:.7;vertical-align:middle;text-align:right}"]});let r=h;return r})();export{_t as PaymentsPage};
