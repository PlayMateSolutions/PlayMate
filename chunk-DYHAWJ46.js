import{a as ce}from"./chunk-2O5SH6DD.js";import{a as ae,t as re}from"./chunk-T6P2KMMV.js";import{$ as i,$b as Y,Cb as B,G as D,H as b,Ha as E,Hb as N,Ia as A,Ib as Q,Jb as z,Kb as G,Lb as j,Mb as H,Na as k,Ob as U,Q as a,R as S,Rb as V,Sb as $,T,Tb as q,Ub as K,Vb as J,Wa as L,X as h,Xb as W,Yb as X,Z as s,_ as w,aa as c,ba as p,cc as Z,fa as R,fc as ee,gc as te,ha as I,hc as ne,ia as _,kb as F,ra as l,rc as ie,sa as f,ta as P,tc as oe}from"./chunk-73AFXQHC.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as v,b as O,i as M}from"./chunk-OYAVQN5W.js";function se(t,d){t&1&&(i(0,"div",10),p(1,"ion-spinner",11),i(2,"ion-text",12),l(3,"Loading attendance data..."),c()())}function le(t,d){if(t&1&&(i(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),l(3),c(),i(4,"ion-card-subtitle"),l(5),c()()()),t&2){let n=_();a(3),f(n.periodLabel),a(2),P("",n.filteredRecords.length," records")}}function me(t,d){if(t&1&&(i(0,"ion-item",22)(1,"ion-label")(2,"h3"),l(3),c(),i(4,"ion-note",12),l(5),c()(),i(6,"div",23),p(7,"div",24),i(8,"ion-text",25),l(9),c()()()),t&2){let n=d.$implicit;a(3),f(n.memberName||"Unknown Member"),a(2),f(n.time),a(2),w("active",n.membershipStatus==="active")("expired",n.membershipStatus!=="active"),a(),s("color",n.membershipStatus==="active"?"success":"danger"),a(),P(" ",n.membershipStatus==="active"?"Active":"Expired"," ")}}function ge(t,d){if(t&1&&(i(0,"div",17)(1,"ion-item-divider",18)(2,"ion-label"),l(3),c(),i(4,"ion-note",19),l(5),c()(),i(6,"ion-list",20),h(7,me,10,8,"ion-item",21),c()()),t&2){let n=d.$implicit;a(),s("id",n.date),a(2),f(n.records[0]==null?null:n.records[0].formattedDate),a(2),P("",n.records.length," records"),a(2),s("ngForOf",n.records)}}function pe(t,d){if(t&1){let n=R();i(0,"div",13),h(1,ge,8,4,"div",14),i(2,"ion-infinite-scroll",15),I("ionInfinite",function(r){D(n);let o=_();return b(o.loadMoreRecords(r))}),p(3,"ion-infinite-scroll-content",16),c()()}if(t&2){let n=_();a(),s("ngForOf",n.displayedGroups)}}function ue(t,d){t&1&&(i(0,"p"),l(1,"There are no attendance records for this period."),c())}function he(t,d){t&1&&(i(0,"p"),l(1,"No records match your search criteria."),c())}function _e(t,d){t&1&&(i(0,"p"),l(1,"Try a different search term."),c())}function fe(t,d){if(t&1&&(i(0,"ion-card",26)(1,"ion-card-content",27),p(2,"ion-icon",28),i(3,"ion-text",12)(4,"h3"),l(5,"No Attendance Records"),c(),h(6,ue,2,0,"p",7)(7,he,2,0,"p",7)(8,_e,2,0,"p",7),c()()()),t&2){let n=_();a(6),s("ngIf",!n.searchQuery),a(),s("ngIf",n.searchQuery),a(),s("ngIf",n.searchQuery)}}var Te=(()=>{let d=class d{constructor(e){this.route=e,this.loading=!0,this.periodLabel="",this.period="",this.scrollToDate="",this.searchQuery="",this.startDate="",this.endDate="",this.attendanceRecords=[],this.filteredRecords=[],this.groupedRecords={},this.displayedGroups=[],this.currentPage=1,this.recordsPerPage=20,ae({listOutline:re})}ngOnInit(){this.route.queryParams.subscribe(e=>{this.periodLabel=e.periodLabel||"",this.period=e.period||"",this.startDate=e.startDate||"",this.endDate=e.endDate||"",this.scrollToDate=e.scrollToDate||"",this.searchQuery=e.searchQuery||"",this.loadAttendanceData()})}loadAttendanceData(){return M(this,null,function*(){try{this.loading=!0;let e=yield ce.getAll();this.attendanceRecords=e,this.applyFilter(),this.currentPage=1,this.loadCurrentPage(),setTimeout(()=>this.scrollToActiveDate(),100)}catch(e){console.error("Error loading attendance data:",e),this.attendanceRecords=[],this.filteredRecords=[],this.groupedRecords={},this.displayedGroups=[]}finally{this.loading=!1}})}applyFilter(){let e=[...this.attendanceRecords];if(this.startDate&&this.endDate){let r=new Date(this.startDate),o=new Date(this.endDate);o.setHours(23,59,59,999),e=e.filter(g=>{let m=new Date(g.date);return m>=r&&m<=o}),console.log(`Filtered records by date range (${this.startDate} to ${this.endDate}):`,e.length)}if(this.filteredRecords=[...e],this.searchQuery){let r=this.searchQuery.toLowerCase();e=e.filter(o=>o.memberName&&o.memberName.toLowerCase().includes(r)||o.notes&&o.notes.toLowerCase().includes(r))}this.groupRecordsByDate(e)}onSearchChange(e){this.searchQuery=e.detail.value,this.applyFilter(),this.currentPage=1,this.loadCurrentPage()}loadCurrentPage(){let e=Object.keys(this.groupedRecords).sort((m,C)=>new Date(C).getTime()-new Date(m).getTime()),r=(this.currentPage-1)*this.recordsPerPage,o=r+this.recordsPerPage,g=e.slice(r,o);this.displayedGroups=g.map(m=>{let C=this.groupedRecords[m].map(u=>{let y=new Date(u.date),de=y.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),x="Not recorded";return u.checkInTime?x=new Date(u.checkInTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):u.date&&(x=y.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})),O(v({},u),{formattedDate:de,time:x})});return{date:m,records:C}})}loadMoreRecords(e){let r=Math.ceil(Object.keys(this.groupedRecords).length/this.recordsPerPage);this.currentPage<r?(this.currentPage++,this.loadCurrentPage(),e.target.complete()):(e.target.complete(),e.target.disabled=!0)}groupRecordsByDate(e){this.groupedRecords={},(e||this.attendanceRecords).forEach(o=>{let g=new Date(o.date).toISOString().split("T")[0];this.groupedRecords[g]||(this.groupedRecords[g]=[]),this.groupedRecords[g].push(o)})}scrollToActiveDate(){if(this.scrollToDate)try{let e=document.getElementById(this.scrollToDate);if(e)e.scrollIntoView({behavior:"smooth",block:"start"});else{let r=document.querySelector("ion-content");r&&r.scrollToBottom(300)}}catch(e){console.error("Error scrolling:",e)}}};d.\u0275fac=function(r){return new(r||d)(S(L))},d.\u0275cmp=T({type:d,selectors:[["app-attendance-details"]],decls:13,vars:7,consts:[[3,"translucent"],["color","primary"],["slot","start"],["defaultHref","/tabs/attendance"],["placeholder","Search by name",3,"ionInput","debounce"],[3,"fullscreen"],["class","loading-container",4,"ngIf"],[4,"ngIf"],["class","attendance-list",4,"ngIf"],["class","no-data-card",4,"ngIf"],[1,"loading-container"],["name","crescent"],["color","medium"],[1,"attendance-list"],["class","date-group",4,"ngFor","ngForOf"],[3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","Loading more records..."],[1,"date-group"],["sticky","true","color","light",3,"id"],["slot","end"],["lines","full"],["class","attendance-item",4,"ngFor","ngForOf"],[1,"attendance-item"],["slot","end",1,"status-wrapper"],[1,"status-indicator"],[1,"status-text",3,"color"],[1,"no-data-card"],[1,"no-data"],["name","list-outline","size","large","color","medium"]],template:function(r,o){r&1&&(i(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),p(3,"ion-back-button",3),c(),i(4,"ion-title"),l(5,"Attendance Details"),c()(),i(6,"ion-toolbar")(7,"ion-searchbar",4),I("ionInput",function(m){return o.onSearchChange(m)}),c()()(),i(8,"ion-content",5),h(9,se,4,0,"div",6)(10,le,6,2,"ion-card",7)(11,pe,4,1,"div",8)(12,fe,9,3,"ion-card",9),c()),r&2&&(s("translucent",!0),a(7),s("debounce",500),a(),s("fullscreen",!0),a(),s("ngIf",o.loading),a(),s("ngIf",!o.loading),a(),s("ngIf",!o.loading&&o.displayedGroups.length>0),a(),s("ngIf",!o.loading&&o.displayedGroups.length===0))},dependencies:[k,E,A,F,V,ne,te,U,N,B,X,K,J,W,ee,Q,z,G,H,j,Z,$,q,oe,ie,Y],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;gap:1rem}.no-data[_ngcontent-%COMP%]{text-align:center;padding:2rem;display:flex;flex-direction:column;align-items:center;gap:1rem}.no-data[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:.5rem}.no-data[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-bottom:.5rem}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium-tint);margin:.25rem 0}.no-data-card[_ngcontent-%COMP%]{margin:16px}ion-item[_ngcontent-%COMP%]{--padding-start: 16px;--inner-padding-end: 16px}ion-card[_ngcontent-%COMP%]{margin:16px}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding-bottom:12px}ion-card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600}ion-card[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{font-size:14px;color:var(--ion-color-medium)}.attendance-list[_ngcontent-%COMP%]   .date-group[_ngcontent-%COMP%]{margin-bottom:8px}.attendance-list[_ngcontent-%COMP%]   ion-item-divider[_ngcontent-%COMP%]{--background: var(--ion-color-light);--color: var(--ion-color-dark);--padding-start: 16px;--padding-end: 16px;min-height:48px;font-weight:600}.attendance-list[_ngcontent-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:.85rem;font-weight:400}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]{--padding-start: 16px;--padding-end: 8px}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;margin:0 0 4px}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:.85rem;display:block}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   .status-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   .status-indicator[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   .status-indicator.active[_ngcontent-%COMP%]{background-color:var(--ion-color-success)}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   .status-indicator.expired[_ngcontent-%COMP%]{background-color:var(--ion-color-danger)}.attendance-list[_ngcontent-%COMP%]   .attendance-item[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{font-size:12px;font-weight:500}"]});let t=d;return t})();export{Te as AttendanceDetailsPage};
