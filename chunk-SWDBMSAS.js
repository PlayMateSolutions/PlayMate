import{a as D}from"./chunk-UWHUA5XG.js";import{a as w}from"./chunk-ACDW2MD6.js";import{a as C,e as P,f as A}from"./chunk-HLDYDQ4G.js";import{C as l,Xa as d,Ya as M,Za as j,f as c,g as S,k as p,s as b,x as u,z as x}from"./chunk-CCDMTYGH.js";import{a as y,b as v,i as m}from"./chunk-OYAVQN5W.js";var g=(()=>{let r=class r{static openDB(){return new Promise((e,o)=>{let a=indexedDB.open(r.dbName,w.version);a.onupgradeneeded=i=>{let s=i.target.result;w.onUpgrade(s)},a.onsuccess=()=>e(a.result),a.onerror=()=>o(a.error)})}static getAll(){return m(this,null,function*(){let e=yield r.openDB();return new Promise((o,a)=>{let t=e.transaction(r.storeName,"readonly").objectStore(r.storeName).getAll();t.onsuccess=()=>o(t.result),t.onerror=()=>a(t.error)})})}static setAll(e){return m(this,null,function*(){let o=yield r.openDB();return new Promise((a,i)=>{var h;let s=o.transaction(r.storeName,"readwrite"),t=s.objectStore(r.storeName);t.clear();for(let f of e){let N=v(y({},f),{id:(h=f.ID)!=null?h:f.id});t.put(N)}s.oncomplete=()=>a(),s.onerror=()=>i(s.error)})})}};r.dbName="PlayMateDB",r.storeName="members";let n=r;return n})();var J=(()=>{let r=class r{constructor(e,o,a,i){this.http=e,this.authService=o,this.clubContext=a,this.googleSheetService=i,this.apiUrl=C.apiUrl}getRequestPayload(a){return m(this,arguments,function*(e,o={}){let i=yield this.authService.getAuthToken();return{action:e,payload:o,authorization:i?"Bearer "+i:void 0}})}getMembers(){return c(g.getAll()).pipe(p(e=>({members:e,isFresh:!1})),b(()=>S({members:[],isFresh:!1})))}refreshMembers(){return c(this.googleSheetService.RefreshMembersData()).pipe(u(e=>(this.clubContext.setLastMemberRefresh(new Date),c(g.setAll(e)).pipe(p(()=>({members:e,isFresh:!0}))))),b(e=>{throw console.error("Error fetching members from Google Sheets:",e),e}))}addMember(e){return c(this.authService.getAuthToken()).pipe(u(o=>{if(!o)throw new Error("No valid auth token");let a=new M().set("sportsClubId",this.clubContext.getSportsClubId()||"").set("action","addMember").set("authorization","Bearer "+o),s={headers:new d({"Content-Type":"text/plain;charset=utf-8"}),params:a,responseType:"json",observe:"body"};return this.http.post(this.apiUrl,e,s).pipe(p(t=>{var h;if(t.status==="success"&&t.data)return t.data;throw t.status==="error"&&((h=t.error)!=null&&h.message)?new Error(t.error.message):new Error("Failed to add member")}))}))}updateMember(e){return c(this.getRequestPayload("updateMember",e)).pipe(u(o=>{let i={headers:new d({"Content-Type":"text/plain;charset=utf-8"}),responseType:"json",observe:"body"};return this.http.post(this.apiUrl,o,i).pipe(p(s=>{var t;if(s.status==="error")throw new Error((t=s.error)==null?void 0:t.message);return s.data}))}))}deleteMember(e){return c(this.getRequestPayload("deleteMember",{memberId:e})).pipe(u(o=>{let i={headers:new d({"Content-Type":"text/plain;charset=utf-8"}),responseType:"json",observe:"body"};return this.http.post(this.apiUrl,o,i).pipe(p(s=>{var t;if(s.status==="error")throw new Error((t=s.error)==null?void 0:t.message);return s.data||!1}))}))}};r.\u0275fac=function(o){return new(o||r)(l(j),l(P),l(A),l(D))},r.\u0275prov=x({token:r,factory:r.\u0275fac,providedIn:"root"});let n=r;return n})();export{J as a};
