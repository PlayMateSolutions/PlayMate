import{a as Tt}from"./chunk-SBCQPEBI.js";import{a as It}from"./chunk-3XCTVGJO.js";import{a as P,c as lt}from"./chunk-OLBZNZSH.js";import"./chunk-WKSYTGLY.js";import{f as At}from"./chunk-IG6JAMQW.js";import"./chunk-T47TWMLD.js";import{a as kt}from"./chunk-BK4AT5KR.js";import"./chunk-35HGTZOU.js";import{$ as m,Aa as F,Ad as bt,Bc as st,Bd as Ot,Cd as St,Ea as O,Ec as ct,Fa as z,Ga as N,H as A,I as k,Ic as dt,Mc as gt,Na as L,Nc as ht,Ob as q,Pb as H,Qb as Y,R as s,Rb as $,Rc as ut,S as M,Sa as R,Sb as X,Sc as mt,Ta as V,U as T,Ub as J,Wb as K,Wc as pt,Yc as ft,Z as b,Zb as Q,bd as Ct,ca as i,cb as B,cd as _t,da as a,dc as Z,ea as p,hc as tt,ia as I,jb as U,jc as et,jd as yt,ka as _,kd as Pt,la as y,mb as j,mc as nt,od as Mt,pc as it,qc as ot,rb as G,rc as at,ua as d,va as v,vd as xt,wa as w,wd as vt,xd as wt,ya as E,za as W,zc as rt,zd as Dt}from"./chunk-AAX3YNDZ.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as S,i as D}from"./chunk-OYAVQN5W.js";function Wt(r,u){r&1&&p(0,"ion-spinner",20)}function Ft(r,u){r&1&&p(0,"ion-icon",21)}function zt(r,u){r&1&&(i(0,"div",22),p(1,"ion-spinner",20),i(2,"ion-text",23),d(3,"Loading attendance data..."),a()())}function Nt(r,u){if(r&1&&(i(0,"div",24)(1,"div",25)(2,"ion-text",26),d(3),O(4,"relativeTime"),a()()()),r&2){let g=y();s(3),w(" Last synced: ",z(4,1,g.lastAttendanceSync)," ")}}function Lt(r,u){if(r&1){let g=I();i(0,"div",27)(1,"div",28),_("click",function(){A(g);let n=y();return k(n.navigateToAttendanceDetails())}),i(2,"div",29),p(3,"ion-icon",30),a(),i(4,"div",31),d(5,"Active Users"),a(),i(6,"div",32),d(7),a(),i(8,"div",33),p(9,"ion-icon",34),i(10,"small"),d(11,"View Details"),a()()(),i(12,"div",35)(13,"div",36),p(14,"ion-icon",37),a(),i(15,"div",31),d(16,"Avg Daily"),a(),i(17,"div",32),d(18),O(19,"number"),a()()()}if(r&2){let g=y();s(7),v(g.uniqueMembersCount),s(11),v(N(19,2,g.averageAttendance,"1.0-1"))}}function Rt(r,u){if(r&1&&(i(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),d(3),a()(),i(4,"ion-card-content")(5,"div",38),p(6,"google-chart",39),a()()()),r&2){let g=y();s(3),v(g.getChartTitle()),s(3),m("type",g.chartType)("data",g.chartData)("columns",g.chartColumns)("options",g.chartOptions)("height",300)}}function Vt(r,u){if(r&1&&(i(0,"ion-card")(1,"ion-card-content",40),p(2,"ion-icon",41),i(3,"ion-text",23)(4,"h3"),d(5),a(),i(6,"p"),d(7,"There are no attendance records for this period."),a(),i(8,"p"),d(9,"Try changing the date range or refresh the data."),a()()()()),r&2){let g=y();s(5),w("No Data for ",g.getCurrentPeriodText(),"")}}var ne=(()=>{let u=class u{constructor(t,n,e,l){this.attendanceService=t,this.toastController=n,this.router=e,this.clubContext=l,this.loading=!0,this.refreshing=!1,this.viewPeriod="weekly",this.currentDate=new Date,this.currentWeekStart=new Date,this.currentMonth=new Date,this.dailyData=[],this.chartData=[],this.chartColumns=["Date","Attendance",{type:"string",role:"tooltip"},{type:"string",role:"annotation"}],this.chartType=P.ColumnChart,this.uniqueMembersCount=0,this.averageAttendance=0,this.highestAttendance={day:"",count:0},this.lowestAttendance={day:"",count:0},this.daysWithNoAttendance=0,this.totalAttendanceCount=0,this.expiredMembershipsCount=0,this.hasDataForCurrentPeriod=!1,this.lastAttendanceSync=null,this.chartOptions={backgroundColor:"transparent",colors:["#4CAF50"],chartArea:{left:20,top:20,width:"90%",height:"75%"},hAxis:{textStyle:{fontSize:12,color:"#666"},gridlines:{color:"transparent"}},vAxis:{textStyle:{fontSize:12,color:"#666"},gridlines:{color:"#e0e0e0",count:5},minValue:0},legend:{position:"none"},animation:{startup:!0,duration:1e3,easing:"out"}},dt({refresh:Mt,chevronBackOutline:pt,chevronForwardOutline:ft,peopleOutline:Pt,calendarOutline:mt,trendingUpOutline:St,trendingDownOutline:bt,statsChartOutline:vt,eyeOutline:_t,analyticsOutline:ht,timeOutline:wt,people:yt,calendar:ut,statsChart:xt,trendingUp:Ot,trendingDown:Dt,eye:Ct,analytics:gt}),this.setCurrentWeekStart(),this.currentMonth=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),1),this.lastAttendanceSync=this.clubContext.getLastAttendanceRefresh()}ngOnInit(){this.viewPeriod==="weekly"?this.chartType=P.ColumnChart:this.viewPeriod==="monthly"&&(this.chartType=P.LineChart),this.loadAttendanceData()}loadAttendanceData(){return D(this,null,function*(){try{this.loading=!0,console.log("Loading attendance data from IndexedDB...");let t=yield kt.getAll();console.log("Loaded records:",t.length);let n=this.getDateRangeForCurrentView(),e=new Date(n[0]),l=new Date(n[n.length-1]);l.setHours(23,59,59,999);let o=t.filter(c=>{let C=new Date(c.date);return C>=e&&C<=l});this.hasDataForCurrentPeriod=o.length>0,this.dailyData=this.calculateDailyAttendance(t),this.chartData=this.prepareChartData(this.dailyData),this.calculateStatistics(this.dailyData,t),this.updateChartOptions(),this.lastAttendanceSync=this.clubContext.getLastAttendanceRefresh(),console.log("Daily data:",this.dailyData),console.log("Chart data:",this.chartData),console.log("Has data for current period:",this.hasDataForCurrentPeriod)}catch(t){console.error("Error loading attendance data:",t)}finally{this.loading=!1}})}calculateDailyAttendance(t){let n=new Map;t.forEach(o=>{let c=new Date(o.date).toISOString().split("T")[0];n.set(c,(n.get(c)||0)+1)});let e=this.getDateRangeForCurrentView(),l=[];return e.forEach(o=>{let c=n.get(o)||0;l.push({date:o,count:c})}),l}getDateRangeForCurrentView(){let t=[];switch(this.viewPeriod){case"weekly":for(let o=0;o<7;o++){let c=new Date(this.currentWeekStart);c.setDate(this.currentWeekStart.getDate()+o),t.push(c.toISOString().split("T")[0])}break;case"monthly":let n=this.currentMonth.getFullYear(),e=this.currentMonth.getMonth(),l=new Date(n,e+1,0).getDate();for(let o=1;o<=l;o++){let c=new Date(n,e,o);t.push(c.toISOString().split("T")[0])}break;default:for(let o=29;o>=0;o--){let c=new Date(this.currentDate);c.setDate(this.currentDate.getDate()-o),t.push(c.toISOString().split("T")[0])}break}return t}setCurrentWeekStart(){let t=new Date,n=t.getDay(),e=n===0?6:n-1;this.currentWeekStart=new Date(t),this.currentWeekStart.setDate(t.getDate()-e),this.currentWeekStart.setHours(0,0,0,0)}prepareChartData(t){return!t||t.length===0?[]:(t.sort((n,e)=>new Date(n.date).getTime()-new Date(e.date).getTime()),t.map(n=>{let e=n.count||0;return[this.formatDate(n.date),e,`${n.date}: ${e} ${e===1?"person":"people"}`,e.toString()]}))}calculateStatistics(t,n){if(!t||t.length===0){this.uniqueMembersCount=0,this.averageAttendance=0,this.highestAttendance={day:"",count:0},this.lowestAttendance={day:"",count:0},this.daysWithNoAttendance=0,this.totalAttendanceCount=0,this.expiredMembershipsCount=0;return}let e=this.getDateRangeForCurrentView(),l=new Date(e[0]),o=new Date(e[e.length-1]);o.setHours(23,59,59,999);let c=n.filter(h=>{let f=new Date(h.date);return f>=l&&f<=o});this.totalAttendanceCount=t.reduce((h,f)=>h+(f.count||0),0),this.averageAttendance=this.totalAttendanceCount/t.length;let C={day:"",count:0},x={day:"",count:Number.MAX_SAFE_INTEGER};t.forEach(h=>{let f=h.count||0;f>C.count&&(C={day:h.date,count:f}),f<x.count&&(x={day:h.date,count:f})}),this.highestAttendance=C,this.lowestAttendance=x.count===Number.MAX_SAFE_INTEGER?{day:"",count:0}:x,this.daysWithNoAttendance=t.filter(h=>!h.count||h.count===0).length,this.expiredMembershipsCount=c.filter(h=>h.membershipStatus==="expired").length;let Et=new Set(c.map(h=>h.memberId));this.uniqueMembersCount=Et.size}formatDateForDisplay(t,n=this.viewPeriod){let e=new Date(t);switch(n){case"weekly":return e.toLocaleDateString("en-US",{weekday:"short"});case"monthly":return e.toLocaleDateString("en-US",{day:"numeric"});default:return e.toLocaleDateString("en-US",{weekday:"short"})}}formatDate(t){return this.formatDateForDisplay(t)}refreshAttendance(){return D(this,null,function*(){try{this.refreshing=!0,console.log("Refreshing attendance data..."),yield this.attendanceService.syncAttendance(!1),yield this.loadAttendanceData(),console.log("Attendance data refreshed successfully"),yield(yield this.toastController.create({message:"Attendance data refreshed successfully",duration:3e3,color:"success",position:"top"})).present()}catch(t){console.error("Error refreshing attendance data:",t),yield(yield this.toastController.create({message:"Failed to refresh attendance data",duration:3e3,color:"danger",position:"top"})).present()}finally{this.refreshing=!1}})}onPeriodChange(t){this.viewPeriod=t.detail.value,console.log("Period changed to:",this.viewPeriod),this.viewPeriod==="weekly"?this.chartType=P.ColumnChart:this.viewPeriod==="monthly"&&(this.chartType=P.LineChart),this.viewPeriod==="weekly"?this.setCurrentWeekStart():this.viewPeriod==="monthly"&&(this.currentMonth=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),1)),this.loadAttendanceData()}goToPreviousWeek(){this.currentWeekStart.setDate(this.currentWeekStart.getDate()-7),this.loadAttendanceData()}goToNextWeek(){this.currentWeekStart.setDate(this.currentWeekStart.getDate()+7),this.loadAttendanceData()}goToPreviousMonth(){this.currentMonth.setMonth(this.currentMonth.getMonth()-1),this.loadAttendanceData()}goToNextMonth(){this.currentMonth.setMonth(this.currentMonth.getMonth()+1),this.loadAttendanceData()}navigateToAttendanceDetails(){let t=this.getDateRangeForCurrentView(),n=t[0],e=t[t.length-1];this.router.navigate(["/tabs/attendance-details"],{queryParams:{startDate:n,endDate:e,period:this.viewPeriod,periodLabel:this.getCurrentPeriodText(),scrollToDate:n},skipLocationChange:!1})}getCurrentPeriodText(){switch(this.viewPeriod){case"weekly":let t=new Date(this.currentWeekStart);return t.setDate(this.currentWeekStart.getDate()+6),`${this.currentWeekStart.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`;case"monthly":return this.currentMonth.toLocaleDateString("en-US",{year:"numeric",month:"long"});default:return"This Week"}}getChartTitle(){return`${this.viewPeriod.charAt(0).toUpperCase()+this.viewPeriod.slice(1)} Attendance Analytics`}canGoToNextWeek(){let t=new Date(this.currentWeekStart);return t.setDate(this.currentWeekStart.getDate()+7),t<=new Date}canGoToNextMonth(){let t=new Date(this.currentMonth);t.setMonth(this.currentMonth.getMonth()+1);let n=new Date;return t<=new Date(n.getFullYear(),n.getMonth(),1)}updateChartOptions(){let t=this.chartData.length>0?Math.max(...this.chartData.map(n=>n[1]),10)*1.1:10;this.chartOptions={backgroundColor:"transparent",colors:["#4CAF50"],chartArea:{left:20,top:20,width:this.viewPeriod==="monthly"&&this.chartData.length>20?"80%":"90%",height:"75%"},hAxis:S({textStyle:{fontSize:12,color:"#666"},gridlines:{color:"transparent"}},this.viewPeriod==="monthly"?{showTextEvery:5}:{}),vAxis:{textStyle:{fontSize:12,color:"#666"},gridlines:{color:"#e0e0e0",count:5},minValue:0,viewWindow:{min:0,max:t}},legend:{position:"none"},animation:{startup:!0,duration:1e3,easing:"out"},annotations:{textStyle:{fontSize:12,color:"#fff",bold:!0},alwaysOutside:!1,stem:{color:"transparent",length:0}}}}};u.\u0275fac=function(n){return new(n||u)(M(It),M(rt),M(B),M(At))},u.\u0275cmp=T({type:u,selectors:[["app-attendance"]],decls:33,vars:13,consts:[[3,"translucent"],["color","primary"],["slot","start"],["slot","end"],[3,"click","disabled"],["name","crescent",4,"ngIf"],["name","refresh","slot","icon-only",4,"ngIf"],["mode","ios",3,"ngModelChange","ionChange","ngModel"],["value","weekly"],["value","monthly"],["fill","clear",3,"click"],["name","chevron-back-outline","slot","icon-only"],["size","small",1,"period-title"],["fill","clear",3,"click","disabled"],["name","chevron-forward-outline","slot","icon-only"],[3,"fullscreen"],["class","loading-container",4,"ngIf"],["class","results-row",4,"ngIf"],["class","stats-grid",4,"ngIf"],[4,"ngIf"],["name","crescent"],["name","refresh","slot","icon-only"],[1,"loading-container"],["color","medium"],[1,"results-row"],[1,"last-sync-info"],["color","medium",1,"last-sync-label"],[1,"stats-grid"],[1,"stat-card",3,"click"],[1,"stat-icon","active-users"],["name","people"],[1,"stat-label"],[1,"stat-value"],[1,"view-details"],["name","chevron-forward-outline","size","small"],[1,"stat-card"],[1,"stat-icon","avg-daily"],["name","calendar"],[2,"display","flex","justify-content","center","align-items","center"],[3,"type","data","columns","options","height"],[1,"no-data"],["name","analytics-outline","size","large","color","medium"]],template:function(n,e){n&1&&(i(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),p(3,"ion-menu-button"),a(),i(4,"ion-title"),d(5,"Attendance Analytics"),a(),i(6,"ion-buttons",3)(7,"ion-button",4),_("click",function(){return e.refreshAttendance()}),b(8,Wt,1,0,"ion-spinner",5)(9,Ft,1,0,"ion-icon",6),a()()(),i(10,"ion-toolbar")(11,"ion-segment",7),F("ngModelChange",function(o){return W(e.viewPeriod,o)||(e.viewPeriod=o),o}),_("ionChange",function(o){return e.onPeriodChange(o)}),i(12,"ion-segment-button",8)(13,"ion-label"),d(14,"Weekly"),a()(),i(15,"ion-segment-button",9)(16,"ion-label"),d(17,"Monthly"),a()()()(),i(18,"ion-toolbar")(19,"ion-buttons",2)(20,"ion-button",10),_("click",function(){return e.viewPeriod==="weekly"?e.goToPreviousWeek():e.goToPreviousMonth()}),p(21,"ion-icon",11),a()(),i(22,"ion-title",12),d(23),a(),i(24,"ion-buttons",3)(25,"ion-button",13),_("click",function(){return e.viewPeriod==="weekly"?e.goToNextWeek():e.goToNextMonth()}),p(26,"ion-icon",14),a()()()(),i(27,"ion-content",15),b(28,zt,4,0,"div",16)(29,Nt,5,3,"div",17)(30,Lt,20,5,"div",18)(31,Rt,7,6,"ion-card",19)(32,Vt,10,1,"ion-card",19),a()),n&2&&(m("translucent",!0),s(7),m("disabled",e.loading||e.refreshing),s(),m("ngIf",e.refreshing),s(),m("ngIf",!e.refreshing),s(2),E("ngModel",e.viewPeriod),s(12),w(" ",e.getCurrentPeriodText()," "),s(2),m("disabled",e.viewPeriod==="weekly"?!e.canGoToNextWeek():!e.canGoToNextMonth()),s(2),m("fullscreen",!0),s(),m("ngIf",e.loading),s(),m("ngIf",!e.loading),s(),m("ngIf",!e.loading&&e.hasDataForCurrentPeriod),s(),m("ngIf",!e.loading&&e.hasDataForCurrentPeriod),s(),m("ngIf",!e.loading&&!e.hasDataForCurrentPeriod))},dependencies:[V,L,R,G,U,j,Q,at,ot,K,Y,X,J,$,nt,it,H,tt,q,st,ct,et,Z,lt,Tt],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;gap:1rem}.period-title[_ngcontent-%COMP%]{text-align:center;font-size:1rem;font-weight:500}.no-data[_ngcontent-%COMP%]{text-align:center;padding:2rem;display:flex;flex-direction:column;align-items:center;gap:1rem}.no-data[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:.5rem}.no-data[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-bottom:.5rem}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium-tint);margin:.25rem 0}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px}.stat-card[_ngcontent-%COMP%]{background-color:var(--ion-card-background);border-radius:8px;padding:16px;display:flex;flex-direction:column;align-items:flex-start;box-shadow:0 4px 6px #0000001a;position:relative;transition:background-color .2s ease}.stat-card[_ngcontent-%COMP%]:active{background-color:#0000000d}.view-details[_ngcontent-%COMP%]{position:absolute;bottom:10px;right:10px;display:flex;align-items:center;font-size:12px;color:var(--ion-color-medium)}.view-details[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{margin-left:4px}.stat-icon[_ngcontent-%COMP%]{width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:50%;margin-bottom:12px}.stat-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#fff}.stat-icon.active-users[_ngcontent-%COMP%]{background-color:#e53935}.stat-icon.avg-daily[_ngcontent-%COMP%]{background-color:#3949ab}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium);margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:#888;margin-bottom:4px}.stat-value[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:var(--ion-text-color, var(--ion-color-dark))}.insights-section[_ngcontent-%COMP%]{padding:0 12px;margin-top:12px}.insights-section[_ngcontent-%COMP%]   .insights-title[_ngcontent-%COMP%]{font-size:16px;color:#fff;display:flex;align-items:center;margin:0 0 12px}.insights-section[_ngcontent-%COMP%]   .insights-title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:8px}.insights-section[_ngcontent-%COMP%]   .insight-item[_ngcontent-%COMP%]{background-color:#1e1e1e;border-radius:8px;padding:12px 16px;margin-bottom:12px}.insights-section[_ngcontent-%COMP%]   .insight-item[_ngcontent-%COMP%]   .insight-content[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:6px}.insights-section[_ngcontent-%COMP%]   .insight-item[_ngcontent-%COMP%]   .insight-content[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px}.insights-section[_ngcontent-%COMP%]   .insight-item[_ngcontent-%COMP%]   .insight-content[_ngcontent-%COMP%]   ion-icon.negative[_ngcontent-%COMP%]{color:#e53935}.insights-section[_ngcontent-%COMP%]   .insight-item[_ngcontent-%COMP%]   .insight-content[_ngcontent-%COMP%]   .insight-title[_ngcontent-%COMP%]{font-size:14px;color:#fff;flex-grow:1}.insights-section[_ngcontent-%COMP%]   .insight-item[_ngcontent-%COMP%]   .insight-content[_ngcontent-%COMP%]   .insight-value[_ngcontent-%COMP%]{font-weight:600;font-size:14px}.insights-section[_ngcontent-%COMP%]   .insight-item[_ngcontent-%COMP%]   .insight-content[_ngcontent-%COMP%]   .insight-value.negative[_ngcontent-%COMP%]{color:#e53935}.insights-section[_ngcontent-%COMP%]   .insight-item[_ngcontent-%COMP%]   .insight-description[_ngcontent-%COMP%]{font-size:13px;color:#888}ion-segment-button.segment-button-checked[_ngcontent-%COMP%], ion-segment-button.segment-button-checked[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:#000!important;--color: #000 !important}.bottom-tabs[_ngcontent-%COMP%]{display:flex;justify-content:space-around;background-color:#1a1a1a;padding:10px 0;position:fixed;bottom:0;left:0;right:0;z-index:10;border-top:1px solid #333333}.bottom-tabs[_ngcontent-%COMP%]   .tab-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;flex:1}.bottom-tabs[_ngcontent-%COMP%]   .tab-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#888}.bottom-tabs[_ngcontent-%COMP%]   .tab-item[_ngcontent-%COMP%]   .tab-label[_ngcontent-%COMP%]{font-size:10px;margin-top:4px;color:#888}.bottom-tabs[_ngcontent-%COMP%]   .tab-item.active[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#e53935}.bottom-tabs[_ngcontent-%COMP%]   .tab-item.active[_ngcontent-%COMP%]   .tab-label[_ngcontent-%COMP%]{color:#e53935}.last-sync-info[_ngcontent-%COMP%]{padding-right:16px;padding-top:8px;font-size:.9em;opacity:.7;vertical-align:middle;text-align:right}"]});let r=u;return r})();export{ne as AttendancePage};
