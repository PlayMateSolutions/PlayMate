import{a as b}from"./chunk-FNNLXVYS.js";import{a as Te}from"./chunk-Q7QXYW3J.js";import{a as ke}from"./chunk-PRRRTNPC.js";import"./chunk-SWDBMSAS.js";import"./chunk-IWGSKPVT.js";import"./chunk-UWHUA5XG.js";import"./chunk-ACDW2MD6.js";import{a as Ce,c as Me}from"./chunk-K32EJFM3.js";import{e as Ee,f as we}from"./chunk-HLDYDQ4G.js";import"./chunk-T47TWMLD.js";import{Aa as I,Ac as xe,Ba as w,Bc as fe,Ca as J,Cc as ye,Da as F,Dc as ve,Fa as g,Fd as Ie,Ga as C,Ha as E,Hc as _e,I as H,J as G,Jc as N,Kc as Se,Lb as ae,Oa as T,Pb as D,Qb as B,Ra as Q,Rb as re,S as a,Sa as X,Sb as se,Sc as be,T as f,Ta as Z,Tb as le,Ua as O,V as k,Vb as ce,Xb as L,Zc as Pe,_ as v,_b as z,aa as p,bc as de,da as t,ea as e,eb as ee,ec as pe,fa as m,fc as me,ic as ue,ja as K,kb as te,la as M,ma as _,mc as ge,nb as ne,nc as he,pd as R,rb as ie,rc as W,sb as oe,sc as A,uc as U,va as r,wa as Y,xa as y,za as P}from"./chunk-CCDMTYGH.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{i as S}from"./chunk-OYAVQN5W.js";function Ue(s,l){if(s&1){let u=K();t(0,"ion-datetime",16),w("ngModelChange",function(i){H(u);let n=_();return I(n.expense.date,i)||(n.expense.date=i),G(i)}),e()}if(s&2){let u=_();P("ngModel",u.expense.date),p("showDefaultButtons",!0)}}function je(s,l){if(s&1&&(t(0,"div",17)(1,"ion-label",18),r(2),e()()),s&2){let u=_();a(2),Y(u.errorMsg)}}function Fe(s,l){s&1&&m(0,"ion-spinner",19)}var Oe=(()=>{let l=class l{constructor(o,i){this.modalCtrl=o,this.expenseService=i,this.currentUser="",this.expense={date:new Date().toISOString(),paymentType:"Cash",recordedBy:""},this.saving=!1,this.errorMsg="",console.log("ExpenseModalComponent initialized with currentUser:",this.currentUser)}dismiss(){this.modalCtrl.dismiss()}save(){return S(this,null,function*(){if(!(!this.expense.amount||!this.expense.category)){this.saving=!0,this.errorMsg="",this.expense.recordedBy=this.currentUser;try{yield this.expenseService.addExpense(this.expense),yield this.modalCtrl.dismiss({expense:this.expense})}catch{this.errorMsg="Failed to record expense. Please try again."}finally{this.saving=!1}}})}};l.\u0275fac=function(i){return new(i||l)(f(U),f(b))},l.\u0275cmp=k({type:l,selectors:[["app-expense-modal"]],inputs:{currentUser:"currentUser"},features:[J([b])],decls:43,vars:11,consts:[["color","primary"],["slot","end"],[3,"click"],[1,"ion-padding"],["position","stacked"],["id","expenseDate","readonly","",3,"value"],["trigger","expenseDate"],["name","category","required","",3,"ngModelChange","ngModel"],["name","notes",3,"ngModelChange","ngModel"],["type","number","name","amount","required","",3,"ngModelChange","ngModel"],["value","Cash","readonly",""],["readonly","",3,"value"],["class","ion-text-center ion-padding",4,"ngIf"],["expand","block",3,"click","disabled"],["name","dots","slot","start",4,"ngIf"],["expand","block","fill","clear","color","medium",3,"click"],["presentation","date","locale","en-US",3,"ngModelChange","ngModel","showDefaultButtons"],[1,"ion-text-center","ion-padding"],["color","danger"],["name","dots","slot","start"]],template:function(i,n){i&1&&(t(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),r(3,"Log Expense"),e(),t(4,"ion-buttons",1)(5,"ion-button",2),M("click",function(){return n.dismiss()}),r(6,"Close"),e()()()(),t(7,"ion-content",3)(8,"ion-list")(9,"ion-item")(10,"ion-label",4),r(11,"Date"),e(),m(12,"ion-input",5),g(13,"date"),t(14,"ion-popover",6),v(15,Ue,1,2,"ng-template"),e()(),t(16,"ion-item")(17,"ion-label",4),r(18,"Category"),e(),t(19,"ion-input",7),w("ngModelChange",function(c){return I(n.expense.category,c)||(n.expense.category=c),c}),e()(),t(20,"ion-item")(21,"ion-label",4),r(22,"Notes"),e(),t(23,"ion-textarea",8),w("ngModelChange",function(c){return I(n.expense.notes,c)||(n.expense.notes=c),c}),e()(),t(24,"ion-item")(25,"ion-label",4),r(26,"Amount"),e(),t(27,"ion-input",9),w("ngModelChange",function(c){return I(n.expense.amount,c)||(n.expense.amount=c),c}),e()(),t(28,"ion-item")(29,"ion-label",4),r(30,"Payment Type"),e(),m(31,"ion-input",10),e(),t(32,"ion-item")(33,"ion-label",4),r(34,"Recorded By"),e(),m(35,"ion-input",11),e()(),v(36,je,3,1,"div",12),t(37,"div",3)(38,"ion-button",13),M("click",function(){return n.save()}),v(39,Fe,1,0,"ion-spinner",14),r(40," Log Expense "),e(),t(41,"ion-button",15),M("click",function(){return n.dismiss()}),r(42,"Cancel"),e()()()),i&2&&(a(12),p("value",E(13,8,n.expense.date,"dd MMM yyyy")),a(7),P("ngModel",n.expense.category),a(4),P("ngModel",n.expense.notes),a(4),P("ngModel",n.expense.amount),a(8),p("value",n.currentUser),a(),p("ngIf",n.errorMsg),a(2),p("disabled",n.saving||!n.expense.amount||!n.expense.category),a(),p("ngIf",n.saving))},dependencies:[O,T,X,oe,te,ie,ne,D,ve,de,pe,fe,_e,ae,me,L,B,z,A,W,he],styles:[".expense-modal[_ngcontent-%COMP%]{padding:1.5rem}.expense-modal[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1rem;font-size:1.3em;text-align:center}.expense-modal[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin-bottom:.5rem}.expense-modal[_ngcontent-%COMP%]   .modal-actions[_ngcontent-%COMP%]{margin-top:1.5rem;display:flex;flex-direction:column;gap:.5rem}"]});let s=l;return s})();var De=()=>["list"];function Ne(s,l){if(s&1&&(t(0,"div",11)(1,"div",12)(2,"ion-text",13),r(3),g(4,"relativeTime"),e()()()),s&2){let u=_();a(3),y(" Last synced: ",C(4,1,u.lastPaymentSync)," ")}}function Re(s,l){if(s&1&&(t(0,"div",14)(1,"div",15)(2,"div",16),m(3,"ion-icon",17),e(),t(4,"div",18),r(5,"Total Earnings"),e(),t(6,"div",19),r(7),g(8,"async"),g(9,"number"),e(),t(10,"div",20),r(11),g(12,"async"),e(),t(13,"div",21),m(14,"ion-icon",22),e()(),t(15,"div",23)(16,"div",24),m(17,"ion-icon",25),e(),t(18,"div",18),r(19,"This Month"),e(),t(20,"div",19),r(21),g(22,"number"),e(),t(23,"div",20),r(24),e()(),t(25,"div",26)(26,"div",27),m(27,"ion-icon",17),e(),t(28,"div",18),r(29,"Total Expenses"),e(),t(30,"div",28),r(31),g(32,"number"),e(),t(33,"div",20),r(34),e(),t(35,"div",21),m(36,"ion-icon",22),e()(),t(37,"div",29)(38,"div",27),m(39,"ion-icon",25),e(),t(40,"div",18),r(41,"This Month's Expenses"),e(),t(42,"div",28),r(43),g(44,"number"),e(),t(45,"div",20),r(46),e()()()),s&2){let u,o,i=_();a(),p("routerLink",F(26,De)),a(6),y("\u20B9",E(9,12,((u=C(8,10,i.summary$))==null?null:u.totalAmount)||0,"1.0-0"),""),a(4),y("",((o=C(12,15,i.summary$))==null?null:o.totalPayments)||0," total payments"),a(10),y("\u20B9",E(22,17,i.currentMonthEarnings,"1.0-0"),""),a(3),y("",i.currentMonthPayments," payments this month"),a(),p("routerLink",F(27,De)),a(6),y("\u20B9",E(32,20,i.totalExpenses,"1.0-0"),""),a(3),y("",i.expenses.length," entries"),a(9),y("\u20B9",E(44,23,i.currentMonthExpenses,"1.0-0"),""),a(3),y("",i.currentMonthExpenseCount," entries")}}function $e(s,l){if(s&1&&(t(0,"ion-card",30)(1,"ion-card-header")(2,"ion-card-title"),r(3,"Monthly Earnings"),e()(),t(4,"ion-card-content")(5,"div",31),m(6,"google-chart",32),e()()()),s&2){let u=_();a(6),p("type",u.chartType)("data",u.chartData)("columns",u.chartColumns)("options",u.chartOptions)("height",300)}}function Ve(s,l){s&1&&(t(0,"div",33)(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),m(4,"ion-skeleton-text",34),e()(),t(5,"ion-card-content"),m(6,"ion-skeleton-text",35)(7,"ion-skeleton-text",36),e()()()),s&2&&(a(4),p("animated",!0),a(2),p("animated",!0),a(),p("animated",!0))}N({refresh:R,wallet:Ie,calendar:be,chevronForwardOutline:Pe,add:Se});var ct=(()=>{let l=class l{constructor(o,i,n,d,c,h){this.paymentService=o,this.toastController=i,this.clubContext=n,this.expenseService=d,this.modalController=c,this.authService=h,this.loading$=this.paymentService.loading$,this.summary$=this.paymentService.summary$,this.displayedGroups=[],this.chartType=Ce.LineChart,this.chartColumns=["Month","Payments","Expenses",{type:"string",role:"tooltip"}],this.chartData=[],this.chartOptions={backgroundColor:"transparent",colors:["#2dd36f","#eb445a"],chartArea:{left:60,top:20,width:"85%",height:"75%"},hAxis:{textStyle:{fontSize:12,color:"#666"},gridlines:{color:"transparent"}},vAxis:{textStyle:{fontSize:12,color:"#666"},gridlines:{color:"#e0e0e0",count:5},minValue:0},legend:{position:"top",alignment:"center",textStyle:{color:"#666"}},animation:{startup:!0,duration:1e3,easing:"out"},pointSize:5,lineWidth:2},this.currentMonthEarnings=0,this.currentMonthPayments=0,this.lastPaymentSync=null,this.expenses=[],this.totalExpenses=0,this.currentMonthExpenses=0,this.currentMonthExpenseCount=0,this.today=new Date,this.refreshing=!1,N({refresh:R}),this.lastPaymentSync=this.clubContext.getLastPaymentRefresh()}prepareChartData(o){if(!o){this.chartData=[];return}let i=Object.keys(o.monthBreakdown),n=this.expenses.map(x=>x.date.substring(0,7)),d=new Set([...i,...n]),c=Array.from(d).sort(),h={};this.expenses.forEach(x=>{let j=x.date.substring(0,7);h[j]=(h[j]||0)+x.amount}),this.chartData=c.map(x=>{var q;let $=new Date(x+"-01").toLocaleString("default",{month:"short",year:"2-digit"}),Be=((q=o.monthBreakdown[x])==null?void 0:q.amount)||0,V=h[x]||0;return[$,Be,V,`${$}
Expenses: \u20B9${V}`]})}ngOnInit(){this.paymentService.payments$.subscribe(o=>{o&&this.processPayments(o)}),this.summary$.subscribe(o=>{this.prepareChartData(o)}),this.expenseService.expenses$.subscribe(o=>{this.expenses=o,this.calculateExpenses()}),this.paymentService.loadData().catch(o=>{console.error("Error initializing payments:",o)}),this.expenseService.loadData().catch(o=>{console.error("Error initializing expenses:",o)})}processPayments(o){let i=new Map,n=new Date().toISOString().substring(0,7);this.currentMonthEarnings=0,this.currentMonthPayments=0,o.forEach(d=>{let c=new Date(d.date),h=c.toISOString().substring(0,7);h===n&&(this.currentMonthEarnings+=d.amount,this.currentMonthPayments++),i.has(h)||i.set(h,{month:h,formattedDate:c.toLocaleDateString("en-US",{month:"long",year:"numeric"}),payments:[],total:0});let x=i.get(h);x.payments.push(d),x.total+=d.amount}),this.displayedGroups=Array.from(i.values()).sort((d,c)=>c.month.localeCompare(d.month))}calculateExpenses(){let o=new Date().toISOString().substring(0,7);this.totalExpenses=0,this.currentMonthExpenses=0,this.currentMonthExpenseCount=0,this.expenses.forEach(i=>{this.totalExpenses+=i.amount,i.date.substring(0,7)===o&&(this.currentMonthExpenses+=i.amount,this.currentMonthExpenseCount++)})}refreshPayments(){return S(this,null,function*(){if(!this.refreshing)try{this.refreshing=!0,console.log("Refreshing payment and expense data..."),yield Promise.all([this.paymentService.refreshData(),this.expenseService.refreshData()]),this.lastPaymentSync=this.clubContext.getLastPaymentRefresh(),console.log("Payment and expense data refreshed successfully"),yield(yield this.toastController.create({message:"Payment and expense data refreshed successfully",duration:2e3,color:"success"})).present()}catch(o){console.error("Error refreshing payment or expense data:",o),yield(yield this.toastController.create({message:"Failed to refresh payment or expense data",duration:2e3,color:"danger"})).present()}finally{this.refreshing=!1}})}showPaymentDetails(o){console.log("Show payment details:",o)}goToPaymentsList(){console.log("Navigating to payments list...")}openExpenseModal(){return S(this,null,function*(){console.log("Opening expense modal...");let o="Unknown";console.log("Current user for expense modal:",o);let i=yield this.modalController.create({component:Oe,componentProps:{currentUser:o},showBackdrop:!0,backdropDismiss:!1,cssClass:"expense-modal",presentingElement:document.body.querySelector("ion-app")||void 0});i.onWillDismiss().then(n=>S(this,null,function*(){n.data&&n.data.expense&&(yield this.expenseService.addExpense(n.data.expense),this.expenseService.loadData(),(yield this.toastController.create({message:"Expense logged successfully",duration:1500,color:"success"})).present())})),yield i.present()})}};l.\u0275fac=function(i){return new(i||l)(f(Te),f(xe),f(we),f(b),f(U),f(Ee))},l.\u0275cmp=k({type:l,selectors:[["app-payments"]],decls:20,vars:13,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"click","disabled"],["slot","icon-only","name","refresh"],[3,"click"],["slot","icon-only","name","add"],["class","results-row",4,"ngIf"],["class","stats-grid",4,"ngIf"],["class","chart-card",4,"ngIf"],["class","ion-padding",4,"ngIf"],[1,"results-row"],[1,"last-sync-info"],["color","medium",1,"last-sync-label"],[1,"stats-grid"],[1,"stat-card","earnings-card",3,"routerLink"],[1,"stat-icon","total-earnings",2,"background","#2dd36f","color","#fff"],["name","wallet"],[1,"stat-label"],[1,"stat-value"],[1,"stat-subtext"],[1,"view-details"],["name","chevron-forward-outline","size","small"],[1,"stat-card","earnings-card"],[1,"stat-icon","monthly-earnings",2,"background","#2dd36f","color","#fff"],["name","calendar"],[1,"stat-card","expense-card",3,"routerLink"],[1,"stat-icon",2,"background","#eb445a","color","#fff"],[1,"stat-value","expense-value"],[1,"stat-card","expense-card"],[1,"chart-card"],[2,"display","flex","justify-content","center","align-items","center"],[3,"type","data","columns","options","height"],[1,"ion-padding"],[2,"width","60%",3,"animated"],[2,"width","100%",3,"animated"],[2,"width","80%",3,"animated"]],template:function(i,n){i&1&&(t(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),m(3,"ion-menu-button"),e(),t(4,"ion-title"),r(5,"Payments"),e(),t(6,"ion-buttons",2)(7,"ion-button",3),M("click",function(){return n.refreshPayments()}),m(8,"ion-icon",4),e(),t(9,"ion-button",5),M("click",function(){return n.openExpenseModal()}),m(10,"ion-icon",6),e()()()(),t(11,"ion-content"),v(12,Ne,5,3,"div",7),g(13,"async"),v(14,Re,47,28,"div",8),g(15,"async"),v(16,$e,7,5,"ion-card",9),g(17,"async"),v(18,Ve,8,3,"div",10),g(19,"async"),e()),i&2&&(a(7),p("disabled",n.refreshing),a(5),p("ngIf",!C(13,5,n.loading$)),a(2),p("ngIf",!C(15,7,n.loading$)),a(2),p("ngIf",!C(17,9,n.loading$)&&n.chartData.length>0),a(2),p("ngIf",C(19,11,n.loading$)))},dependencies:[O,T,Q,Z,ee,z,A,W,L,re,le,se,ce,B,ue,ge,D,ye,Me,ke],styles:[".stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px}.stat-card[_ngcontent-%COMP%]{background-color:var(--ion-card-background);border-radius:8px;padding:16px;display:flex;flex-direction:column;align-items:flex-start;box-shadow:0 4px 6px #0000001a;position:relative;transition:background-color .2s ease}.stat-card[routerLink][_ngcontent-%COMP%]{cursor:pointer}.stat-card[routerLink][_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.stat-card[_ngcontent-%COMP%]:active{background-color:#0000000d}.stat-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-bottom:12px}.stat-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#fff}.stat-icon.total-earnings[_ngcontent-%COMP%]{background-color:var(--ion-color-primary)}.stat-icon.monthly-earnings[_ngcontent-%COMP%]{background-color:var(--ion-color-success)}.stat-label[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.9rem;font-weight:500;margin-bottom:4px}.stat-value[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:var(--ion-color-success, #2dd36f)!important;margin-bottom:4px}.expense-value[_ngcontent-%COMP%]{color:#eb445a!important;font-weight:600}.stat-subtext[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.85rem}.view-details[_ngcontent-%COMP%]{position:absolute;bottom:12px;right:12px;display:flex;align-items:center;gap:4px;font-size:.8rem}.view-details[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1rem}.chart-card[_ngcontent-%COMP%]{margin:12px}.amount-note[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem}.status-badge[_ngcontent-%COMP%]{margin-left:8px;text-transform:capitalize}.last-sync-info[_ngcontent-%COMP%]{padding-right:16px;padding-top:8px;font-size:.9em;opacity:.7;vertical-align:middle;text-align:right}"]});let s=l;return s})();export{ct as PaymentsPage};
