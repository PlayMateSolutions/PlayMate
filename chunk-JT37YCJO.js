import{a as pe,e as v,f as Se}from"./chunk-XT6IINF4.js";import"./chunk-T47TWMLD.js";import{a as Ce}from"./chunk-4D53AV6Y.js";import{J as fe,a as he}from"./chunk-OMMW57FB.js";import{$ as f,Aa as T,B as w,Bc as ue,Cc as de,Fc as me,H as m,Ha as H,Hc as ge,I as g,Mb as K,Na as O,Ob as Q,Pb as X,Q as L,R as d,S as h,Ta as W,U as A,Wa as D,Wb as Y,Xa as F,Ya as z,Z as E,Zb as Z,ac as $,bc as ee,ca as i,cb as G,cc as te,da as o,dc as ie,ea as S,ec as ne,fa as j,ga as N,hc as oe,ia as M,ic as ae,j as y,jb as R,ka as C,kc as re,la as b,mb as J,qc as se,rb as q,rc as le,ta as U,ua as a,va as x,y as B,ya as k,za as P,zc as ce}from"./chunk-QTDLHZUQ.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{i as p}from"./chunk-OYAVQN5W.js";var Ie=(()=>{let r=class r{constructor(t,n){this.http=t,this.authService=n,this.apiUrl=pe.apiUrl}getHeaders(){return p(this,null,function*(){let t=new D({"Content-Type":"text/plain;charset=utf-8"}),n=yield this.authService.getAuthToken();return n&&(t=t.set("Authorization",`Bearer ${n}`)),t})}get(l,u){return p(this,arguments,function*(t,n,e={}){let c=yield this.authService.getAuthToken();var _=new F().set("sportsClubId",n).set("action",t).set("authorization",c?"Bearer "+c:"");for(let V of Object.keys(e))_=_.set(V,e[V]);let be={headers:new D({"Content-Type":"text/plain;charset=utf-8"}),params:_,responseType:"json",observe:"body"};return y(this.http.get(this.apiUrl,be))})}post(e){return p(this,arguments,function*(t,n={}){let l=yield this.getHeaders(),u={action:t,data:n};return y(this.http.post(this.apiUrl,JSON.stringify(u),{headers:l}))})}};r.\u0275fac=function(n){return new(n||r)(w(z),w(v))},r.\u0275prov=B({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();function we(s,r){s&1&&(j(0),S(1,"ion-spinner",15),N())}function Ee(s,r){if(s&1){let I=M();i(0,"ion-button",16),C("click",function(){m(I);let n=b();return g(n.saveSettings())}),S(1,"ion-icon",17),o()}if(s&2){let I=b();f("disabled",!I.hasChanges)}}function Me(s,r){if(s&1&&(i(0,"ion-avatar",2),S(1,"img",18),o()),s&2){let I=b();d(),f("src",I.userPicture,L)}}var Ge=(()=>{let r=class r{constructor(t,n,e,l,u){this.clubContext=t,this.toastCtrl=n,this.router=e,this.authService=l,this.apiService=u,this.sportsClubId="",this.hasChanges=!1,this.loading=!1,this.darkMode=!1,this.language="en",this.userEmail="",this.userName="",this.userPicture="",this.darkMode=document.body.classList.contains("dark-theme"),this.language=localStorage.getItem("language")||"en"}ngOnInit(){let t=this.clubContext.getSportsClubId();this.sportsClubId=t||"",this.loadUserInfo(),he({saveOutline:fe})}loadUserInfo(){this.authService.userSession$.subscribe(t=>{t&&(this.userEmail=t.email,this.userName=t.name,this.userPicture=t.picture||"")})}settingsChanged(){this.hasChanges=!0}saveSettings(){return p(this,null,function*(){this.loading=!0;let t=this.sportsClubId.trim(),n=this.clubContext.getSportsClubId()||"";if(t)if(t!==n)try{let e=yield this.apiService.get("getSportsClubById",t);console.log("Club ID validation response:",e),e.status==="success"&&e.data&&e.data.active?(this.clubContext.setSportsClubId(t),yield(yield this.toastCtrl.create({message:"Settings saved successfully!",duration:1500,color:"success"})).present(),this.hasChanges=!1):yield(yield this.toastCtrl.create({message:"Invalid or inactive Sports Club ID.",duration:1500,color:"danger"})).present()}catch(e){console.error("Error validating club ID:",e),yield(yield this.toastCtrl.create({message:"Failed to validate Sports Club ID. Please try again.",duration:1500,color:"danger"})).present()}finally{this.loading=!1}else this.clubContext.setSportsClubId(t),yield(yield this.toastCtrl.create({message:"Settings saved successfully!",duration:1500,color:"success"})).present(),this.hasChanges=!1,this.loading=!1;else(yield this.toastCtrl.create({message:"Please enter a valid Sports Club ID.",duration:1500,color:"danger"})).present(),this.loading=!1})}toggleDarkMode(){document.body.classList.toggle("dark-theme",this.darkMode),this.clubContext.setDarkMode(this.darkMode)}changeLanguage(){this.clubContext.setLanguage(this.language)}logout(){return p(this,null,function*(){if(window.confirm("Are you sure you want to logout? This will delete all your local PlayMate data."))try{yield this.authService.logout();try{yield Ce.deleteDatabase(),console.log("PlayMateDB deleted successfully")}catch(n){console.error("Error deleting PlayMateDB:",n)}this.clubContext.clear(),yield this.router.navigate(["/login"],{replaceUrl:!0})}catch(n){console.error("Logout error:",n),yield(yield this.toastCtrl.create({message:"Error during logout. Please try again.",duration:2e3,color:"danger"})).present()}})}};r.\u0275fac=function(n){return new(n||r)(h(Se),h(ce),h(G),h(v),h(Ie))},r.\u0275cmp=A({type:r,selectors:[["app-settings"]],decls:63,vars:8,consts:[["saveBtn",""],["color","primary"],["slot","start"],["slot","end"],[4,"ngIf","ngIfElse"],[1,"ion-padding"],["position","stacked"],["placeholder","Enter Sports Club ID","type","text",3,"ionInput","value"],[3,"ngModelChange","ionChange","ngModel"],["value","en"],["value","ta"],["lines","none"],["slot","start",4,"ngIf"],["slot","end","fill","clear","color","danger",3,"click"],["slot","start","name","log-out-outline"],["name","circular"],[3,"click","disabled"],["slot","start","name","save-outline"],["alt","Profile Picture",3,"src"]],template:function(n,e){if(n&1){let l=M();i(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),S(3,"ion-menu-button"),o(),i(4,"ion-title"),a(5,"Settings"),o(),i(6,"ion-buttons",3),E(7,we,2,0,"ng-container",4)(8,Ee,2,1,"ng-template",null,0,H),o()()(),i(10,"ion-content",5)(11,"ion-list")(12,"ion-item-group")(13,"ion-item-divider")(14,"ion-label"),a(15,"Club Settings"),o()(),i(16,"ion-item")(17,"ion-label",6),a(18,"Sports Club ID"),o(),i(19,"ion-input",7),C("ionInput",function(c){return m(l),e.sportsClubId=c.target.value,g(e.settingsChanged())}),o(),i(20,"ion-note"),a(21,"This ID is used to identify your club in the system"),o()()(),i(22,"ion-item-group")(23,"ion-item-divider")(24,"ion-label"),a(25,"App Settings"),o()(),i(26,"ion-item")(27,"ion-label"),a(28,"Dark Mode"),o(),i(29,"ion-toggle",8),T("ngModelChange",function(c){return m(l),P(e.darkMode,c)||(e.darkMode=c),g(c)}),C("ionChange",function(){return m(l),g(e.toggleDarkMode())}),o()(),i(30,"ion-item")(31,"ion-label"),a(32,"Language"),o(),i(33,"ion-select",8),T("ngModelChange",function(c){return m(l),P(e.language,c)||(e.language=c),g(c)}),C("ionChange",function(){return m(l),g(e.changeLanguage())}),i(34,"ion-select-option",9),a(35,"English"),o(),i(36,"ion-select-option",10),a(37,"Tamil"),o()()()(),i(38,"ion-item-group")(39,"ion-item-divider")(40,"ion-label"),a(41,"Account"),o()(),i(42,"ion-item",11),E(43,Me,2,1,"ion-avatar",12),i(44,"ion-label")(45,"h2"),a(46),o(),i(47,"p"),a(48),o(),i(49,"p"),a(50,"Google Account"),o()(),i(51,"ion-button",13),C("click",function(){return m(l),g(e.logout())}),S(52,"ion-icon",14),a(53," Logout "),o()()(),i(54,"ion-item-group")(55,"ion-item-divider")(56,"ion-label"),a(57,"About"),o()(),i(58,"ion-item")(59,"ion-label"),a(60,"Version"),o(),i(61,"ion-note",3),a(62,"1.0.0"),o()()()()()}if(n&2){let l=U(9);d(7),f("ngIf",e.loading)("ngIfElse",l),d(12),f("value",e.sportsClubId),d(10),k("ngModel",e.darkMode),d(4),k("ngModel",e.language),d(10),f("ngIf",e.userPicture),d(3),x(e.userName),d(2),x(e.userEmail)}},dependencies:[W,O,q,R,J,Z,le,X,oe,se,Q,ue,Y,ne,te,ee,$,ie,de,ae,ge,me,re,K],encapsulation:2});let s=r;return s})();export{Ge as SettingsPage};
