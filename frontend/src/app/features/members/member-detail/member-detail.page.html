<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/members"></ion-back-button>
    </ion-buttons>
    <ion-title>Member Details</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="member">
  <ion-card class="member-detail-card" [ngClass]="member.status ? member.status.toLowerCase() : ''">
    <ion-card-content class="card-content">
      <div class="member-info-row" style="display: flex; align-items: center;">
        <div class="member-avatar" style="width:48px; height:48px; border-radius:50%; background:#3880ff; color:#fff; display:flex; align-items:center; justify-content:center; font-size:1.5em; font-weight:bold; margin-right:16px;">
          {{ member.firstName ? member.firstName.charAt(0).toUpperCase() : '?' }}
        </div>
        <div class="member-info" style="flex:1;">
          <div class="member-name">
            <strong>{{ member.firstName }} {{ member.lastName }}</strong>
            <small class="member-id">ID: {{ member.id }}</small>
          </div>
          <div>Phone: {{ member.phone || 'N/A' }}</div>
          <div>Status: {{ member.status || 'N/A' }}</div>
          <div>Joined: {{ member.joinDate ? (member.joinDate | date:'mediumDate') : 'N/A' }}</div>
          <div>Expiry: {{ member.expiryDate ? (member.expiryDate | date:'mediumDate') : 'N/A' }}</div>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <ion-segment value="attendance" (ionChange)="onTabChange($event)" style="margin: 1.5rem 0 1rem 0;">
    <ion-segment-button value="attendance">
      <ion-label>Attendance</ion-label>
    </ion-segment-button>
    <ion-segment-button value="payments">
      <ion-label>Payments</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div *ngIf="selectedTab === 'attendance'">
    <h3 style="margin-bottom: 0.5rem;">Attendance</h3>
    <app-calendar-grid 
      [events]="attendanceDates"
      [paymentEvents]="paymentDates">
    </app-calendar-grid>
  </div>

  <div *ngIf="selectedTab === 'payments'">
    <h3 style="margin-bottom: 0.5rem;">Payments</h3>
    <ion-list *ngIf="payments.length > 0">
      <ion-item *ngFor="let payment of payments">
        <ion-label>
          <div style="font-weight: 600;">â‚¹{{ payment.amount | number:'1.0-0' }} <span style="font-size:0.9em; color:var(--ion-color-medium);">{{ payment.paymentType }}</span></div>
          <div style="font-size:0.95em; color:var(--ion-color-medium);">{{ payment.date | date:'mediumDate' }}</div>
          <div *ngIf="payment.notes" style="font-size:0.9em; color:var(--ion-color-tertiary);">{{ payment.notes }}</div>
        </ion-label>
        <ion-note slot="end" [color]="payment.status === 'Paid' ? 'success' : 'warning'" [ngStyle]="payment.status === 'Paid' ? {'background':'#2dd36f','color':'#fff','border-radius':'8px','padding':'2px 10px','font-weight':'bold'} : {}">
          {{ payment.status }}
        </ion-note>
      </ion-item>
    </ion-list>
    <div *ngIf="payments.length === 0" class="ion-text-center ion-padding">
      <ion-note color="medium">No payments found for this member.</ion-note>
    </div>
  </div>
</ion-content>
<ion-content *ngIf="!member">
  <ion-card>
    <ion-card-content>
      <div class="ion-text-danger">Member not found.</div>
    </ion-card-content>
  </ion-card>
</ion-content>
