<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Payments</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="refreshPayments()" [disabled]="refreshing">
        <ion-icon slot="icon-only" name="refresh"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-toolbar>
    <ion-searchbar
      placeholder="Search payments"
      (ionInput)="onSearchChange($event)"
      [debounce]="500">
    </ion-searchbar>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Statistics Card -->
  <ion-card *ngIf="!(loading$ | async)">
    <ion-card-header>
      <ion-card-title>Payment Statistics</ion-card-title>
      <ion-card-subtitle>{{ (summary$ | async)?.totalPayments || 0 }} total payments</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <div class="stats-grid">
        <div class="stat-item">
          <strong>Total Amount</strong>
          <span>₹{{ (summary$ | async)?.totalAmount || 0 | number:'1.0-0' }}</span>
        </div>
        <div class="stat-item">
          <strong>Unique Members</strong>
          <span>{{ (summary$ | async)?.uniqueMembers || 0 }}</span>
        </div>
        <!-- Monthly comparison will be added here -->
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Loading Skeleton -->
  <div *ngIf="loading$ | async" class="ion-padding">
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-skeleton-text [animated]="true" style="width: 60%"></ion-skeleton-text>
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-skeleton-text [animated]="true" style="width: 100%"></ion-skeleton-text>
        <ion-skeleton-text [animated]="true" style="width: 80%"></ion-skeleton-text>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Payment Groups List -->
  <div class="payment-list" *ngIf="!(loading$ | async) && displayedGroups.length > 0">
    <div *ngFor="let group of displayedGroups" class="date-group">
      <ion-item-divider sticky="true" color="light">
        <ion-label>{{ group.formattedDate }}</ion-label>
        <ion-note slot="end">₹{{ group.total | number:'1.0-0' }}</ion-note>
      </ion-item-divider>
      
      <ion-list lines="full">
        <ion-item *ngFor="let payment of group.payments" class="payment-item" (click)="showPaymentDetails(payment)">
          <ion-label>
            <h2>{{ payment.memberName || 'Unknown Member' }}
              <ion-note color="medium" class="id-note">#{{ payment.memberId }}</ion-note>
            </h2>
            <ion-note color="medium">
              {{ payment.date | date:'mediumDate' }} · {{ payment.paymentType }}
              <ion-badge *ngIf="payment.status !== 'active'" color="danger" class="status-badge">
                {{ payment.status }}
              </ion-badge>
            </ion-note>
          </ion-label>
          <ion-note slot="end" color="success" class="amount-note">
            ₹{{ payment.amount | number:'1.0-0' }}
          </ion-note>
        </ion-item>
      </ion-list>
    </div>

    <!-- Infinite Scroll -->

  </div>

  <!-- No Payments Message -->
  <ion-card *ngIf="!(loading$ | async) && displayedGroups.length === 0" class="no-data-card">
    <ion-card-content class="ion-text-center">
      <ion-label color="medium">
        <h2>No Payments Found</h2>
        <p *ngIf="!searchQuery">There are no payment records.</p>
        <p *ngIf="searchQuery">No payments match your search criteria.</p>
      </ion-label>
    </ion-card-content>
  </ion-card>
</ion-content>
