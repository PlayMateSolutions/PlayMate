<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Payments</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="refreshPayments()" [disabled]="refreshing">
        <ion-icon slot="icon-only" name="refresh"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Last Payment Sync Info -->
  <div class="results-row" *ngIf="!(loading$ | async)">
    <div class="last-sync-info" >
      <ion-text color="medium" class="last-sync-label">
        Last synced: {{ lastPaymentSync | relativeTime }}
      </ion-text>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid" *ngIf="!(loading$ | async)">
    <!-- Total Earnings Card -->
    <div class="stat-card" [routerLink]="['list']">
      <div class="stat-icon total-earnings">
        <ion-icon name="wallet"></ion-icon>
      </div>
      <div class="stat-label">Total Earnings</div>
      <div class="stat-value">₹{{ (summary$ | async)?.totalAmount || 0 | number:'1.0-0' }}</div>
      <div class="stat-subtext">{{ (summary$ | async)?.totalPayments || 0 }} total payments</div>
      <div class="view-details">
        <ion-icon name="chevron-forward-outline" size="small"></ion-icon>
        <small>View All</small>
      </div>
    </div>
    
    <!-- Monthly Earnings Card -->
    <div class="stat-card">
      <div class="stat-icon monthly-earnings">
        <ion-icon name="calendar"></ion-icon>
      </div>
      <div class="stat-label">This Month</div>
      <div class="stat-value">₹{{ currentMonthEarnings | number:'1.0-0' }}</div>
      <div class="stat-subtext">{{ currentMonthPayments }} payments this month</div>
    </div>
  </div>

  <!-- Monthly Earnings Chart -->
  <ion-card *ngIf="!(loading$ | async) && chartData.length > 0" class="chart-card">
    <ion-card-header>
      <ion-card-title>Monthly Earnings</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div style="display: flex; justify-content: center; align-items: center;">
        <google-chart
          [type]="chartType"
          [data]="chartData"
          [columns]="chartColumns"
          [options]="chartOptions"
          [height]="300">
        </google-chart>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Loading Skeleton -->
  <div *ngIf="loading$ | async" class="ion-padding">
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-skeleton-text [animated]="true" style="width: 60%"></ion-skeleton-text>
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-skeleton-text [animated]="true" style="width: 100%"></ion-skeleton-text>
        <ion-skeleton-text [animated]="true" style="width: 80%"></ion-skeleton-text>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
