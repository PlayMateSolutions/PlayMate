import{a as I,e as N,f as C}from"./chunk-DSDURIJA.js";import{A as b,Qa as h,Ra as f,Sa as v,f as p,g as x,j as i,q as l,v as d,x as j}from"./chunk-M53L3PTZ.js";import{a as w,b as S,i as m}from"./chunk-OYAVQN5W.js";var g=(()=>{let r=class r{static openDB(){return new Promise((s,o)=>{let a=indexedDB.open(r.dbName,r.version);a.onupgradeneeded=n=>{let t=n.target.result;if(t.objectStoreNames.contains(r.storeName)||t.createObjectStore(r.storeName,{keyPath:"id"}),!t.objectStoreNames.contains("attendance")){let e=t.createObjectStore("attendance",{keyPath:"id"});e.createIndex("memberId","memberId",{unique:!1}),e.createIndex("date","date",{unique:!1}),e.createIndex("membershipStatus","membershipStatus",{unique:!1}),e.createIndex("dateRange",["date","memberId"],{unique:!1})}t.objectStoreNames.contains("attendanceSettings")||t.createObjectStore("attendanceSettings",{keyPath:"key"})},a.onsuccess=()=>s(a.result),a.onerror=()=>o(a.error)})}static getAll(){return m(this,null,function*(){let s=yield r.openDB();return new Promise((o,a)=>{let e=s.transaction(r.storeName,"readonly").objectStore(r.storeName).getAll();e.onsuccess=()=>o(e.result),e.onerror=()=>a(e.error)})})}static setAll(s){return m(this,null,function*(){let o=yield r.openDB();return new Promise((a,n)=>{var c;let t=o.transaction(r.storeName,"readwrite"),e=t.objectStore(r.storeName);e.clear();for(let y of s){let P=S(w({},y),{id:(c=y.ID)!=null?c:y.id});e.put(P)}t.oncomplete=()=>a(),t.onerror=()=>n(t.error)})})}};r.dbName="PlayMateDB",r.storeName="members",r.version=3;let u=r;return u})();var D=(()=>{let r=class r{constructor(s,o,a){this.http=s,this.authService=o,this.clubContext=a,this.apiUrl=I.apiUrl}getRequestPayload(a){return m(this,arguments,function*(s,o={}){let n=yield this.authService.getAuthToken();return{action:s,payload:o,authorization:n?"Bearer "+n:void 0}})}getMembers(){return p(g.getAll()).pipe(i(s=>({members:s,isFresh:!1})),l(()=>x({members:[],isFresh:!1})))}refreshMembers(){return p(this.authService.getAuthToken()).pipe(d(s=>{let o=this.clubContext.getSportsClubId()||"",a=new f().set("sportsClubId",o).set("action","getMembers").set("authorization",s?"Bearer "+s:""),t={headers:new h({"Content-Type":"text/plain;charset=utf-8"}),params:a,responseType:"json",observe:"body"};return this.http.get(this.apiUrl,t).pipe(i(e=>{var c;if(e.status==="error")throw new Error((c=e.error)==null?void 0:c.message);return e.data||[]}),d(e=>p(g.setAll(e)).pipe(i(()=>e))),i(e=>({members:e,isFresh:!0})),l(e=>{throw console.error("Error fetching members:",e),e}))}))}searchMembers(s){return p(this.authService.getAuthToken()).pipe(d(o=>{let a=new f().set("action","getMembers").set("payload",JSON.stringify({filters:{searchTerm:s}})).set("authorization",o?"Bearer "+o:""),t={headers:new h({"Content-Type":"text/plain;charset=utf-8"}),params:a,responseType:"json",observe:"body"};return this.http.get(this.apiUrl,t).pipe(i(e=>{var c;if(e.status==="error")throw new Error((c=e.error)==null?void 0:c.message);return e.data||[]}),l(e=>{throw console.error("Error searching members:",e),e}))}))}addMember(s){return p(this.getRequestPayload("addMember",s)).pipe(d(o=>{let a=new f().set("action","addMember").set("payload",JSON.stringify(o));return this.http.post(this.apiUrl,null,{params:a,headers:new h({"Content-Type":"text/plain;charset=utf-8"})}).pipe(i(n=>{if(n.status==="success"&&n.data)return n.data;throw new Error("Failed to add member")}))}))}updateMember(s){return p(this.getRequestPayload("updateMember",s)).pipe(d(o=>{let n={headers:new h({"Content-Type":"text/plain;charset=utf-8"}),responseType:"json",observe:"body"};return this.http.post(this.apiUrl,o,n).pipe(i(t=>{var e;if(t.status==="error")throw new Error((e=t.error)==null?void 0:e.message);return t.data}))}))}deleteMember(s){return p(this.getRequestPayload("deleteMember",{memberId:s})).pipe(d(o=>{let n={headers:new h({"Content-Type":"text/plain;charset=utf-8"}),responseType:"json",observe:"body"};return this.http.post(this.apiUrl,o,n).pipe(i(t=>{var e;if(t.status==="error")throw new Error((e=t.error)==null?void 0:e.message);return t.data||!1}))}))}};r.\u0275fac=function(o){return new(o||r)(b(v),b(N),b(C))},r.\u0275prov=j({token:r,factory:r.\u0275fac,providedIn:"root"});let u=r;return u})();export{D as a};
