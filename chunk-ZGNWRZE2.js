import{a as Ne}from"./chunk-IWGSKPVT.js";import{a as Ue}from"./chunk-UWHUA5XG.js";import{a as G}from"./chunk-ACDW2MD6.js";import{a as R,e as Pe,f as Be}from"./chunk-HLDYDQ4G.js";import"./chunk-T47TWMLD.js";import{$ as Z,Aa as j,Ac as Ie,Ba as q,Cc as xe,Gc as Te,I as S,Ia as re,Ic as Ae,J as k,Jc as Me,Nb as ue,Oa as oe,Pb as ge,Qb as he,R as J,S as f,T as x,Ua as se,V as X,Xb as me,_ as L,_b as pe,aa as y,ad as Ve,bc as be,cc as ve,da as o,db as ae,dc as fe,ea as a,ec as Se,fa as _,fc as ke,ga as B,ha as N,hd as De,ic as _e,ja as T,jc as we,kb as le,la as I,lc as Ce,ma as C,nb as ce,ra as ee,rc as Ee,rd as Le,sa as te,sb as de,sc as ye,ta as ie,ua as ne,va as u,wa as U,za as O}from"./chunk-CCDMTYGH.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as Y,b as $,i as v}from"./chunk-OYAVQN5W.js";(()=>{var c="https://apis.google.com/js/api.js",m="https://accounts.google.com/gsi/client";function d(e="client:picker"){return v(this,null,function*(){return window.gapi||(yield r(c)),yield new Promise(t=>{window.gapi.load(e,t)}),window.google})}function i(e){return v(this,null,function*(){var t,s;return(s=(t=window.google)==null?void 0:t.accounts)!=null&&s.oauth2||(yield r(m)),new Promise((g,h)=>{window.google.accounts.oauth2.initTokenClient($(Y({},e),{callback:g,error_callback:h})).requestAccessToken()})})}function r(e){return v(this,null,function*(){return new Promise((t,s)=>{document.querySelector(`script[src="${e}"]`)?t():document.head.appendChild(Object.assign(document.createElement("script"),{src:e,onload:t,onerror:s}))})})}function n(e,t){let s=e.getAttribute(t);return s?Number(s):null}var l=(e=>(e[e.FALSE=0]="FALSE",e[e.TRUE=1]="TRUE",e[e.DEFAULT=2]="DEFAULT",e))(l||{});function b(e,t){return e.hasAttribute(t)}function p(e,t){var h;let s=(h=e.getAttribute(t))==null?void 0:h.toUpperCase();if(!s)return 2;let g=l[s];if(g!==void 0)return g;throw new Error(`Invalid value, "${s}", for attribute ${t}. Must be one of ${Object.keys(l).filter(Number.isNaN).join(", ")}`)}function w(e,t,s,g){let h=p(t,e);return h===2?g:s.call(g,h===1)}var A=class extends HTMLElement{static get observedAttributes(){return["app-id","client-id","debounce-delay","developer-key","hide-title-bar","locale","max-items","mine-only","multiselect","nav-hidden","oauth-token","origin","relay-url","scope","title"]}picker;observer;google;loading;debounceTimer;get visible(){var e;return!!((e=this.picker)!=null&&e.isVisible())}set visible(e){var t;(t=this.picker)==null||t.setVisible(e)}get tokenClientConfig(){var s,g,h,E;let e=this.getAttribute("client-id"),t=(s=this.getAttribute("scope"))!=null?s:"https://www.googleapis.com/auth/drive.file";if(!e||!t)throw new Error("client-id and scope are required attributes");return{client_id:e,hd:(g=this.getAttribute("hd"))!=null?g:void 0,include_granted_scopes:!!this.getAttribute("include-granted-scope"),login_hint:(h=this.getAttribute("login-hint"))!=null?h:void 0,prompt:(E=this.getAttribute("prompt"))!=null?E:"",scope:t}}attributeChangedCallback(){this.isConnected&&this.scheduleBuild()}scheduleBuild(){var e;clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>{this.build()},(e=n(this,"debounce-delay"))!=null?e:0)}build(){return v(this,null,function*(){var Q,K;if((Q=this.picker)==null||Q.dispose(),yield this.loading,!this.google)return;let e=new this.google.picker.PickerBuilder().setCallback(F=>{this.callbackToDispatchEvent(F)}),t=this.getAttribute("app-id");t!==null&&(e=e.setAppId(t));let s=this.getAttribute("developer-key");s!==null&&(e=e.setDeveloperKey(s));let g=this.getAttribute("locale");g!==null&&(e=e.setLocale(g));let h=n(this,"max-items");h!==null&&(e=e.setMaxItems(h));let E=this.getAttribute("origin");E!==null&&(e=e.setOrigin(E));let H=this.getAttribute("relay-url");H!==null&&(e=e.setRelayUrl(H));let W=this.getAttribute("title");W!==null&&(e=e.setTitle(W)),w("hide-title-bar",this,e.hideTitleBar,e);let z=(K=this.getAttribute("oauth-token"))!=null?K:yield this.requestAccessToken();if(z){e=e.setOAuthToken(z),b(this,"multiselect")&&(e=e.enableFeature(this.google.picker.Feature.MULTISELECT_ENABLED)),b(this,"mine-only")&&(e=e.enableFeature(this.google.picker.Feature.MINE_ONLY)),b(this,"nav-hidden")&&(e=e.enableFeature(this.google.picker.Feature.NAV_HIDDEN));for(let F of this.views)e=e.addView(F);this.picker=e.build(),this.picker.setVisible(!0)}})}get views(){let e=V(this);return e.length?e:["all"]}connectedCallback(){return v(this,null,function*(){var e;this.loading=d().then(t=>{this.google=t}),this.observer=new MutationObserver(t=>{t.filter(s=>s.type==="childList"||s.type==="attributes"&&s.target!==this).length&&this.scheduleBuild()}),(e=this.observer)==null||e.observe(this,{childList:!0,subtree:!0,attributes:!0}),this.scheduleBuild()})}callbackToDispatchEvent(e){let t;switch(e.action){case google.picker.Action.CANCEL:t=["picker:canceled","picker-canceled"];break;case google.picker.Action.PICKED:t=["picker:picked","picker-picked"];break;case google.picker.Action.ERROR:t=["picker:error","picker-error"];break;default:return}for(let s of t)this.dispatchEvent(new CustomEvent(s,{detail:e}))}requestAccessToken(){return v(this,null,function*(){return i(this.tokenClientConfig).then(e=>{let{access_token:t}=e;if(!t){this.dispatchEvent(new CustomEvent("picker:oauth:error",{detail:e})),this.dispatchEvent(new CustomEvent("picker-oauth-error",{detail:e}));return}return this.dispatchEvent(new CustomEvent("picker:authenticated",{detail:{token:t}})),this.dispatchEvent(new CustomEvent("picker-oauth-response",{detail:e})),this.dispatchEvent(new CustomEvent("picker:oauth:response",{detail:e})),this.dispatchEvent(new CustomEvent("picker-oauth-response",{detail:e})),t}).catch(e=>{this.dispatchEvent(new CustomEvent("picker:oauth:error",{detail:e})),this.dispatchEvent(new CustomEvent("picker-oauth-error",{detail:e}))})})}disconnectedCallback(){var e;(e=this.picker)==null||e.dispose()}};function P(e){return"view"in e&&e.view instanceof window.google.picker.View}function M(e){return e.filter(t=>P(t)).map(t=>t.view)}function V(e,t="*"){return M(Array.from(e.querySelectorAll(t)))}var D=class extends HTMLElement{static get observedAttributes(){return["enable-drives","file-ids","include-folders","mime-types","mode","owned-by-me","parent","query","select-folder-enabled","starred","view-id"]}get view(){let e=new window.google.picker.DocsView(this.viewId);w("enable-drives",this,e.setEnableDrives,e),w("include-folders",this,e.setIncludeFolders,e),w("owned-by-me",this,e.setOwnedByMe,e),w("select-folder-enabled",this,e.setSelectFolderEnabled,e),w("starred",this,e.setStarred,e);let t=this.getAttribute("mime-types");t!==null&&e.setMimeTypes(t);let s=this.getAttribute("file-ids");s!==null&&e.setFileIds(s);let g=this.getAttribute("mode");g&&e.setMode(google.picker.DocsViewMode[g]);let h=this.getAttribute("parent");h!==null&&e.setParent(h);let E=this.getAttribute("query");return E!==null&&e.setQuery(E),e}get viewId(){let e=this.getAttribute("view-id");return e?window.google.picker.ViewId[e]:void 0}};customElements.define("drive-picker",A),customElements.define("drive-picker-docs-view",D)})();var Fe=["drivePickerElement"];function Oe(c,m){c&1&&(B(0),_(1,"ion-spinner",17),N())}function je(c,m){if(c&1){let d=T();o(0,"ion-button",18),I("click",function(){S(d);let r=C();return k(r.saveSettings())}),_(1,"ion-icon",19),a()}if(c&2){let d=C();y("disabled",!d.hasChanges)}}function qe(c,m){if(c&1){let d=T();B(0),o(1,"ion-button",20),I("click",function(){S(d);let r=C();return k(r.pickerVisible=!0)}),_(2,"ion-icon",21),u(3," Select Spreadsheet "),a(),N()}}function Re(c,m){if(c&1){let d=T();B(0),o(1,"div",22),_(2,"ion-icon",23),o(3,"span",24),u(4),a(),o(5,"ion-button",25),I("click",function(){S(d);let r=C();return k(r.pickerVisible=!0)}),_(6,"ion-icon",26),a()(),N()}if(c&2){let d=C();f(4),U(d.selectedSpreadsheet.name)}}function Ge(c,m){if(c&1){let d=T();o(0,"drive-picker",27),I("picker-picked",function(r){S(d);let n=C();return k(n.onDrivePicked(r))}),_(1,"drive-picker-docs-view",28),a()}if(c&2){let d=C();Z("client-id",d.clientId)("app-id",d.appId)("oauth-token",d.oauthToken)}}function He(c,m){if(c&1&&(o(0,"ion-avatar",2),_(1,"img",29),a()),c&2){let d=C();f(),y("src",d.userPicture,J)}}var ut=(()=>{let m=class m{constructor(i,r,n,l,b,p){this.clubContext=i,this.toastCtrl=r,this.router=n,this.authService=l,this.apiService=b,this.googleSheetService=p,this.sportsClubId="",this.selectedSpreadsheet=null,this.hasChanges=!1,this.loading=!1,this.darkMode=!1,this.language="en",this.userEmail="",this.userName="",this.userPicture="",this.pickerVisible=!1,this.clientId=R.googleSignInClientId,this.appId=R.googleProjectNumber,this.oauthToken="test",this.darkMode=document.body.classList.contains("dark-theme"),this.language=localStorage.getItem("language")||"en"}ngOnInit(){let i=this.clubContext.getSportsClubId();this.sportsClubId=i||"",this.selectedSpreadsheet=this.clubContext.getSpreadSheet(),this.loadUserInfo(),Me({saveOutline:Le,logoGoogle:De,createOutline:Ve})}ngAfterViewInit(){return v(this,null,function*(){var i=yield this.authService.getSession();this.oauthToken=(i==null?void 0:i.accessToken)||"";let r=this.clubContext.getSpreadSheet();if(r){this.pickerVisible=!1,console.log("Current Spreadsheet:",r);return}})}loadUserInfo(){this.authService.userSession$.subscribe(i=>{i&&(this.userEmail=i.email,this.userName=i.name,this.userPicture=i.picture||"")})}settingsChanged(){this.hasChanges=!0}clearDatabase(){return v(this,null,function*(){yield G.deleteDatabase().catch(i=>{console.error("Error deleting PlayMateDB during settings save:",i)})})}saveSettings(){return v(this,null,function*(){this.loading=!0;let i=this.sportsClubId.trim(),r=this.clubContext.getSportsClubId()||"";if(this.clubContext.setSpreadSheet(this.selectedSpreadsheet),i)if(i!==r)try{let n=yield this.apiService.get("getSportsClubById",i);console.log("Club ID validation response:",n),n.status==="success"&&n.data&&n.data.active?(this.clubContext.setSportsClubId(i),yield this.clearDatabase(),yield(yield this.toastCtrl.create({message:"Settings saved successfully!",duration:1500,color:"success"})).present(),this.hasChanges=!1):yield(yield this.toastCtrl.create({message:"Invalid or inactive Sports Club ID.",duration:1500,color:"danger"})).present()}catch(n){console.error("Error validating club ID:",n),yield(yield this.toastCtrl.create({message:"Failed to validate Sports Club ID. Please try again.",duration:1500,color:"danger"})).present()}finally{this.loading=!1}else this.clubContext.setSportsClubId(i),yield(yield this.toastCtrl.create({message:"Settings saved successfully!",duration:1500,color:"success"})).present(),this.hasChanges=!1,this.loading=!1;else(yield this.toastCtrl.create({message:"Please enter a valid Sports Club ID.",duration:1500,color:"danger"})).present(),this.loading=!1})}toggleDarkMode(){document.body.classList.toggle("dark-theme",this.darkMode),this.clubContext.setDarkMode(this.darkMode)}changeLanguage(){this.clubContext.setLanguage(this.language),this.hasChanges=!0}logout(){return v(this,null,function*(){if(window.confirm("Are you sure you want to logout? This will delete all your local GymMate data."))try{yield this.authService.logout();try{yield G.deleteDatabase(),console.log("PlayMateDB deleted successfully")}catch(r){console.error("Error deleting PlayMateDB:",r)}this.clubContext.clear(),yield this.router.navigate(["/login"],{replaceUrl:!0})}catch(r){console.error("Logout error:",r),yield(yield this.toastCtrl.create({message:"Error during logout. Please try again.",duration:2e3,color:"danger"})).present()}})}openPicker(){this.drivePickerElement&&this.drivePickerElement.nativeElement?this.drivePickerElement.nativeElement.visible=!0:console.error("Drive Picker element not found")}toSpreadsheet(i){var r,n,l,b,p,w,A,P,M,V,D,e,t;return{description:(r=i.description)!=null?r:"",driveSuccess:(n=i.driveSuccess)!=null?n:!0,embedUrl:(l=i.embedUrl)!=null?l:"",iconUrl:(b=i.iconUrl)!=null?b:"",id:(p=i.id)!=null?p:"",isShared:(w=i.isShared)!=null?w:!1,lastEditedUtc:(A=i.lastEditedUtc)!=null?A:0,mimeType:(P=i.mimeType)!=null?P:"",name:(M=i.name)!=null?M:"",serviceId:(V=i.serviceId)!=null?V:"",sizeBytes:(D=i.sizeBytes)!=null?D:0,type:(e=i.type)!=null?e:"",url:(t=i.url)!=null?t:""}}onDrivePicked(i){let r=i.detail.docs[0];this.selectedSpreadsheet=this.toSpreadsheet(r),this.hasChanges=!0,this.googleSheetService.FetchClubSettings(this.selectedSpreadsheet.id).then(n=>{console.log("Club settings fetched from selected spreadsheet:",n),this.sportsClubId=n.clubId||""}).catch(n=>{console.error("Error fetching club settings from spreadsheet:",n)})}};m.\u0275fac=function(r){return new(r||m)(x(Be),x(Ie),x(ae),x(Pe),x(Ne),x(Ue))},m.\u0275cmp=X({type:m,selectors:[["app-settings"]],viewQuery:function(r,n){if(r&1&&ee(Fe,5),r&2){let l;te(l=ie())&&(n.drivePickerElement=l.first)}},decls:63,vars:10,consts:[["saveBtn",""],["color","primary"],["slot","start"],["slot","end"],[4,"ngIf","ngIfElse"],[1,"ion-padding"],[2,"padding-bottom","12px"],["position","stacked",2,"margin-bottom","12px"],[4,"ngIf"],["max-items","1","title","Select a Google Spreadsheet to link","debounce-delay","100",3,"picker-picked",4,"ngIf"],[3,"ngModelChange","ionChange","ngModel"],["value","en"],["value","ta"],["lines","none"],["slot","start",4,"ngIf"],["slot","end","fill","clear","color","danger",3,"click"],["slot","start","name","log-out-outline"],["name","circular"],[3,"click","disabled"],["slot","start","name","save-outline"],["expand","block",2,"margin-bottom","12px",3,"click"],["name","document-outline","slot","start"],[2,"display","flex","align-items","center"],["name","logo-google",2,"font-size","1.5em","margin-right","8px"],[2,"font-weight","500"],["fill","clear","color","medium","size","small",2,"margin-left","8px",3,"click"],["name","create-outline","slot","icon-only"],["max-items","1","title","Select a Google Spreadsheet to link","debounce-delay","100",3,"picker-picked"],["view-id","SPREADSHEETS","query","GymMate"],["alt","Profile Picture",3,"src"]],template:function(r,n){if(r&1){let l=T();o(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),_(3,"ion-menu-button"),a(),o(4,"ion-title"),u(5,"Settings"),a(),o(6,"ion-buttons",3),L(7,Oe,2,0,"ng-container",4)(8,je,2,1,"ng-template",null,0,re),a()()(),o(10,"ion-content",5)(11,"ion-list")(12,"ion-item-group")(13,"ion-item-divider")(14,"ion-label"),u(15,"Club Settings"),a()(),o(16,"ion-item",6)(17,"ion-label",7),u(18,"Linked Spreadsheet"),a(),L(19,qe,4,0,"ng-container",8)(20,Re,7,1,"ng-container",8)(21,Ge,2,3,"drive-picker",9),a()(),o(22,"ion-item-group")(23,"ion-item-divider")(24,"ion-label"),u(25,"App Settings"),a()(),o(26,"ion-item")(27,"ion-label"),u(28,"Dark Mode"),a(),o(29,"ion-toggle",10),q("ngModelChange",function(p){return S(l),j(n.darkMode,p)||(n.darkMode=p),k(p)}),I("ionChange",function(){return S(l),k(n.toggleDarkMode())}),a()(),o(30,"ion-item")(31,"ion-label"),u(32,"Language"),a(),o(33,"ion-select",10),q("ngModelChange",function(p){return S(l),j(n.language,p)||(n.language=p),k(p)}),I("ionChange",function(){return S(l),k(n.changeLanguage())}),o(34,"ion-select-option",11),u(35,"English"),a(),o(36,"ion-select-option",12),u(37,"Tamil"),a()()()(),o(38,"ion-item-group")(39,"ion-item-divider")(40,"ion-label"),u(41,"Account"),a()(),o(42,"ion-item",13),L(43,He,2,1,"ion-avatar",14),o(44,"ion-label")(45,"h2"),u(46),a(),o(47,"p"),u(48),a(),o(49,"p"),u(50,"Google Account"),a()(),o(51,"ion-button",15),I("click",function(){return S(l),k(n.logout())}),_(52,"ion-icon",16),u(53," Logout "),a()()(),o(54,"ion-item-group")(55,"ion-item-divider")(56,"ion-label"),u(57,"About"),a()(),o(58,"ion-item")(59,"ion-label"),u(60,"Version"),a(),o(61,"ion-note",3),u(62,"1.0.0"),a()()()()()}if(r&2){let l=ne(9);f(7),y("ngIf",n.loading)("ngIfElse",l),f(12),y("ngIf",!n.selectedSpreadsheet),f(),y("ngIf",n.selectedSpreadsheet),f(),y("ngIf",n.pickerVisible),f(8),O("ngModel",n.darkMode),f(4),O("ngModel",n.language),f(10),y("ngIf",n.userPicture),f(3),U(n.userName),f(2),U(n.userEmail)}},dependencies:[se,oe,de,le,ce,pe,ye,he,_e,Ee,ge,xe,me,ke,fe,ve,be,Se,we,Ae,Te,Ce,ue],encapsulation:2});let c=m;return c})();export{ut as SettingsPage};
