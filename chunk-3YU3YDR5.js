import{a as et}from"./chunk-OPVL7O2E.js";import{a as tt}from"./chunk-SHAQBHSZ.js";import"./chunk-D7CWB7YP.js";import{a as Y,c as q}from"./chunk-MBYQTTWT.js";import{f as Z}from"./chunk-SLZ5API5.js";import"./chunk-T47TWMLD.js";import{G as _,U as X,a as S,i as J,o as Q}from"./chunk-KQP4CTSV.js";import{$a as B,Aa as E,Ba as d,Ca as g,Da as C,Ka as O,Kb as $,Lb as z,Ma as T,Mb as L,Nb as A,Oa as k,Ob as j,Pa as D,Q as a,Qb as R,R as x,Sb as F,T as I,Vb as N,Y as v,_ as l,aa as n,ba as o,ca as h,cc as G,gc as H,ia as w,ja as P,lc as U,mc as V,sa as c,ua as y,uc as K,wc as W}from"./chunk-SZXUWVBX.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{i as M}from"./chunk-OYAVQN5W.js";var nt=()=>["list"];function it(r,m){if(r&1&&(n(0,"div",9)(1,"div",10)(2,"ion-text",11),c(3),d(4,"relativeTime"),o()()()),r&2){let p=P();a(3),y(" Last synced: ",g(4,1,p.lastPaymentSync)," ")}}function ot(r,m){if(r&1&&(n(0,"div",12)(1,"div",13)(2,"div",14),h(3,"ion-icon",15),o(),n(4,"div",16),c(5,"Total Earnings"),o(),n(6,"div",17),c(7),d(8,"async"),d(9,"number"),o(),n(10,"div",18),c(11),d(12,"async"),o(),n(13,"div",19),h(14,"ion-icon",20),n(15,"small"),c(16,"View All"),o()()(),n(17,"div",21)(18,"div",22),h(19,"ion-icon",23),o(),n(20,"div",16),c(21,"This Month"),o(),n(22,"div",17),c(23),d(24,"number"),o(),n(25,"div",18),c(26),o()()()),r&2){let p,t,i=P();a(),l("routerLink",E(15,nt)),a(6),y("\u20B9",C(9,7,((p=g(8,5,i.summary$))==null?null:p.totalAmount)||0,"1.0-0"),""),a(4),y("",((t=g(12,10,i.summary$))==null?null:t.totalPayments)||0," total payments"),a(12),y("\u20B9",C(24,12,i.currentMonthEarnings,"1.0-0"),""),a(3),y("",i.currentMonthPayments," payments this month")}}function at(r,m){if(r&1&&(n(0,"ion-card",24)(1,"ion-card-header")(2,"ion-card-title"),c(3,"Monthly Earnings"),o()(),n(4,"ion-card-content")(5,"div",25),h(6,"google-chart",26),o()()()),r&2){let p=P();a(6),l("type",p.chartType)("data",p.chartData)("columns",p.chartColumns)("options",p.chartOptions)("height",300)}}function rt(r,m){r&1&&(n(0,"div",27)(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),h(4,"ion-skeleton-text",28),o()(),n(5,"ion-card-content"),h(6,"ion-skeleton-text",29)(7,"ion-skeleton-text",30),o()()()),r&2&&(a(4),l("animated",!0),a(2),l("animated",!0),a(),l("animated",!0))}S({refresh:_,wallet:X,calendar:J,chevronForwardOutline:Q});var xt=(()=>{let m=class m{constructor(t,i,e){this.paymentService=t,this.toastController=i,this.clubContext=e,this.loading$=this.paymentService.loading$,this.summary$=this.paymentService.summary$,this.displayedGroups=[],this.chartType=Y.LineChart,this.chartColumns=["Month","Amount",{type:"string",role:"tooltip"}],this.chartData=[],this.chartOptions={backgroundColor:"transparent",colors:["#2dd36f"],chartArea:{left:60,top:20,width:"85%",height:"75%"},hAxis:{textStyle:{fontSize:12,color:"#666"},gridlines:{color:"transparent"}},vAxis:{textStyle:{fontSize:12,color:"#666"},gridlines:{color:"#e0e0e0",count:5},minValue:0},legend:{position:"none"},animation:{startup:!0,duration:1e3,easing:"out"},pointSize:5,lineWidth:2},this.currentMonthEarnings=0,this.currentMonthPayments=0,this.lastPaymentSync=null,this.refreshing=!1,S({refresh:_}),this.lastPaymentSync=this.clubContext.getLastPaymentRefresh()}prepareChartData(t){if(!t){this.chartData=[];return}let i=Object.entries(t.monthBreakdown).map(([e,s])=>({month:e,amount:s.amount,count:s.count})).sort((e,s)=>e.month.localeCompare(s.month));this.chartData=i.map(e=>{let u=new Date(e.month+"-01").toLocaleString("default",{month:"short",year:"2-digit"});return[u,e.amount,`${u}
Amount: \u20B9${e.amount}
Payments: ${e.count}`]})}ngOnInit(){this.paymentService.payments$.subscribe(t=>{t&&this.processPayments(t)}),this.summary$.subscribe(t=>{this.prepareChartData(t)}),this.paymentService.loadData().catch(t=>{console.error("Error initializing payments:",t)})}processPayments(t){let i=new Map,e=new Date().toISOString().substring(0,7);this.currentMonthEarnings=0,this.currentMonthPayments=0,t.forEach(s=>{let u=new Date(s.date),f=u.toISOString().substring(0,7);f===e&&(this.currentMonthEarnings+=s.amount,this.currentMonthPayments++),i.has(f)||i.set(f,{month:f,formattedDate:u.toLocaleDateString("en-US",{month:"long",year:"numeric"}),payments:[],total:0});let b=i.get(f);b.payments.push(s),b.total+=s.amount}),this.displayedGroups=Array.from(i.values()).sort((s,u)=>u.month.localeCompare(s.month))}refreshPayments(){return M(this,null,function*(){if(!this.refreshing)try{this.refreshing=!0,console.log("Refreshing payment data..."),yield this.paymentService.refreshData(),this.lastPaymentSync=this.clubContext.getLastPaymentRefresh(),console.log("Payment data refreshed successfully"),yield(yield this.toastController.create({message:"Payment data refreshed successfully",duration:2e3,color:"success"})).present()}catch(t){console.error("Error refreshing payment data:",t),yield(yield this.toastController.create({message:"Failed to refresh payment data",duration:2e3,color:"danger"})).present()}finally{this.refreshing=!1}})}showPaymentDetails(t){console.log("Show payment details:",t)}goToPaymentsList(){console.log("Navigating to payments list...")}};m.\u0275fac=function(i){return new(i||m)(x(et),x(K),x(Z))},m.\u0275cmp=I({type:m,selectors:[["app-payments"]],decls:18,vars:13,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"click","disabled"],["slot","icon-only","name","refresh"],["class","results-row",4,"ngIf"],["class","stats-grid",4,"ngIf"],["class","chart-card",4,"ngIf"],["class","ion-padding",4,"ngIf"],[1,"results-row"],[1,"last-sync-info"],["color","medium",1,"last-sync-label"],[1,"stats-grid"],[1,"stat-card",3,"routerLink"],[1,"stat-icon","total-earnings"],["name","wallet"],[1,"stat-label"],[1,"stat-value"],[1,"stat-subtext"],[1,"view-details"],["name","chevron-forward-outline","size","small"],[1,"stat-card"],[1,"stat-icon","monthly-earnings"],["name","calendar"],[1,"chart-card"],[2,"display","flex","justify-content","center","align-items","center"],[3,"type","data","columns","options","height"],[1,"ion-padding"],[2,"width","60%",3,"animated"],[2,"width","100%",3,"animated"],[2,"width","80%",3,"animated"]],template:function(i,e){i&1&&(n(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),h(3,"ion-menu-button"),o(),n(4,"ion-title"),c(5,"Payments"),o(),n(6,"ion-buttons",2)(7,"ion-button",3),w("click",function(){return e.refreshPayments()}),h(8,"ion-icon",4),o()()()(),n(9,"ion-content"),v(10,it,5,3,"div",5),d(11,"async"),v(12,ot,27,16,"div",6),d(13,"async"),v(14,at,7,5,"ion-card",7),d(15,"async"),v(16,rt,8,3,"div",8),d(17,"async"),o()),i&2&&(a(7),l("disabled",e.refreshing),a(3),l("ngIf",!g(11,5,e.loading$)),a(2),l("ngIf",!g(13,7,e.loading$)),a(2),l("ngIf",!g(15,9,e.loading$)&&e.chartData.length>0),a(2),l("ngIf",g(17,11,e.loading$)))},dependencies:[D,O,T,k,B,N,V,U,F,L,j,A,R,z,G,H,$,W,q,tt],styles:[".stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px}.stat-card[_ngcontent-%COMP%]{background-color:var(--ion-card-background);border-radius:12px;padding:16px;display:flex;flex-direction:column;align-items:flex-start;position:relative;box-shadow:var(--ion-card-box-shadow);transition:transform .2s ease}.stat-card[routerLink][_ngcontent-%COMP%]{cursor:pointer}.stat-card[routerLink][_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.stat-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-bottom:12px}.stat-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#fff}.stat-icon.total-earnings[_ngcontent-%COMP%]{background-color:var(--ion-color-primary)}.stat-icon.monthly-earnings[_ngcontent-%COMP%]{background-color:var(--ion-color-success)}.stat-label[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.9rem;font-weight:500;margin-bottom:4px}.stat-value[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:var(--ion-color-dark);margin-bottom:4px}.stat-subtext[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.85rem}.view-details[_ngcontent-%COMP%]{position:absolute;bottom:12px;right:12px;display:flex;align-items:center;gap:4px;color:var(--ion-color-primary);font-size:.8rem}.view-details[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1rem}.chart-card[_ngcontent-%COMP%]{margin:12px}.amount-note[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem}.status-badge[_ngcontent-%COMP%]{margin-left:8px;text-transform:capitalize}.last-sync-info[_ngcontent-%COMP%]{padding-right:16px;padding-top:8px;font-size:.9em;opacity:.7;vertical-align:middle;text-align:right}"]});let r=m;return r})();export{xt as PaymentsPage};
