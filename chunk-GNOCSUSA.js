import{Ab as R,Cb as q,Da as M,Fb as F,I as p,L as P,Ob as V,P as y,R as u,S as T,Sb as z,U as m,V as s,Vb as G,W as I,Wb as H,Xb as $,aa as b,ab as B,ja as g,ka as N,la as S,wb as E,xb as L,ya as _,yb as A,za as k,zb as j}from"./chunk-R775EV27.js";import"./chunk-GRX4ZZSO.js";import"./chunk-7KGURMOZ.js";import"./chunk-Y2YV2HED.js";import"./chunk-EDCKRRWH.js";import"./chunk-SPCCATGZ.js";import"./chunk-YKMIF4NY.js";import"./chunk-YVBCZ55L.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-D5MTWDX2.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as C,b as D,i as x}from"./chunk-OYAVQN5W.js";var U=(()=>{let e=class e{static openDB(){return new Promise((t,a)=>{let n=indexedDB.open(e.dbName,e.version);n.onupgradeneeded=c=>{let d=c.target.result;if(!d.objectStoreNames.contains(e.storeName)){let r=d.createObjectStore(e.storeName,{keyPath:"id"});r.createIndex("memberId","memberId",{unique:!1}),r.createIndex("date","date",{unique:!1}),r.createIndex("membershipStatus","membershipStatus",{unique:!1}),r.createIndex("dateRange",["date","memberId"],{unique:!1})}d.objectStoreNames.contains(e.settingsStoreName)||d.createObjectStore(e.settingsStoreName,{keyPath:"key"})},n.onsuccess=()=>t(n.result),n.onerror=()=>a(n.error)})}static getAll(){return x(this,null,function*(){let t=yield e.openDB();return new Promise((a,n)=>{let r=t.transaction(e.storeName,"readonly").objectStore(e.storeName).getAll();r.onsuccess=()=>{let i=r.result.map(f=>D(C({},f),{date:new Date(f.date),checkInTime:new Date(f.checkInTime),checkOutTime:f.checkOutTime?new Date(f.checkOutTime):void 0}));a(i)},r.onerror=()=>n(r.error)})})}static setAll(t){return x(this,null,function*(){let a=yield e.openDB();return new Promise((n,c)=>{var l;let d=a.transaction(e.storeName,"readwrite"),r=d.objectStore(e.storeName);r.clear();for(let i of t){let f=D(C({},i),{id:(l=i.id)!=null?l:i.ID,date:new Date(i.date),checkInTime:new Date(i.checkInTime),checkOutTime:i.checkOutTime?new Date(i.checkOutTime):void 0});r.put(f)}d.oncomplete=()=>n(),d.onerror=()=>c(d.error)})})}static addRecords(t){return x(this,null,function*(){let a=yield e.openDB();return new Promise((n,c)=>{var l;let d=a.transaction(e.storeName,"readwrite"),r=d.objectStore(e.storeName);for(let i of t){let f=D(C({},i),{id:(l=i.id)!=null?l:i.ID,date:new Date(i.date),checkInTime:new Date(i.checkInTime),checkOutTime:i.checkOutTime?new Date(i.checkOutTime):void 0});r.put(f)}d.oncomplete=()=>n(),d.onerror=()=>c(d.error)})})}static getByDateRange(t,a){return x(this,null,function*(){let n=yield e.openDB();return new Promise((c,d)=>{let i=n.transaction(e.storeName,"readonly").objectStore(e.storeName).index("date"),f=IDBKeyRange.bound(t,a),w=i.getAll(f);w.onsuccess=()=>{let J=w.result.map(O=>D(C({},O),{date:new Date(O.date),checkInTime:new Date(O.checkInTime),checkOutTime:O.checkOutTime?new Date(O.checkOutTime):void 0}));c(J)},w.onerror=()=>d(w.error)})})}static getByMemberId(t){return x(this,null,function*(){let a=yield e.openDB();return new Promise((n,c)=>{let i=a.transaction(e.storeName,"readonly").objectStore(e.storeName).index("memberId").getAll(t);i.onsuccess=()=>{let w=i.result.map(v=>D(C({},v),{date:new Date(v.date),checkInTime:new Date(v.checkInTime),checkOutTime:v.checkOutTime?new Date(v.checkOutTime):void 0}));n(w)},i.onerror=()=>c(i.error)})})}static getLastAttendanceId(){return x(this,null,function*(){let t=yield e.openDB();return new Promise((a,n)=>{let r=t.transaction(e.settingsStoreName,"readonly").objectStore(e.settingsStoreName).get("lastAttendanceId");r.onsuccess=()=>{var l;a(((l=r.result)==null?void 0:l.value)||null)},r.onerror=()=>n(r.error)})})}static setLastAttendanceId(t){return x(this,null,function*(){let a=yield e.openDB();return new Promise((n,c)=>{let l=a.transaction(e.settingsStoreName,"readwrite").objectStore(e.settingsStoreName).put({key:"lastAttendanceId",value:t});l.onsuccess=()=>n(),l.onerror=()=>c(l.error)})})}static getLastSyncTime(){return x(this,null,function*(){let t=yield e.openDB();return new Promise((a,n)=>{let r=t.transaction(e.settingsStoreName,"readonly").objectStore(e.settingsStoreName).get("lastSyncTime");r.onsuccess=()=>{var i;let l=(i=r.result)==null?void 0:i.value;a(l?new Date(l):null)},r.onerror=()=>n(r.error)})})}static setLastSyncTime(t){return x(this,null,function*(){let a=yield e.openDB();return new Promise((n,c)=>{let l=a.transaction(e.settingsStoreName,"readwrite").objectStore(e.settingsStoreName).put({key:"lastSyncTime",value:t.toISOString()});l.onsuccess=()=>n(),l.onerror=()=>c(l.error)})})}};e.dbName="PlayMateDB",e.storeName="attendance",e.settingsStoreName="attendanceSettings",e.version=2;let o=e;return o})();function X(o,e){if(o&1&&(m(0,"div",6),g(1),s()),o&2){let h=b();p(),N(h.title)}}function Y(o,e){if(o&1&&(m(0,"div",12),g(1),s()),o&2){let h=b().$implicit;p(),S(" ",h.value," ")}}function Z(o,e){if(o&1&&(m(0,"div",13),g(1),s()),o&2){let h=b().$implicit,t=b();p(),S(" ",t.formatLabel(h.label)," ")}}function ee(o,e){if(o&1&&(m(0,"div",7),y(1,Y,2,1,"div",8),m(2,"div",9),I(3,"div",10),s(),y(4,Z,2,1,"div",11),s()),o&2){let h=e.$implicit,t=b();p(),u("ngIf",t.showValues),p(),T("height",t.height-80,"px"),p(),T("height",t.getBarHeight(h.value),"%")("background",t.getBarColor(h)),u("title",t.formatLabel(h.label)+": "+h.value),p(),u("ngIf",t.showLabels)}}function te(o,e){o&1&&(m(0,"div",14)(1,"p"),g(2,"No data to display"),s()())}var K=(()=>{let e=class e{constructor(){this.data=[],this.groupedData=[],this.title="",this.height=250,this.showValues=!0,this.showLabels=!0,this.color="var(--ion-color-success)",this.isGrouped=!1}getMaxValue(){if(this.isGrouped){let t=this.groupedData.map(a=>Math.max(...a.series.map(n=>n.value)));return Math.max(...t,1)}return Math.max(...this.data.map(t=>t.value),1)}getBarHeight(t){let a=this.getMaxValue();return t/a*100}getBarColor(t){return t.color||this.color}getSeriesColor(t){return t.color||this.color}formatLabel(t){return t.match(/^\d{4}-\d{2}-\d{2}$/)?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"}):t}trackByLabel(t,a){return a.label}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=P({type:e,selectors:[["app-bar-chart"]],inputs:{data:"data",groupedData:"groupedData",title:"title",height:"height",showValues:"showValues",showLabels:"showLabels",color:"color",isGrouped:"isGrouped"},decls:6,vars:6,consts:[[1,"bar-chart"],["class","chart-title",4,"ngIf"],[1,"chart-container"],[1,"chart-bars"],["class","bar-container",4,"ngFor","ngForOf","ngForTrackBy"],["class","no-data",4,"ngIf"],[1,"chart-title"],[1,"bar-container"],["class","bar-value",4,"ngIf"],[1,"bar-wrapper"],[1,"bar",3,"title"],["class","bar-label",4,"ngIf"],[1,"bar-value"],[1,"bar-label"],[1,"no-data"]],template:function(a,n){a&1&&(m(0,"div",0),y(1,X,2,1,"div",1),m(2,"div",2)(3,"div",3),y(4,ee,5,9,"div",4),s()(),y(5,te,3,0,"div",5),s()),a&2&&(T("height",n.height,"px"),p(),u("ngIf",n.title),p(3),u("ngForOf",n.data)("ngForTrackBy",n.trackByLabel),p(),u("ngIf",n.data.length===0))},dependencies:[M,_,k],styles:[".bar-chart[_ngcontent-%COMP%]{width:100%;padding:1rem 0}.chart-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;text-align:center;margin-bottom:1rem;color:var(--ion-color-dark)}.chart-container[_ngcontent-%COMP%]{overflow-x:auto;padding:0 .5rem 1rem}.chart-bars[_ngcontent-%COMP%]{display:flex;gap:12px;min-width:100%;align-items:flex-end;padding:1rem 0}.bar-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;min-width:40px;flex-shrink:0;height:100%;justify-content:flex-end}.bar-value[_ngcontent-%COMP%]{font-size:.75rem;color:var(--ion-color-medium);text-align:center;font-weight:500;margin-bottom:3px;white-space:nowrap}.bar-wrapper[_ngcontent-%COMP%]{display:flex;align-items:flex-end;width:24px;position:relative}.bar[_ngcontent-%COMP%]{width:100%;background:linear-gradient(135deg,#4caf50,#45a049);border-radius:4px 4px 0 0;min-height:4px;transition:all .3s ease;cursor:pointer;box-shadow:0 2px 4px #4caf504d}.bar[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 8px #4caf5066;background:linear-gradient(135deg,#5cbf60,#4caf50)}.bar-label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--ion-color-medium);text-align:center;margin-top:5px;line-height:1.1;max-width:50px;word-wrap:break-word;-webkit-hyphens:auto;hyphens:auto}.no-data[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--ion-color-medium)}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-style:italic}.bar.primary-scheme[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3880ff,#3171e0);box-shadow:0 2px 4px #3880ff4d}.bar.primary-scheme[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#4c8dff,#3880ff);box-shadow:0 4px 8px #3880ff66}.bar.secondary-scheme[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3dc2ff,#36abe0);box-shadow:0 2px 4px #3dc2ff4d}.bar.secondary-scheme[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#4fc3f7,#3dc2ff);box-shadow:0 4px 8px #3dc2ff66}.bar.tertiary-scheme[_ngcontent-%COMP%]{background:linear-gradient(135deg,#5260ff,#4854e0);box-shadow:0 2px 4px #5260ff4d}.bar.tertiary-scheme[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#6370ff,#5260ff);box-shadow:0 4px 8px #5260ff66}@media (max-width: 768px){.chart-bars[_ngcontent-%COMP%]{gap:8px}.bar-container[_ngcontent-%COMP%]{min-width:35px}.bar-wrapper[_ngcontent-%COMP%]{width:20px}.bar-label[_ngcontent-%COMP%]{font-size:.7rem;max-width:40px}.bar-value[_ngcontent-%COMP%]{font-size:.8rem}}"]});let o=e;return o})();function ne(o,e){o&1&&(m(0,"div",6),I(1,"ion-spinner",7),m(2,"ion-text",8),g(3,"Loading attendance data..."),s()())}function ae(o,e){if(o&1&&(m(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),g(3,"Attendance Summary"),s()(),m(4,"ion-card-content")(5,"p")(6,"strong"),g(7,"Total Records:"),s(),g(8),s(),m(9,"p")(10,"strong"),g(11,"Days with Data:"),s(),g(12),s()()()),o&2){let h=b();p(8),S(" ",h.totalRecords,""),p(4),S(" ",h.dailyData.length,"")}}function oe(o,e){if(o&1&&(m(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),g(3,"Daily Attendance (Last 30 Days)"),s()(),m(4,"ion-card-content"),I(5,"app-bar-chart",9),s()()),o&2){let h=b();p(5),u("data",h.chartData)("height",250)("showValues",!0)("showLabels",!0)}}function re(o,e){o&1&&(m(0,"ion-card")(1,"ion-card-content",10)(2,"ion-text",8)(3,"h3"),g(4,"No attendance data found"),s(),m(5,"p"),g(6,"There are no attendance records to display."),s()()()())}var ue=(()=>{let e=class e{constructor(){this.loading=!0,this.dailyData=[],this.chartData=[],this.totalRecords=0}ngOnInit(){this.loadAttendanceData()}loadAttendanceData(){return x(this,null,function*(){try{this.loading=!0,console.log("Loading attendance data from IndexedDB...");let t=yield U.getAll();console.log("Loaded records:",t.length),this.totalRecords=t.length,this.dailyData=this.calculateDailyAttendance(t),this.chartData=this.prepareChartData(this.dailyData),this.chartData.length===0&&(console.log("No real data found, adding test data..."),this.chartData=[{label:"2024-08-20",value:15},{label:"2024-08-21",value:23},{label:"2024-08-22",value:18},{label:"2024-08-23",value:31},{label:"2024-08-24",value:27}],this.totalRecords=5),console.log("Daily data:",this.dailyData),console.log("Chart data:",this.chartData)}catch(t){console.error("Error loading attendance data:",t)}finally{this.loading=!1}})}calculateDailyAttendance(t){let a=new Map;return t.forEach(n=>{let c=new Date(n.date).toISOString().split("T")[0];a.set(c,(a.get(c)||0)+1)}),Array.from(a.entries()).map(([n,c])=>({date:n,count:c})).sort((n,c)=>n.date.localeCompare(c.date)).slice(-30)}prepareChartData(t){let a=t.map(n=>({label:n.date,value:n.count}));return console.log("Chart data prepared:",a),a}formatDate(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"})}};e.\u0275fac=function(a){return new(a||e)},e.\u0275cmp=P({type:e,selectors:[["app-attendance"]],decls:11,vars:6,consts:[[3,"translucent"],["color","primary"],["slot","start"],[3,"fullscreen"],["class","loading-container",4,"ngIf"],[4,"ngIf"],[1,"loading-container"],["name","crescent"],["color","medium"],[3,"data","height","showValues","showLabels"],[1,"no-data"]],template:function(a,n){a&1&&(m(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),I(3,"ion-menu-button"),s(),m(4,"ion-title"),g(5,"Daily Attendance"),s()()(),m(6,"ion-content",3),y(7,ne,4,0,"div",4)(8,ae,13,2,"ion-card",5)(9,oe,6,4,"ion-card",5)(10,re,7,0,"ion-card",5),s()),a&2&&(u("translucent",!0),p(6),u("fullscreen",!0),p(),u("ngIf",n.loading),p(),u("ngIf",!n.loading),p(),u("ngIf",!n.loading&&n.chartData.length>0),p(),u("ngIf",!n.loading&&n.chartData.length===0))},dependencies:[M,k,B,F,$,H,q,L,j,R,A,z,G,E,V,K],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;gap:1rem}.no-data[_ngcontent-%COMP%]{text-align:center;padding:2rem}.no-data[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-bottom:.5rem}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium-tint)}"]});let o=e;return o})();export{ue as AttendancePage};
