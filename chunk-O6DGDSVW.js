import{a as f}from"./chunk-AXP7R7SC.js";import{f as g}from"./chunk-J5NWP6QB.js";import{a as d}from"./chunk-35HGTZOU.js";import{B as x,c as y,y as S}from"./chunk-TS5MQKIE.js";import{i as o}from"./chunk-OYAVQN5W.js";var r=class r{static openDB(){return new Promise((t,a)=>{let e=indexedDB.open(r.dbName,d.version);e.onupgradeneeded=s=>{let c=s.target.result;d.onUpgrade(c)},e.onsuccess=()=>{t(e.result)},e.onerror=()=>{a(e.error)}})}static setAll(t){return o(this,null,function*(){let a=yield r.openDB();return new Promise((e,s)=>{let n=a.transaction(r.storeName,"readwrite").objectStore(r.storeName),i=n.clear();i.onerror=()=>s(i.error),i.onsuccess=()=>{let m=0,h=t.length;t.forEach(u=>{let b=n.add(u);b.onerror=()=>s(b.error),b.onsuccess=()=>{m++,m===h&&e()}})}})})}static addRecords(t){return o(this,null,function*(){let a=yield r.openDB();return new Promise((e,s)=>{let c=a.transaction(r.storeName,"readwrite"),n=c.objectStore(r.storeName),i=0,m=t.length;t.forEach(h=>{let u=n.put(h);u.onerror=()=>s(u.error),u.onsuccess=()=>{i++,i===m&&e()}}),c.onerror=()=>s(c.error)})})}static getAll(){return o(this,null,function*(){let t=yield r.openDB();return new Promise((a,e)=>{let n=t.transaction(r.storeName,"readonly").objectStore(r.storeName).getAll();n.onsuccess=()=>{a(n.result)},n.onerror=()=>e(n.error)})})}static getLastSyncTime(){return o(this,null,function*(){try{let t=localStorage.getItem("playmate_lastExpenseSyncTime");return t?new Date(t):null}catch(t){return console.error("Error getting last expense sync time from localStorage:",t),null}})}static setLastSyncTime(t){return o(this,null,function*(){try{localStorage.setItem("playmate_lastExpenseSyncTime",t.toISOString())}catch(a){throw console.error("Error setting last expense sync time to localStorage:",a),a}})}};r.dbName=d.dbName,r.storeName="expenses";var l=r;var E=(()=>{let t=class t{constructor(e,s){this.api=e,this.clubContext=s,this.expensesSubject=new y([]),this.expenses$=this.expensesSubject.asObservable(),this.loadingSubject=new y(!1),this.loading$=this.loadingSubject.asObservable()}loadCachedData(){return o(this,null,function*(){try{let e=yield l.getAll();this.expensesSubject.next(e)}catch{this.expensesSubject.next([])}})}syncExpenses(){return o(this,null,function*(){this.loadingSubject.next(!0);try{let e=this.clubContext.getSportsClubId()||"",s=yield this.api.get("getExpenses",e);s.status==="success"&&Array.isArray(s.data)?(yield l.setAll(s.data),this.expensesSubject.next(s.data),yield l.setLastSyncTime(new Date)):this.expensesSubject.next([])}catch{this.expensesSubject.next([])}finally{this.loadingSubject.next(!1)}})}refreshData(){return o(this,null,function*(){yield this.syncExpenses()})}loadData(){return o(this,null,function*(){yield this.loadCachedData()})}};t.\u0275fac=function(s){return new(s||t)(x(f),x(g))},t.\u0275prov=S({token:t,factory:t.\u0275fac,providedIn:"root"});let p=t;return p})();export{E as a};
